{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Estilo"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<style>\n",
       ".output_subarea.output_text.output_stream.output_stdout > pre {\n",
       "   width:max-content;\n",
       "}\n",
       ".p-Widget.jp-RenderedText.jp-OutputArea-output > pre {\n",
       "   width:max-content;\n",
       "}\n",
       "</style>"
      ],
      "text/plain": [
       "<IPython.core.display.HTML object>"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "%%html\n",
    "<style>\n",
    ".output_subarea.output_text.output_stream.output_stdout > pre {\n",
    "   width:max-content;\n",
    "}\n",
    ".p-Widget.jp-RenderedText.jp-OutputArea-output > pre {\n",
    "   width:max-content;\n",
    "}\n",
    "</style>"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "metadata": {},
   "outputs": [],
   "source": [
    "#quitamos estas variables:\n",
    "#Edad\n",
    "# Genero\n",
    "# Retiros_credito\n",
    "# NO_CLAIMS_12\n",
    "# monto_12 meses\n",
    "# PORCENTAJE_ECOMMERCE\n",
    "# C\n",
    "# razon comercio = Numero de comercios con incidencia/distintos giros de compra\n",
    "#cambiamos facturacion/aclaraciones por aclaraciones/facturacion"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Librerias"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "metadata": {},
   "outputs": [],
   "source": [
    "# Librer√≠as\n",
    "from pyspark.sql import functions as F\n",
    "from pyspark.sql.types import *\n",
    "from time import time\n",
    "# from distinctExtract import get_table_data\n",
    "import datetime as dt\n",
    "import dateutil.relativedelta as rd\n",
    "import pandas as pd\n",
    "import matplotlib.pyplot as plt\n",
    "# import seaborn as sns\n",
    "# from math import log\n",
    "import numpy as np\n",
    "\n",
    "from pyspark.ml.feature import VectorAssembler\n",
    "from pyspark.ml.clustering import KMeans"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Paths"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {},
   "outputs": [],
   "source": [
    "path = '/data/sandboxes/ceaa/data/XME7865/tabla_pivote_seis_meses'\n",
    "ctes = spark.read.parquet(path)\n",
    "\n",
    "path_master = '/data/sandboxes/ceaa/data/XME7865/master'\n",
    "master = spark.read.parquet(path_master)\n",
    "master = master.select('customer_id', 'Delta_Monto', 'Delta_Reclamaciones', 'Delta_Pendiente', 'Bandera')\n",
    "\n",
    "path_dif_trans = '/data/sandboxes/ceaa/data/XME7865/dif_trans'\n",
    "dif_trans = spark.read.parquet(path_dif_trans)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "+-----------+-----------+---------+-----+---------------+---------------------+------------------+------------+------------+-----------------+----------+---------+--------------------+----+----------+---------+---------------+---------------+--------------------+--------------------+--------------------+--------------------+--------------------+-----------------+--------------------+--------------------+--------------------+--------------------+--------------------+---------------------+----------------------+----------------------------+-------------------+--------------------+--------------------+--------------------+--------------------+------------------------+-----------+-------------------+---------------+-------+------------------------+------------------------+-----------------------+--------------------------+-----------------------+----------------------+----------------------+--------------------------+-----------------------+----------------------+----------------------+-----------------------------+-----------------------------+------------------------------+-------------------------------+-------------------------------------+------------------------+----------------------------+----------------------+----------------------+-----------------------+\n",
      "|customer_id|monto_total|n_tarjeta|n_com|n_reclamaciones|dictamen_afavor_total|NO_CLAIMS_12_MONTH|monto_12_mes|div_comercio|tipo_tarjeta_moda|segment_id|gender_id|Segmento_descripcion|edad|antiguedad|pendiente|COMPRAS_CREDITO|RETIROS_CREDITO|      RETIROS_DEBITO|   COMPRAS_MADRUGADA|      COMPRAS_MANANA|       COMPRAS_TARDE|       COMPRAS_NOCHE|RETIROS_MADRUGADA|      RETIROS_MANANA|       RETIROS_TARDE|       RETIROS_NOCHE|COMPRAS_ENTRE_SEMANA|RETIROS_ENTRE_SEMANA|MAX_DEBITO_DISPONIBLE|MAX_PORC_ENDEUDAMIENTO|PORCENTAJE_COMPRAS_ECOMMERCE|    razon_comercios| razon_transacciones|       razon_compras|       razon_retiros|      razon_ecomerce|facturacion/aclaraciones|Delta_Monto|Delta_Reclamaciones|Delta_Pendiente|Bandera|COMPRAS_CREDITO_dif_mean|RETIROS_CREDITO_dif_mean|RETIROS_DEBITO_dif_mean|COMPRAS_MADRUGADA_dif_mean|COMPRAS_MANANA_dif_mean|COMPRAS_TARDE_dif_mean|COMPRAS_NOCHE_dif_mean|RETIROS_MADRUGADA_dif_mean|RETIROS_MANANA_dif_mean|RETIROS_TARDE_dif_mean|RETIROS_NOCHE_dif_mean|COMPRAS_ENTRE_SEMANA_dif_mean|RETIROS_ENTRE_SEMANA_dif_mean|MAX_DEBITO_DISPONIBLE_dif_mean|MAX_PORC_ENDEUDAMIENTO_dif_mean|PORCENTAJE_COMPRAS_ECOMMERCE_dif_mean|razon_comercios_dif_mean|razon_transacciones_dif_mean|razon_compras_dif_mean|razon_retiros_dif_mean|razon_ecomerce_dif_mean|\n",
      "+-----------+-----------+---------+-----+---------------+---------------------+------------------+------------+------------+-----------------+----------+---------+--------------------+----+----------+---------+---------------+---------------+--------------------+--------------------+--------------------+--------------------+--------------------+-----------------+--------------------+--------------------+--------------------+--------------------+--------------------+---------------------+----------------------+----------------------------+-------------------+--------------------+--------------------+--------------------+--------------------+------------------------+-----------+-------------------+---------------+-------+------------------------+------------------------+-----------------------+--------------------------+-----------------------+----------------------+----------------------+--------------------------+-----------------------+----------------------+----------------------+-----------------------------+-----------------------------+------------------------------+-------------------------------+-------------------------------------+------------------------+----------------------------+----------------------+----------------------+-----------------------+\n",
      "|   00035838|     302.60|        1|    2|              5|                    5|                 4|      245.29|         0.8|                D|        B1|        F|           Comercial|  41|        19|  -133.97|          0E-20|          0E-20|1.000000000000000...|0.065294272678777...|0.114549033890350...|0.546681662275965...|0.273475031154906...|            0E-20|0.147058823529411...|0.431372549019607...|0.421568627450980...|0.627636704151962...|0.490196078431372...|              5811.54|                 0E-20|        0.232784467690041...|0.06451612903225806|211.6773577235772...|163.5709146341463...|728.5714285714285...|20.63645076007931...|                    32.8|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|      -0.00537950242703...|   -0.00491930546273...|  -0.05944984453346...|  -0.03025134757676...|                     0E-25|                  0E-25|  -0.10000000000000...|                 0E-25|         -0.08044723141504...|         -0.10000000000000...|            -581.1540000000000|                          0E-25|                 -0.03001284549787...|    -0.03333333333333333|        -23.4107222222222...|  -17.8495000000000...|  -150.000000000000...|   -0.24785194976867...|\n",
      "|   00035838|     302.60|        1|    2|              5|                    5|                 4|      245.29|         0.8|                D|        B1|        F|           Comercial|  41|        19|  -133.97|          0E-20|          0E-20|1.000000000000000...|0.065294272678777...|0.114549033890350...|0.546681662275965...|0.273475031154906...|            0E-20|0.147058823529411...|0.431372549019607...|0.421568627450980...|0.627636704151962...|0.490196078431372...|              5811.54|                 0E-20|        0.232784467690041...|0.06451612903225806|211.6773577235772...|163.5709146341463...|728.5714285714285...|20.63645076007931...|                    32.8|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|      -0.00537950242703...|   -0.00491930546273...|  -0.05944984453346...|  -0.03025134757676...|                     0E-25|                  0E-25|  -0.10000000000000...|                 0E-25|         -0.08044723141504...|         -0.10000000000000...|            -581.1540000000000|                          0E-25|                 -0.03001284549787...|    -0.03333333333333333|        -23.4107222222222...|  -17.8495000000000...|  -150.000000000000...|   -0.24785194976867...|\n",
      "|   00035838|     302.60|        1|    2|              5|                    5|                 4|      245.29|         0.8|                D|        B1|        F|           Comercial|  41|        19|  -133.97|          0E-20|          0E-20|1.000000000000000...|0.065294272678777...|0.114549033890350...|0.546681662275965...|0.273475031154906...|            0E-20|0.147058823529411...|0.431372549019607...|0.421568627450980...|0.627636704151962...|0.490196078431372...|              5811.54|                 0E-20|        0.232784467690041...|0.06451612903225806|211.6773577235772...|163.5709146341463...|728.5714285714285...|20.63645076007931...|                    32.8|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|      -0.00537950242703...|   -0.00491930546273...|  -0.05944984453346...|  -0.03025134757676...|                     0E-25|                  0E-25|  -0.10000000000000...|                 0E-25|         -0.08044723141504...|         -0.10000000000000...|            -581.1540000000000|                          0E-25|                 -0.03001284549787...|    -0.03333333333333333|        -23.4107222222222...|  -17.8495000000000...|  -150.000000000000...|   -0.24785194976867...|\n",
      "|   00035838|     302.60|        1|    2|              5|                    5|                 4|      245.29|         0.8|                D|        B1|        F|           Comercial|  41|        19|  -133.97|          0E-20|          0E-20|1.000000000000000...|0.065294272678777...|0.114549033890350...|0.546681662275965...|0.273475031154906...|            0E-20|0.147058823529411...|0.431372549019607...|0.421568627450980...|0.627636704151962...|0.490196078431372...|              5811.54|                 0E-20|        0.232784467690041...|0.06451612903225806|211.6773577235772...|163.5709146341463...|728.5714285714285...|20.63645076007931...|                    32.8|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|      -0.00537950242703...|   -0.00491930546273...|  -0.05944984453346...|  -0.03025134757676...|                     0E-25|                  0E-25|  -0.10000000000000...|                 0E-25|         -0.08044723141504...|         -0.10000000000000...|            -581.1540000000000|                          0E-25|                 -0.03001284549787...|    -0.03333333333333333|        -23.4107222222222...|  -17.8495000000000...|  -150.000000000000...|   -0.24785194976867...|\n",
      "|   00035838|     302.60|        1|    2|              5|                    5|                 4|      245.29|         0.8|                D|        B1|        F|           Comercial|  41|        19|  -133.97|          0E-20|          0E-20|1.000000000000000...|0.065294272678777...|0.114549033890350...|0.546681662275965...|0.273475031154906...|            0E-20|0.147058823529411...|0.431372549019607...|0.421568627450980...|0.627636704151962...|0.490196078431372...|              5811.54|                 0E-20|        0.232784467690041...|0.06451612903225806|211.6773577235772...|163.5709146341463...|728.5714285714285...|20.63645076007931...|                    32.8|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|      -0.00537950242703...|   -0.00491930546273...|  -0.05944984453346...|  -0.03025134757676...|                     0E-25|                  0E-25|  -0.10000000000000...|                 0E-25|         -0.08044723141504...|         -0.10000000000000...|            -581.1540000000000|                          0E-25|                 -0.03001284549787...|    -0.03333333333333333|        -23.4107222222222...|  -17.8495000000000...|  -150.000000000000...|   -0.24785194976867...|\n",
      "|   00035838|     302.60|        1|    2|              5|                    5|                 4|      245.29|         0.8|                D|        B1|        F|           Comercial|  41|        19|  -133.97|          0E-20|          0E-20|1.000000000000000...|0.065294272678777...|0.114549033890350...|0.546681662275965...|0.273475031154906...|            0E-20|0.147058823529411...|0.431372549019607...|0.421568627450980...|0.627636704151962...|0.490196078431372...|              5811.54|                 0E-20|        0.232784467690041...|0.06451612903225806|211.6773577235772...|163.5709146341463...|728.5714285714285...|20.63645076007931...|                    32.8|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|      -0.00537950242703...|   -0.00491930546273...|  -0.05944984453346...|  -0.03025134757676...|                     0E-25|                  0E-25|  -0.10000000000000...|                 0E-25|         -0.08044723141504...|         -0.10000000000000...|            -581.1540000000000|                          0E-25|                 -0.03001284549787...|    -0.03333333333333333|        -23.4107222222222...|  -17.8495000000000...|  -150.000000000000...|   -0.24785194976867...|\n",
      "|   00035838|     302.60|        1|    2|              5|                    5|                 4|      245.29|         0.8|                D|        B1|        F|           Comercial|  41|        19|  -133.97|          0E-20|          0E-20|1.000000000000000...|0.065294272678777...|0.114549033890350...|0.546681662275965...|0.273475031154906...|            0E-20|0.147058823529411...|0.431372549019607...|0.421568627450980...|0.627636704151962...|0.490196078431372...|              5811.54|                 0E-20|        0.232784467690041...|0.06451612903225806|211.6773577235772...|163.5709146341463...|728.5714285714285...|20.63645076007931...|                    32.8|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|      -0.00537950242703...|   -0.00491930546273...|  -0.05944984453346...|  -0.03025134757676...|                     0E-25|                  0E-25|  -0.10000000000000...|                 0E-25|         -0.08044723141504...|         -0.10000000000000...|            -581.1540000000000|                          0E-25|                 -0.03001284549787...|    -0.03333333333333333|        -23.4107222222222...|  -17.8495000000000...|  -150.000000000000...|   -0.24785194976867...|\n",
      "|   00035838|     302.60|        1|    2|              5|                    5|                 4|      245.29|         0.8|                D|        B1|        F|           Comercial|  41|        19|  -133.97|          0E-20|          0E-20|1.000000000000000...|0.065294272678777...|0.114549033890350...|0.546681662275965...|0.273475031154906...|            0E-20|0.147058823529411...|0.431372549019607...|0.421568627450980...|0.627636704151962...|0.490196078431372...|              5811.54|                 0E-20|        0.232784467690041...|0.06451612903225806|211.6773577235772...|163.5709146341463...|728.5714285714285...|20.63645076007931...|                    32.8|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|      -0.00537950242703...|   -0.00491930546273...|  -0.05944984453346...|  -0.03025134757676...|                     0E-25|                  0E-25|  -0.10000000000000...|                 0E-25|         -0.08044723141504...|         -0.10000000000000...|            -581.1540000000000|                          0E-25|                 -0.03001284549787...|    -0.03333333333333333|        -23.4107222222222...|  -17.8495000000000...|  -150.000000000000...|   -0.24785194976867...|\n",
      "|   00035838|     302.60|        1|    2|              5|                    5|                 4|      245.29|         0.8|                D|        B1|        F|           Comercial|  41|        19|  -133.97|          0E-20|          0E-20|1.000000000000000...|0.065294272678777...|0.114549033890350...|0.546681662275965...|0.273475031154906...|            0E-20|0.147058823529411...|0.431372549019607...|0.421568627450980...|0.627636704151962...|0.490196078431372...|              5811.54|                 0E-20|        0.232784467690041...|0.06451612903225806|211.6773577235772...|163.5709146341463...|728.5714285714285...|20.63645076007931...|                    32.8|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|      -0.00537950242703...|   -0.00491930546273...|  -0.05944984453346...|  -0.03025134757676...|                     0E-25|                  0E-25|  -0.10000000000000...|                 0E-25|         -0.08044723141504...|         -0.10000000000000...|            -581.1540000000000|                          0E-25|                 -0.03001284549787...|    -0.03333333333333333|        -23.4107222222222...|  -17.8495000000000...|  -150.000000000000...|   -0.24785194976867...|\n",
      "|   00035838|     302.60|        1|    2|              5|                    5|                 4|      245.29|         0.8|                D|        B1|        F|           Comercial|  41|        19|  -133.97|          0E-20|          0E-20|1.000000000000000...|0.065294272678777...|0.114549033890350...|0.546681662275965...|0.273475031154906...|            0E-20|0.147058823529411...|0.431372549019607...|0.421568627450980...|0.627636704151962...|0.490196078431372...|              5811.54|                 0E-20|        0.232784467690041...|0.06451612903225806|211.6773577235772...|163.5709146341463...|728.5714285714285...|20.63645076007931...|                    32.8|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|      -0.00537950242703...|   -0.00491930546273...|  -0.05944984453346...|  -0.03025134757676...|                     0E-25|                  0E-25|  -0.10000000000000...|                 0E-25|         -0.08044723141504...|         -0.10000000000000...|            -581.1540000000000|                          0E-25|                 -0.03001284549787...|    -0.03333333333333333|        -23.4107222222222...|  -17.8495000000000...|  -150.000000000000...|   -0.24785194976867...|\n",
      "|   00035838|     302.60|        1|    2|              5|                    5|                 4|      245.29|         0.8|                D|        B1|        F|           Comercial|  41|        19|  -133.97|          0E-20|          0E-20|1.000000000000000...|0.065294272678777...|0.114549033890350...|0.546681662275965...|0.273475031154906...|            0E-20|0.147058823529411...|0.431372549019607...|0.421568627450980...|0.627636704151962...|0.490196078431372...|              5811.54|                 0E-20|        0.232784467690041...|0.06451612903225806|211.6773577235772...|163.5709146341463...|728.5714285714285...|20.63645076007931...|                    32.8|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|      -0.00537950242703...|   -0.00491930546273...|  -0.05944984453346...|  -0.03025134757676...|                     0E-25|                  0E-25|  -0.10000000000000...|                 0E-25|         -0.08044723141504...|         -0.10000000000000...|            -581.1540000000000|                          0E-25|                 -0.03001284549787...|    -0.03333333333333333|        -23.4107222222222...|  -17.8495000000000...|  -150.000000000000...|   -0.24785194976867...|\n",
      "|   00035838|     302.60|        1|    2|              5|                    5|                 4|      245.29|         0.8|                D|        B1|        F|           Comercial|  41|        19|  -133.97|          0E-20|          0E-20|1.000000000000000...|0.065294272678777...|0.114549033890350...|0.546681662275965...|0.273475031154906...|            0E-20|0.147058823529411...|0.431372549019607...|0.421568627450980...|0.627636704151962...|0.490196078431372...|              5811.54|                 0E-20|        0.232784467690041...|0.06451612903225806|211.6773577235772...|163.5709146341463...|728.5714285714285...|20.63645076007931...|                    32.8|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|      -0.00537950242703...|   -0.00491930546273...|  -0.05944984453346...|  -0.03025134757676...|                     0E-25|                  0E-25|  -0.10000000000000...|                 0E-25|         -0.08044723141504...|         -0.10000000000000...|            -581.1540000000000|                          0E-25|                 -0.03001284549787...|    -0.03333333333333333|        -23.4107222222222...|  -17.8495000000000...|  -150.000000000000...|   -0.24785194976867...|\n",
      "|   00035838|     302.60|        1|    2|              5|                    5|                 4|      245.29|         0.8|                D|        B1|        F|           Comercial|  41|        19|  -133.97|          0E-20|          0E-20|1.000000000000000...|0.065294272678777...|0.114549033890350...|0.546681662275965...|0.273475031154906...|            0E-20|0.147058823529411...|0.431372549019607...|0.421568627450980...|0.627636704151962...|0.490196078431372...|              5811.54|                 0E-20|        0.232784467690041...|0.06451612903225806|211.6773577235772...|163.5709146341463...|728.5714285714285...|20.63645076007931...|                    32.8|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|      -0.00537950242703...|   -0.00491930546273...|  -0.05944984453346...|  -0.03025134757676...|                     0E-25|                  0E-25|  -0.10000000000000...|                 0E-25|         -0.08044723141504...|         -0.10000000000000...|            -581.1540000000000|                          0E-25|                 -0.03001284549787...|    -0.03333333333333333|        -23.4107222222222...|  -17.8495000000000...|  -150.000000000000...|   -0.24785194976867...|\n",
      "|   00035838|     302.60|        1|    2|              5|                    5|                 4|      245.29|         0.8|                D|        B1|        F|           Comercial|  41|        19|  -133.97|          0E-20|          0E-20|1.000000000000000...|0.065294272678777...|0.114549033890350...|0.546681662275965...|0.273475031154906...|            0E-20|0.147058823529411...|0.431372549019607...|0.421568627450980...|0.627636704151962...|0.490196078431372...|              5811.54|                 0E-20|        0.232784467690041...|0.06451612903225806|211.6773577235772...|163.5709146341463...|728.5714285714285...|20.63645076007931...|                    32.8|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|      -0.00537950242703...|   -0.00491930546273...|  -0.05944984453346...|  -0.03025134757676...|                     0E-25|                  0E-25|  -0.10000000000000...|                 0E-25|         -0.08044723141504...|         -0.10000000000000...|            -581.1540000000000|                          0E-25|                 -0.03001284549787...|    -0.03333333333333333|        -23.4107222222222...|  -17.8495000000000...|  -150.000000000000...|   -0.24785194976867...|\n",
      "|   00035838|     302.60|        1|    2|              5|                    5|                 4|      245.29|         0.8|                D|        B1|        F|           Comercial|  41|        19|  -133.97|          0E-20|          0E-20|1.000000000000000...|0.065294272678777...|0.114549033890350...|0.546681662275965...|0.273475031154906...|            0E-20|0.147058823529411...|0.431372549019607...|0.421568627450980...|0.627636704151962...|0.490196078431372...|              5811.54|                 0E-20|        0.232784467690041...|0.06451612903225806|211.6773577235772...|163.5709146341463...|728.5714285714285...|20.63645076007931...|                    32.8|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|      -0.00537950242703...|   -0.00491930546273...|  -0.05944984453346...|  -0.03025134757676...|                     0E-25|                  0E-25|  -0.10000000000000...|                 0E-25|         -0.08044723141504...|         -0.10000000000000...|            -581.1540000000000|                          0E-25|                 -0.03001284549787...|    -0.03333333333333333|        -23.4107222222222...|  -17.8495000000000...|  -150.000000000000...|   -0.24785194976867...|\n",
      "|   00035838|     302.60|        1|    2|              5|                    5|                 4|      245.29|         0.8|                D|        R1|        F|           Comercial|  41|        19|  -133.97|          0E-20|          0E-20|1.000000000000000...|0.065294272678777...|0.114549033890350...|0.546681662275965...|0.273475031154906...|            0E-20|0.147058823529411...|0.431372549019607...|0.421568627450980...|0.627636704151962...|0.490196078431372...|              5811.54|                 0E-20|        0.232784467690041...|0.06451612903225806|211.6773577235772...|163.5709146341463...|728.5714285714285...|20.63645076007931...|                    32.8|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|      -0.00537950242703...|   -0.00491930546273...|  -0.05944984453346...|  -0.03025134757676...|                     0E-25|                  0E-25|  -0.10000000000000...|                 0E-25|         -0.08044723141504...|         -0.10000000000000...|            -581.1540000000000|                          0E-25|                 -0.03001284549787...|    -0.03333333333333333|        -23.4107222222222...|  -17.8495000000000...|  -150.000000000000...|   -0.24785194976867...|\n",
      "|   00035838|     302.60|        1|    2|              5|                    5|                 4|      245.29|         0.8|                D|        B1|        F|           Comercial|  41|        19|  -133.97|          0E-20|          0E-20|1.000000000000000...|0.065294272678777...|0.114549033890350...|0.546681662275965...|0.273475031154906...|            0E-20|0.147058823529411...|0.431372549019607...|0.421568627450980...|0.627636704151962...|0.490196078431372...|              5811.54|                 0E-20|        0.232784467690041...|0.06451612903225806|211.6773577235772...|163.5709146341463...|728.5714285714285...|20.63645076007931...|                    32.8|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|      -0.00537950242703...|   -0.00491930546273...|  -0.05944984453346...|  -0.03025134757676...|                     0E-25|                  0E-25|  -0.10000000000000...|                 0E-25|         -0.08044723141504...|         -0.10000000000000...|            -581.1540000000000|                          0E-25|                 -0.03001284549787...|    -0.03333333333333333|        -23.4107222222222...|  -17.8495000000000...|  -150.000000000000...|   -0.24785194976867...|\n",
      "|   00035838|     302.60|        1|    2|              5|                    5|                 4|      245.29|         0.8|                D|        B1|        F|           Comercial|  41|        19|  -133.97|          0E-20|          0E-20|1.000000000000000...|0.065294272678777...|0.114549033890350...|0.546681662275965...|0.273475031154906...|            0E-20|0.147058823529411...|0.431372549019607...|0.421568627450980...|0.627636704151962...|0.490196078431372...|              5811.54|                 0E-20|        0.232784467690041...|0.06451612903225806|211.6773577235772...|163.5709146341463...|728.5714285714285...|20.63645076007931...|                    32.8|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|      -0.00537950242703...|   -0.00491930546273...|  -0.05944984453346...|  -0.03025134757676...|                     0E-25|                  0E-25|  -0.10000000000000...|                 0E-25|         -0.08044723141504...|         -0.10000000000000...|            -581.1540000000000|                          0E-25|                 -0.03001284549787...|    -0.03333333333333333|        -23.4107222222222...|  -17.8495000000000...|  -150.000000000000...|   -0.24785194976867...|\n",
      "|   00035838|     302.60|        1|    2|              5|                    5|                 4|      245.29|         0.8|                D|        B1|        F|           Comercial|  41|        19|  -133.97|          0E-20|          0E-20|1.000000000000000...|0.065294272678777...|0.114549033890350...|0.546681662275965...|0.273475031154906...|            0E-20|0.147058823529411...|0.431372549019607...|0.421568627450980...|0.627636704151962...|0.490196078431372...|              5811.54|                 0E-20|        0.232784467690041...|0.06451612903225806|211.6773577235772...|163.5709146341463...|728.5714285714285...|20.63645076007931...|                    32.8|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|      -0.00537950242703...|   -0.00491930546273...|  -0.05944984453346...|  -0.03025134757676...|                     0E-25|                  0E-25|  -0.10000000000000...|                 0E-25|         -0.08044723141504...|         -0.10000000000000...|            -581.1540000000000|                          0E-25|                 -0.03001284549787...|    -0.03333333333333333|        -23.4107222222222...|  -17.8495000000000...|  -150.000000000000...|   -0.24785194976867...|\n",
      "|   00035838|     302.60|        1|    2|              5|                    5|                 4|      245.29|         0.8|                D|        B1|        F|           Comercial|  41|        19|  -133.97|          0E-20|          0E-20|1.000000000000000...|0.065294272678777...|0.114549033890350...|0.546681662275965...|0.273475031154906...|            0E-20|0.147058823529411...|0.431372549019607...|0.421568627450980...|0.627636704151962...|0.490196078431372...|              5811.54|                 0E-20|        0.232784467690041...|0.06451612903225806|211.6773577235772...|163.5709146341463...|728.5714285714285...|20.63645076007931...|                    32.8|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|      -0.00537950242703...|   -0.00491930546273...|  -0.05944984453346...|  -0.03025134757676...|                     0E-25|                  0E-25|  -0.10000000000000...|                 0E-25|         -0.08044723141504...|         -0.10000000000000...|            -581.1540000000000|                          0E-25|                 -0.03001284549787...|    -0.03333333333333333|        -23.4107222222222...|  -17.8495000000000...|  -150.000000000000...|   -0.24785194976867...|\n",
      "+-----------+-----------+---------+-----+---------------+---------------------+------------------+------------+------------+-----------------+----------+---------+--------------------+----+----------+---------+---------------+---------------+--------------------+--------------------+--------------------+--------------------+--------------------+-----------------+--------------------+--------------------+--------------------+--------------------+--------------------+---------------------+----------------------+----------------------------+-------------------+--------------------+--------------------+--------------------+--------------------+------------------------+-----------+-------------------+---------------+-------+------------------------+------------------------+-----------------------+--------------------------+-----------------------+----------------------+----------------------+--------------------------+-----------------------+----------------------+----------------------+-----------------------------+-----------------------------+------------------------------+-------------------------------+-------------------------------------+------------------------+----------------------------+----------------------+----------------------+-----------------------+\n",
      "only showing top 20 rows\n",
      "\n"
     ]
    }
   ],
   "source": [
    "ctes = ctes.join(master,on=['customer_id'],how='left')\n",
    "ctes = ctes.join(dif_trans,on=['customer_id'],how='left')\n",
    "ctes.show()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "+-----------+-----------+---------+-----+---------------+---------------------+------------------+------------+------------------+-----------------+----------+---------+--------------------+----+----------+---------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+---------------------+----------------------+----------------------------+--------------------+--------------------+--------------------+--------------------+--------------------+------------------------+-----------+-------------------+---------------+-------+------------------------+------------------------+-----------------------+--------------------------+-----------------------+----------------------+----------------------+--------------------------+-----------------------+----------------------+----------------------+-----------------------------+-----------------------------+------------------------------+-------------------------------+-------------------------------------+------------------------+----------------------------+----------------------+----------------------+-----------------------+\n",
      "|customer_id|monto_total|n_tarjeta|n_com|n_reclamaciones|dictamen_afavor_total|NO_CLAIMS_12_MONTH|monto_12_mes|      div_comercio|tipo_tarjeta_moda|segment_id|gender_id|Segmento_descripcion|edad|antiguedad|pendiente|     COMPRAS_CREDITO|     RETIROS_CREDITO|      RETIROS_DEBITO|   COMPRAS_MADRUGADA|      COMPRAS_MANANA|       COMPRAS_TARDE|       COMPRAS_NOCHE|   RETIROS_MADRUGADA|      RETIROS_MANANA|       RETIROS_TARDE|       RETIROS_NOCHE|COMPRAS_ENTRE_SEMANA|RETIROS_ENTRE_SEMANA|MAX_DEBITO_DISPONIBLE|MAX_PORC_ENDEUDAMIENTO|PORCENTAJE_COMPRAS_ECOMMERCE|     razon_comercios| razon_transacciones|       razon_compras|       razon_retiros|      razon_ecomerce|facturacion/aclaraciones|Delta_Monto|Delta_Reclamaciones|Delta_Pendiente|Bandera|COMPRAS_CREDITO_dif_mean|RETIROS_CREDITO_dif_mean|RETIROS_DEBITO_dif_mean|COMPRAS_MADRUGADA_dif_mean|COMPRAS_MANANA_dif_mean|COMPRAS_TARDE_dif_mean|COMPRAS_NOCHE_dif_mean|RETIROS_MADRUGADA_dif_mean|RETIROS_MANANA_dif_mean|RETIROS_TARDE_dif_mean|RETIROS_NOCHE_dif_mean|COMPRAS_ENTRE_SEMANA_dif_mean|RETIROS_ENTRE_SEMANA_dif_mean|MAX_DEBITO_DISPONIBLE_dif_mean|MAX_PORC_ENDEUDAMIENTO_dif_mean|PORCENTAJE_COMPRAS_ECOMMERCE_dif_mean|razon_comercios_dif_mean|razon_transacciones_dif_mean|razon_compras_dif_mean|razon_retiros_dif_mean|razon_ecomerce_dif_mean|\n",
      "+-----------+-----------+---------+-----+---------------+---------------------+------------------+------------+------------------+-----------------+----------+---------+--------------------+----+----------+---------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+---------------------+----------------------+----------------------------+--------------------+--------------------+--------------------+--------------------+--------------------+------------------------+-----------+-------------------+---------------+-------+------------------------+------------------------+-----------------------+--------------------------+-----------------------+----------------------+----------------------+--------------------------+-----------------------+----------------------+----------------------+-----------------------------+-----------------------------+------------------------------+-------------------------------+-------------------------------------+------------------------+----------------------------+----------------------+----------------------+-----------------------+\n",
      "|   00035838|     302.60|        1|    2|              5|                    5|                 4|      245.29|               0.8|                D|        B1|        F|           Comercial|  41|        19|  -133.97|               0E-20|               0E-20|1.000000000000000...|0.065294272678777...|0.114549033890350...|0.546681662275965...|0.273475031154906...|               0E-20|0.147058823529411...|0.431372549019607...|0.421568627450980...|0.627636704151962...|0.490196078431372...|              5811.54|                 0E-20|        0.232784467690041...| 0.06451612903225806|211.6773577235772...|163.5709146341463...|728.5714285714285...|20.63645076007931...|                    32.8|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|      -0.00537950242703...|   -0.00491930546273...|  -0.05944984453346...|  -0.03025134757676...|                     0E-25|                  0E-25|  -0.10000000000000...|                 0E-25|         -0.08044723141504...|         -0.10000000000000...|            -581.1540000000000|                          0E-25|                 -0.03001284549787...|    -0.03333333333333333|        -23.4107222222222...|  -17.8495000000000...|  -150.000000000000...|   -0.24785194976867...|\n",
      "|   00054168|     910.00|        1|    2|              2|                    2|                 1|       95.00|               0.5|                D|        B1|        F|           Comercial|  32|        11|      0.0|               0E-20|               0E-20|0.992300544271870...|0.127441894563249...|0.512441207735568...|0.285136049270907...|0.074980848430274...|               0E-20|0.399309703969202...|0.247245453338643...|0.353444842692154...|0.373703497045159...|0.613965219699986...|             47355.17|                 0E-20|        0.143899470642837...| 0.11764705882352941|2157.447964601769...|303.4632584269662...|3348.000000000000...|4.270846153846153...|                    44.5|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|                     0E-25|   -0.00172790567667...|  -0.09249377445748...|  -0.00577831986583...|                     0E-25|                  0E-25|                 0E-25|  -0.10000000000000...|         -0.00965594348732...|         -0.10000000000000...|           -1085.5040000000000|                          0E-25|                                0E-25|                  -0.025|        -159.552058823529...|  -19.6770000000000...|  -515.000000000000...|                  0E-25|\n",
      "|   00147123|    3600.00|        1|    1|              3|                    3|                 0|        0.00|               1.0|                D|        B1|        F|           Comercial|  29|        11|      0.0|0.000475816393873...|               0E-20|1.000000000000000...|0.004956103558583...|0.104494038258492...|0.409185920973558...|0.481363937209365...|               0E-20|0.581395348837209...|0.418604651162790...|               0E-20|0.908869740979829...|0.534883720930232...|             13899.98|  0.666666666666666...|                       0E-20| 0.08333333333333333|1362.276578947368...|840.6604000000000...|5016.666666666666...|               0E-20|       8.333333333333334|          0|                  0|              0|      0|    -0.00020686117133...|                   0E-25|   -0.10000000000000...|      -0.00049977658993...|                  0E-25|  -0.00020686117133...|  -0.09929336223873...|                     0E-25|   -0.10000000000000...|                 0E-25|                 0E-25|         -0.09979313882866...|                        0E-25|            -831.5740000000000|           -0.06666666666666...|                                0E-25|    -0.03333333333333333|        -149.177000000000...|  -80.5693333333333...|  -700.000000000000...|                  0E-25|\n",
      "|   00152272|    1053.90|        1|    2|              4|                    4|                 1|       99.00|               0.5|                D|        B1|        F|           Comercial|  27|        11|      0.0|               0E-20|               0E-20|1.000000000000000...|0.168606118600467...|0.196139735720107...|0.521015851864567...|0.114238293814857...|               0E-20|0.291954022988505...|0.535632183908045...|0.172413793103448...|0.493490733037196...|0.636781609195402...|             36238.06|                 0E-20|        0.397269668660082...| 0.16666666666666666|780.7880000000000...|301.7197435897435...|1359.375000000000...|4.435620077806243...|                    9.75|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|      -0.02930359648475...|   -0.00146222583265...|  -0.06807030499963...|  -0.00116387268296...|                     0E-25|                  0E-25|  -0.10000000000000...|                 0E-25|         -0.04711173473155...|         -0.02931034482758...|           -3623.8060000000000|                          0E-25|                 -0.06904512222140...|                   -0.05|        -42.4854838709677...|  -32.2404761904761...|  -82.8571428571428...|   -0.44356200778062...|\n",
      "|   00194397|      99.00|        1|    1|              1|                    1|                 0|        0.00|               1.0|                D|        F9|        F|            Personal|  28|        11|      0.0|               0E-20|               0E-20|1.000000000000000...|0.103444808238909...|0.043921526871988...|0.692807369351943...|0.159826295537158...|               0E-20|               0E-20|1.000000000000000...|               0E-20|0.785044794042052...|               0E-20|            135621.65|                 0E-20|        0.088864931692413...|                 0.1|707.8614285714285...|563.5050000000000...|3000.000000000000...|12.13959595959595...|                    24.0|          0|                  0|              0|      0|                   0E-25|                   0E-25|                  0E-25|                     0E-25|                  0E-25|  -0.10000000000000...|                 0E-25|                     0E-25|                  0E-25|                 0E-25|                 0E-25|         -0.10000000000000...|                        0E-25|          -11837.6850000000000|                          0E-25|                                0E-25|                    -0.1|        -158.551000000000...|  -158.551000000000...|                 0E-22|                  0E-25|\n",
      "|   00444268|     251.00|        1|    2|              2|                    2|                 1|      151.00|               0.5|                D|        B1|        M|           Comercial|  26|        11|      0.0|0.455541602660661...|0.064039408866995...|0.935960591133004...|0.070778362738810...|0.119415370389703...|0.569920209989411...|0.239886056882074...|               0E-20|0.133004926108374...|0.724137931034482...|0.142857142857142...|0.597687730235194...|0.408866995073891...|              3417.75|  0.577727272727272...|        0.089484124024995...| 0.08333333333333333|222.9747023809523...|169.3207070707070...|312.3076923076923...|5.976095617529880...|                    49.5|          0|                  0|              0|      0|    -0.09630750348305...|    -0.01142857142857...|   -0.18857142857142...|                     0E-25|   -0.01927831652451...|  -0.16945703943824...|  -0.01126464403724...|                     0E-25|   -0.03142857142857...|  -0.13142857142857...|  -0.03714285714285...|         -0.20000000000000...|         -0.06428571428571...|            -184.9410000000000|           -0.02566500000000...|                                0E-25|                  -0.045|        -35.3692727272727...|  -25.2756388888888...|  -51.9230769230769...|                  0E-25|\n",
      "|   00447923|    2739.00|        1|    4|              4|                    3|                 3|     2089.00|              0.25|                D|        B1|        F|           Comercial|  26|        11|      0.0|               0E-20|               0E-20|1.000000000000000...|               0E-20|0.371781115879828...|0.583261802575107...|0.044957081545064...|               0E-20|0.375036374974017...|0.507888172937019...|0.117075452088962...|0.955042918454935...|0.721159842028684...|             14217.08|                 0E-20|        0.008583690987124...|                 0.4|864.5909090909090...|548.2352941176470...|1436.119402985074...|0.029207740051113...|                    4.25|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|                     0E-25|                  0E-25|  -0.10000000000000...|                 0E-25|                     0E-25|                  0E-25|  -0.08333333333333...|  -0.01666666666666...|         -0.10000000000000...|         -0.10000000000000...|            -206.0720000000000|                          0E-25|                                0E-25|                    -0.1|        -65.6250000000000...|  -65.0000000000000...|  -120.000000000000...|                  0E-25|\n",
      "|   00458134|     768.00|        1|    1|              1|                    1|                 0|        0.00|               1.0|                D|        B1|        M|           Comercial|  28|        11|      0.0|0.429717543001600...|0.015160374605859...|0.984839625394140...|0.063369268930590...|0.215006873998695...|0.439986663786686...|0.281637193284027...|0.011864742403077...|0.528305002480470...|0.205196603236436...|0.254633651880014...|0.624758049975534...|0.867411095481671...|             13735.58|  0.994913333333333...|        0.052575042809954...|0.016129032258064516|832.5283024691358...|415.2228125000000...|1405.735409836065...|6.367187500000000...|                   224.0|          0|                  0|              0|      0|    -0.05849676890093...|                   0E-25|   -0.10000000000000...|      -0.02977749788812...|   -0.00457446776067...|  -0.02158874314973...|  -0.04405929120146...|                     0E-25|   -0.05437500000000...|  -0.03312500000000...|  -0.01250000000000...|         -0.07006346311606...|         -0.10000000000000...|            -301.9960000000000|           -0.08266088888888...|                                0E-25|    -0.00833333333333...|        -106.520350000000...|  -25.2236153846153...|  -160.000000000000...|                  0E-25|\n",
      "|   00461820|     100.00|        1|    1|              1|                    1|                 0|        0.00|               1.0|                D|        B1|        M|           Comercial|  27|        11|      0.0|0.791631935267448...|               0E-20|1.000000000000000...|               0E-20|0.046557017098013...|0.202675503689999...|0.750767479211986...|               0E-20|0.164974619289340...|0.479332849891225...|0.355692530819434...|0.159147742289629...|0.211747643219724...|             11557.36|  0.028666666666666...|        0.020330575151971...| 0.07142857142857142|666.2743842364532...|273.2611111111111...|1970.000000000000...|1.000000000000000...|                    18.0|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|                     0E-25|   -0.02439024390243...|  -0.07560975609756...|                 0E-25|                     0E-25|   -0.00057971014492...|  -0.09739130434782...|  -0.00202898550724...|                        0E-25|         -0.00260869565217...|            -637.1360000000000|                          0E-25|                 -0.02439024390243...|    -0.03333333333333333|        -79.6969696969696...|  -8.20000000000000...|  -246.428571428571...|   -0.10000000000000...|\n",
      "|   00475697|     753.11|        1|    1|              1|                    1|                 0|        0.00|               1.0|                D|        R1|        M|           Comercial|  26|        11|      0.0|               0E-20|               0E-20|1.000000000000000...|0.057199032746502...|0.086195486961605...|0.469515753217079...|0.387089727074811...|0.042338709677419...|0.121975806451612...|0.376008064516129...|0.459677419354838...|0.453035009917651...|0.444556451612903...|              8525.32|                 0E-20|        0.076524690402970...|0.012195121951219513|388.8908370044052...|248.3037410071942...|604.8780487804878...|3.507044123700389...|                   139.0|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|      -0.00255737021697...|   -0.00263707639811...|  -0.00423745148602...|  -0.09056810189888...|                     0E-25|                  0E-25|  -0.04210526315789...|  -0.05789473684210...|         -0.05247531973639...|         -0.06315789473684...|            -153.8900000000000|                          0E-25|                 -0.01037196217863...|                   -0.01|        -23.9129166666666...|  -20.2057894736842...|  -38.0000000000000...|   -0.05287275431211...|\n",
      "|   00522122|     178.00|        2|    2|              2|                    2|                 0|        0.00|               0.5|                C|        B1|        M|           Comercial|  40|        11|      0.0|0.473876011866207...|               0E-20|1.000000000000000...|0.070043374373439...|0.183346394947702...|0.552042413562021...|0.194567817116836...|0.009033423667570...|0.434507678410117...|0.478771454381210...|0.077687443541102...|0.486684338400024...|0.610659439927732...|            119380.30|  0.944426969222743...|        0.052608747870185...| 0.02127659574468085|1019.586846590909...|774.6092307692307...|1064.423076923076...|50.59561797752808...|                   110.5|          0|                  0|              0|      0|    -0.01658413433474...|                   0E-25|   -0.10000000000000...|      -0.00002116005759...|   -0.03761358329766...|  -0.05846159084718...|  -0.00390366579756...|                     0E-25|   -0.06969696969696...|  -0.03030303030303...|                 0E-25|         -0.01916225629450...|         -0.06666666666666...|           -6004.6570000000000|           -0.00117704225352...|                                0E-25|    -0.01428571428571...|        -98.0160000000000...|  -68.5253333333333...|  -82.5000000000000...|                  0E-25|\n",
      "|   00529362|      51.00|        1|    1|              1|                    1|                 0|        0.00|               1.0|                D|        F9|        F|            Personal|  32|        11|      0.0|               0E-20|               0E-20|1.000000000000000...|0.031129679691980...|0.102400262144671...|0.303416072745146...|0.563053985418202...|               0E-20|0.170560747663551...|0.829439252336448...|               0E-20|0.136260615493842...|0.446261682242990...|              8726.09|                 0E-20|        0.004096010485786...| 0.08333333333333333|709.0282051282051...|197.9513513513513...|3566.666666666666...|0.588235294117647...|                    37.0|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|                     0E-25|   -0.08349514563106...|                 0E-25|  -0.01650485436893...|                     0E-25|                  0E-25|  -0.10000000000000...|                 0E-25|         -0.08349514563106...|         -0.10000000000000...|             -26.8660000000000|                          0E-25|                                0E-25|    -0.03333333333333333|        -72.3166666666666...|  -10.3000000000000...|  -380.000000000000...|                  0E-25|\n",
      "|   00731582|      98.00|        1|    1|              2|                    2|                 0|        0.00|               1.0|                D|        Q1|        M|            Personal|  44|        11|      0.0|0.908036173766601...|               0E-20|1.000000000000000...|0.002261920025374...|0.328565146581530...|0.404970184263125...|0.264202749129969...|               0E-20|0.755752212389380...|0.226548672566371...|0.017699115044247...|0.411707873240645...|0.751327433628318...|             49827.18|  0.697592692307692...|        0.024122614149432...| 0.00909090909090909|1064.582133333333...|871.1455384615384...|2404.255319148936...|69.69030612244897...|                   162.5|          0|                  0|              0|      0|    -0.08990654450337...|                   0E-25|   -0.10000000000000...|      -0.00183303122263...|   -0.01540604551154...|  -0.07989499349710...|  -0.00286592976871...|                     0E-25|                  0E-25|  -0.10000000000000...|                 0E-25|         -0.06306740317667...|                        0E-25|           -2004.3780000000000|           -0.03673076923076...|                 -0.01210848053349...|    -0.00666666666666...|        -74.7441818181818...|  -72.3564210526315...|  -200.000000000000...|   -1.69861224489795...|\n",
      "|   00971551|    3182.00|        1|    2|              3|                    3|                 2|     1432.00|0.6666666666666666|                C|        B1|        F|           Comercial|  30|        11|      0.0|0.306236498370886...|               0E-20|1.000000000000000...|0.015708941735873...|0.627418738930048...|0.220389465491448...|0.136482853842629...|               0E-20|0.123386109685316...|0.518221660678327...|0.358392229636356...|0.732702845804695...|0.567862360326923...|             31111.14|  0.916483333333333...|        0.043054084541000...| 0.06451612903225806|887.7444715447154...|758.7356000000000...|2894.514285714285...|0.769956002514142...|                    25.0|          0|                  0|              0|      0|    -0.08702484434984...|                   0E-25|                  0E-25|      -0.00949416187615...|   -0.09050583812384...|                 0E-25|                 0E-25|                     0E-25|                  0E-25|                 0E-25|                 0E-25|         -0.09050583812384...|                        0E-25|             -58.0870000000000|           -0.05581666666666...|                                0E-25|                   -0.05|        -27.0115000000000...|  -33.5153333333333...|                 0E-22|                  0E-25|\n",
      "|   01146807|    1157.00|        1|    1|              3|                    3|                 0|        0.00|               1.0|                D|        R1|        M|           Comercial|  38|        16|      0.0|               0E-20|               0E-20|1.000000000000000...|0.009772658039728...|0.152037467138336...|0.497329687222117...|0.340860187599817...|0.009920634920634...|0.313492063492063...|0.490079365079365...|0.186507936507936...|0.473036268006782...|0.488095238095238...|              9122.52|                 0E-20|        0.296432891773534...| 0.01818181818181818|464.9611724137931...|220.5479611650485...|446.0176991150442...|5.820138288677614...|      34.333333333333336|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|                     0E-25|   -0.02611978074425...|  -0.01070245722632...|  -0.06317776202941...|                     0E-25|   -0.02244897959183...|  -0.04897959183673...|  -0.02857142857142...|         -0.06273953979433...|         -0.03877551020408...|            -912.2520000000000|                          0E-25|                                0E-25|    -0.00909090909090909|        -67.0069354838709...|  -26.5934615384615...|  -44.5454545454545...|                  0E-25|\n",
      "|   02039499|     448.35|        1|    1|              1|                    0|                 0|        0.00|               1.0|                D|        B1|        F|           Comercial|  41|        11|      0.0|0.058588760477428...|               0E-20|1.000000000000000...|0.016325126166080...|0.294659151319191...|0.540437230099257...|0.148578492415470...|0.043140638481449...|0.311475409836065...|0.570319240724762...|0.075064710957722...|0.845943023179603...|0.322691975841242...|             11761.76|  1.270313333333333...|        0.053344402449770...| 0.02702702702702703|1519.275277777777...|450.2262295081967...|3996.551724137931...|3.267625738820118...|                    61.0|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|      -0.03812986350299...|   -0.01700897223285...|  -0.04486116426414...|                 0E-25|                     0E-25|                  0E-25|  -0.04210526315789...|  -0.05789473684210...|         -0.10000000000000...|         -0.10000000000000...|           -1046.4490000000000|                          0E-25|                                0E-25|    -0.03333333333333333|        -81.9538888888888...|  -39.1950000000000...|  -126.666666666666...|                  0E-25|\n",
      "|   02116751|     100.00|        1|    1|              1|                    1|                 0|        0.00|               1.0|                D|        R1|        F|           Comercial|  57|        10|      0.0|               0E-20|               0E-20|1.000000000000000...|0.093513452036444...|0.175159156928429...|0.444634487123769...|0.286692903911356...|               0E-20|0.145867098865478...|0.486223662884927...|0.367909238249594...|0.628803242092701...|0.706464973887988...|             20570.65|                 0E-20|        0.153291733949284...|                0.05|386.9962734584450...|108.3368452380952...|1354.390243902439...|27.90000000000000...|                   168.0|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|                     0E-25|   -0.02175692695214...|  -0.04093198992443...|  -0.03731108312342...|                     0E-25|                  0E-25|  -0.06000000000000...|  -0.04000000000000...|         -0.07257556675062...|         -0.04000000000000...|            -935.8530000000000|                          0E-25|                 -0.00944584382871...|                 -0.0125|        -16.1583333333333...|  -9.07428571428571...|  -100.000000000000...|   -0.30000000000000...|\n",
      "|   02133818|    3075.80|        1|    1|              1|                    1|                 0|        0.00|               1.0|                D|        B1|        M|           Comercial|  29|        10|      0.0|               0E-20|               0E-20|1.000000000000000...|0.005023286722470...|0.223532610952897...|0.566425249564742...|0.205018852759889...|               0E-20|0.633893919793014...|0.256144890038809...|0.109961190168175...|0.467667713231505...|0.553040103492884...|              9837.32|                 0E-20|        0.041454743834827...|0.017857142857142856|542.6802285714285...|326.9177981651376...|417.8378378378378...|0.480265296833344...|                   109.0|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|      -0.00053894630422...|   -0.02890796469715...|  -0.04418802163962...|  -0.02636506735899...|                     0E-25|   -0.10000000000000...|                 0E-25|                 0E-25|         -0.04244053470907...|         -0.10000000000000...|            -983.7320000000000|                          0E-25|                 -0.00278765329770...|    -0.00909090909090909|        -56.0639411764705...|  -44.8405833333333...|  -50.0000000000000...|   -0.00487678002470...|\n",
      "|   02295358|      99.00|        1|    1|              1|                    1|                 0|        0.00|               1.0|                D|        R1|        M|           Comercial|  22|        11|      0.0|               0E-20|               0E-20|0.990990990990990...|0.168643422699437...|0.307679819362683...|0.119136307123196...|0.404540450814681...|0.180180180180180...|               0E-20|0.342342342342342...|0.477477477477477...|0.273454150276530...|0.315315315315315...|              3200.00|                 0E-20|        0.285848944860392...|                0.04|253.0200714285714...|112.8300000000000...|326.4705882352941...|34.85858585858585...|                   107.0|          0|                  0|              0|      0|                   0E-25|                   0E-25|                  0E-25|      -0.02148670645686...|   -0.01806836679327...|  -0.00162778079218...|  -0.05881714595767...|                     0E-25|                  0E-25|                 0E-25|                 0E-25|         -0.01774281063483...|                        0E-25|             -15.6010000000000|                          0E-25|                 -0.06749864351600...|    -0.01428571428571...|        -11.6647058823529...|  -11.5187500000000...|                 0E-22|   -1.25656565656565...|\n",
      "|   02390650|    1739.81|        2|    2|              2|                    2|                 1|     1645.00|               0.5|                C|        Q1|        M|            Personal|  33|        10|      0.0|1.000000000000000...|0.267256187645910...|0.732743812354089...|0.099367129315220...|0.146542290063050...|0.432448644875459...|0.321641935746269...|0.042847796779668...|0.390909894904411...|0.170075933234991...|0.396166375080927...|0.510553504104059...|0.545046878596397...|             51360.66|  0.543519842519685...|        0.094318209763858...|  0.0106951871657754|455.1348837209302...|357.1777027027027...|2519.882857142857...|11.46303906748438...|                   296.0|          0|                  0|              0|      0|    -0.10000000000000...|                   0E-25|   -0.10000000000000...|      -0.02492784741845...|   -0.01779593058127...|  -0.00765033920572...|  -0.04962588279454...|                     0E-25|   -0.10000000000000...|                 0E-25|                 0E-25|         -0.03406848687603...|         -0.10000000000000...|           -2000.0010000000000|           -0.01447401574803...|                 -0.00167890099707...|    -0.00416666666666...|        -24.5243947368421...|  -20.5926216216216...|  -170.000000000000...|   -0.13492247653201...|\n",
      "+-----------+-----------+---------+-----+---------------+---------------------+------------------+------------+------------------+-----------------+----------+---------+--------------------+----+----------+---------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+---------------------+----------------------+----------------------------+--------------------+--------------------+--------------------+--------------------+--------------------+------------------------+-----------+-------------------+---------------+-------+------------------------+------------------------+-----------------------+--------------------------+-----------------------+----------------------+----------------------+--------------------------+-----------------------+----------------------+----------------------+-----------------------------+-----------------------------+------------------------------+-------------------------------+-------------------------------------+------------------------+----------------------------+----------------------+----------------------+-----------------------+\n",
      "only showing top 20 rows\n",
      "\n"
     ]
    }
   ],
   "source": [
    "#Quitamos duplicados y cambiamos NA\n",
    "ctes = ctes.drop_duplicates(subset=[\"customer_id\"])\n",
    "ctes.show()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "504620"
      ]
     },
     "execution_count": 7,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "ctes.count()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Data Wrangling"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "metadata": {},
   "outputs": [],
   "source": [
    "###-------------------Tratamiento de variables categoricas a numericas---------------------\n",
    "pivoted = ctes.groupBy(\"customer_id\").pivot(\"gender_id\").agg(F.lit(1))\n",
    "pivoted = pivoted.drop('null').na.fill(0)\n",
    "\n",
    "comercial = ['B1','B2','B3','B4','B5','B6','B7','B8','B9','BA','BB','BC','BF',\n",
    "           'D1','D2','D3','D4','D7','D8','D9','F1','F2','F3','F4','F5','F6',\n",
    "           'F7','F8','FE','FF','FM','H1','N1','R1','R2','R3','R4','R5','R6',\n",
    "           'S0','S1','T1','U1','X1','X2','X3','X4','X5']\n",
    "corporativa = ['C0']\n",
    "beyg = ['E0','E1','E2','E3','G0','G1','G2','G3']\n",
    "personal = ['F9','Q1']\n",
    "patrimonial = ['P0','P1','P2','P3','P4','P5','P6','P7','P8','P9']\n",
    "pyme = ['Y1','Y2']\n",
    "ctes_seg = ctes.withColumn(\"Segmento_descripcion\", F.when(F.col('segment_id').isin(comercial), 'Comercial')\n",
    "                              .when(F.col('segment_id').isin(corporativa), 'Corporativa')\n",
    "                              .when(F.col('segment_id').isin(beyg), 'BEyG')\n",
    "                              .when(F.col('segment_id').isin(personal), 'Personal')\n",
    "                              .when(F.col('segment_id').isin(patrimonial), 'Patrimonial')\n",
    "                              .when(F.col('segment_id').isin(pyme), 'PyME')\n",
    "                              .otherwise('Cliente Nuevo'))\n",
    "\n",
    "pivoted1 = ctes_seg.groupBy(\"customer_id\").pivot(\"Segmento_descripcion\").agg(F.lit(1))\n",
    "pivoted1 = pivoted1.drop('null').na.fill(0)\n",
    "\n",
    "pivoted2 = ctes_seg.groupBy(\"customer_id\").pivot(\"tipo_tarjeta_moda\").agg(F.lit(1))\n",
    "pivoted2 = pivoted2.drop('null').na.fill(0)\n",
    "\n",
    "#----------------------Union de la tabla con las variables dummy creadas\n",
    "ctes_d = ctes_seg.drop('tipo_tarjeta_moda','gender_id','segment_id','Segmento_descripcion')\n",
    "ctes1 = ctes_d.join(pivoted, on = ['customer_id'], how = 'left')\n",
    "ctes2 = ctes1.join(pivoted1, on = ['customer_id'], how = 'left')\n",
    "ctes3 = ctes2.join(pivoted2, on = ['customer_id'], how = 'left')\n",
    "\n",
    "ctes3 = ctes3.withColumn('aclarciones/facturacion', 1/ F.col('facturacion/aclaraciones'))\n",
    "\n",
    "ctes3 = ctes3.fillna(0)\n",
    "#ctes3.columns\n",
    "\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "+-----------+-----------+---------+-----+---------------+---------------------+------------------+------------+------------------+----+----------+---------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+---------------------+----------------------+----------------------------+--------------------+--------------------+--------------------+--------------------+--------------------+------------------------+-----------+-------------------+---------------+-------+------------------------+------------------------+-----------------------+--------------------------+-----------------------+----------------------+----------------------+--------------------------+-----------------------+----------------------+----------------------+-----------------------------+-----------------------------+------------------------------+-------------------------------+-------------------------------------+------------------------+----------------------------+----------------------+----------------------+-----------------------+---+---+----+-------------+---------+-----------+-----------+--------+----+---+---+-----------------------+\n",
      "|customer_id|monto_total|n_tarjeta|n_com|n_reclamaciones|dictamen_afavor_total|NO_CLAIMS_12_MONTH|monto_12_mes|      div_comercio|edad|antiguedad|pendiente|     COMPRAS_CREDITO|     RETIROS_CREDITO|      RETIROS_DEBITO|   COMPRAS_MADRUGADA|      COMPRAS_MANANA|       COMPRAS_TARDE|       COMPRAS_NOCHE|   RETIROS_MADRUGADA|      RETIROS_MANANA|       RETIROS_TARDE|       RETIROS_NOCHE|COMPRAS_ENTRE_SEMANA|RETIROS_ENTRE_SEMANA|MAX_DEBITO_DISPONIBLE|MAX_PORC_ENDEUDAMIENTO|PORCENTAJE_COMPRAS_ECOMMERCE|     razon_comercios| razon_transacciones|       razon_compras|       razon_retiros|      razon_ecomerce|facturacion/aclaraciones|Delta_Monto|Delta_Reclamaciones|Delta_Pendiente|Bandera|COMPRAS_CREDITO_dif_mean|RETIROS_CREDITO_dif_mean|RETIROS_DEBITO_dif_mean|COMPRAS_MADRUGADA_dif_mean|COMPRAS_MANANA_dif_mean|COMPRAS_TARDE_dif_mean|COMPRAS_NOCHE_dif_mean|RETIROS_MADRUGADA_dif_mean|RETIROS_MANANA_dif_mean|RETIROS_TARDE_dif_mean|RETIROS_NOCHE_dif_mean|COMPRAS_ENTRE_SEMANA_dif_mean|RETIROS_ENTRE_SEMANA_dif_mean|MAX_DEBITO_DISPONIBLE_dif_mean|MAX_PORC_ENDEUDAMIENTO_dif_mean|PORCENTAJE_COMPRAS_ECOMMERCE_dif_mean|razon_comercios_dif_mean|razon_transacciones_dif_mean|razon_compras_dif_mean|razon_retiros_dif_mean|razon_ecomerce_dif_mean|  F|  M|BEyG|Cliente Nuevo|Comercial|Corporativa|Patrimonial|Personal|PyME|  C|  D|aclarciones/facturacion|\n",
      "+-----------+-----------+---------+-----+---------------+---------------------+------------------+------------+------------------+----+----------+---------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+---------------------+----------------------+----------------------------+--------------------+--------------------+--------------------+--------------------+--------------------+------------------------+-----------+-------------------+---------------+-------+------------------------+------------------------+-----------------------+--------------------------+-----------------------+----------------------+----------------------+--------------------------+-----------------------+----------------------+----------------------+-----------------------------+-----------------------------+------------------------------+-------------------------------+-------------------------------------+------------------------+----------------------------+----------------------+----------------------+-----------------------+---+---+----+-------------+---------+-----------+-----------+--------+----+---+---+-----------------------+\n",
      "|   00035838|     302.60|        1|    2|              5|                    5|                 4|      245.29|               0.8|  41|        19|  -133.97|               0E-20|               0E-20|1.000000000000000...|0.065294272678777...|0.114549033890350...|0.546681662275965...|0.273475031154906...|               0E-20|0.147058823529411...|0.431372549019607...|0.421568627450980...|0.627636704151962...|0.490196078431372...|              5811.54|                 0E-20|        0.232784467690041...| 0.06451612903225806|211.6773577235772...|163.5709146341463...|728.5714285714285...|20.63645076007931...|                    32.8|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|      -0.00537950242703...|   -0.00491930546273...|  -0.05944984453346...|  -0.03025134757676...|                     0E-25|                  0E-25|  -0.10000000000000...|                 0E-25|         -0.08044723141504...|         -0.10000000000000...|            -581.1540000000000|                          0E-25|                 -0.03001284549787...|    -0.03333333333333333|        -23.4107222222222...|  -17.8495000000000...|  -150.000000000000...|   -0.24785194976867...|  1|  0|   0|            0|        1|          0|          0|       0|   0|  0|  1|   0.030487804878048783|\n",
      "|   00054168|     910.00|        1|    2|              2|                    2|                 1|       95.00|               0.5|  32|        11|      0.0|               0E-20|               0E-20|0.992300544271870...|0.127441894563249...|0.512441207735568...|0.285136049270907...|0.074980848430274...|               0E-20|0.399309703969202...|0.247245453338643...|0.353444842692154...|0.373703497045159...|0.613965219699986...|             47355.17|                 0E-20|        0.143899470642837...| 0.11764705882352941|2157.447964601769...|303.4632584269662...|3348.000000000000...|4.270846153846153...|                    44.5|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|                     0E-25|   -0.00172790567667...|  -0.09249377445748...|  -0.00577831986583...|                     0E-25|                  0E-25|                 0E-25|  -0.10000000000000...|         -0.00965594348732...|         -0.10000000000000...|           -1085.5040000000000|                          0E-25|                                0E-25|                  -0.025|        -159.552058823529...|  -19.6770000000000...|  -515.000000000000...|                  0E-25|  1|  0|   0|            0|        1|          0|          0|       0|   0|  0|  1|    0.02247191011235955|\n",
      "|   00147123|    3600.00|        1|    1|              3|                    3|                 0|        0.00|               1.0|  29|        11|      0.0|0.000475816393873...|               0E-20|1.000000000000000...|0.004956103558583...|0.104494038258492...|0.409185920973558...|0.481363937209365...|               0E-20|0.581395348837209...|0.418604651162790...|               0E-20|0.908869740979829...|0.534883720930232...|             13899.98|  0.666666666666666...|                       0E-20| 0.08333333333333333|1362.276578947368...|840.6604000000000...|5016.666666666666...|               0E-20|       8.333333333333334|          0|                  0|              0|      0|    -0.00020686117133...|                   0E-25|   -0.10000000000000...|      -0.00049977658993...|                  0E-25|  -0.00020686117133...|  -0.09929336223873...|                     0E-25|   -0.10000000000000...|                 0E-25|                 0E-25|         -0.09979313882866...|                        0E-25|            -831.5740000000000|           -0.06666666666666...|                                0E-25|    -0.03333333333333333|        -149.177000000000...|  -80.5693333333333...|  -700.000000000000...|                  0E-25|  1|  0|   0|            0|        1|          0|          0|       0|   0|  0|  1|                   0.12|\n",
      "|   00152272|    1053.90|        1|    2|              4|                    4|                 1|       99.00|               0.5|  27|        11|      0.0|               0E-20|               0E-20|1.000000000000000...|0.168606118600467...|0.196139735720107...|0.521015851864567...|0.114238293814857...|               0E-20|0.291954022988505...|0.535632183908045...|0.172413793103448...|0.493490733037196...|0.636781609195402...|             36238.06|                 0E-20|        0.397269668660082...| 0.16666666666666666|780.7880000000000...|301.7197435897435...|1359.375000000000...|4.435620077806243...|                    9.75|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|      -0.02930359648475...|   -0.00146222583265...|  -0.06807030499963...|  -0.00116387268296...|                     0E-25|                  0E-25|  -0.10000000000000...|                 0E-25|         -0.04711173473155...|         -0.02931034482758...|           -3623.8060000000000|                          0E-25|                 -0.06904512222140...|                   -0.05|        -42.4854838709677...|  -32.2404761904761...|  -82.8571428571428...|   -0.44356200778062...|  1|  0|   0|            0|        1|          0|          0|       0|   0|  0|  1|    0.10256410256410256|\n",
      "|   00194397|      99.00|        1|    1|              1|                    1|                 0|        0.00|               1.0|  28|        11|      0.0|               0E-20|               0E-20|1.000000000000000...|0.103444808238909...|0.043921526871988...|0.692807369351943...|0.159826295537158...|               0E-20|               0E-20|1.000000000000000...|               0E-20|0.785044794042052...|               0E-20|            135621.65|                 0E-20|        0.088864931692413...|                 0.1|707.8614285714285...|563.5050000000000...|3000.000000000000...|12.13959595959595...|                    24.0|          0|                  0|              0|      0|                   0E-25|                   0E-25|                  0E-25|                     0E-25|                  0E-25|  -0.10000000000000...|                 0E-25|                     0E-25|                  0E-25|                 0E-25|                 0E-25|         -0.10000000000000...|                        0E-25|          -11837.6850000000000|                          0E-25|                                0E-25|                    -0.1|        -158.551000000000...|  -158.551000000000...|                 0E-22|                  0E-25|  1|  0|   0|            0|        0|          0|          0|       1|   0|  0|  1|   0.041666666666666664|\n",
      "|   00444268|     251.00|        1|    2|              2|                    2|                 1|      151.00|               0.5|  26|        11|      0.0|0.455541602660661...|0.064039408866995...|0.935960591133004...|0.070778362738810...|0.119415370389703...|0.569920209989411...|0.239886056882074...|               0E-20|0.133004926108374...|0.724137931034482...|0.142857142857142...|0.597687730235194...|0.408866995073891...|              3417.75|  0.577727272727272...|        0.089484124024995...| 0.08333333333333333|222.9747023809523...|169.3207070707070...|312.3076923076923...|5.976095617529880...|                    49.5|          0|                  0|              0|      0|    -0.09630750348305...|    -0.01142857142857...|   -0.18857142857142...|                     0E-25|   -0.01927831652451...|  -0.16945703943824...|  -0.01126464403724...|                     0E-25|   -0.03142857142857...|  -0.13142857142857...|  -0.03714285714285...|         -0.20000000000000...|         -0.06428571428571...|            -184.9410000000000|           -0.02566500000000...|                                0E-25|                  -0.045|        -35.3692727272727...|  -25.2756388888888...|  -51.9230769230769...|                  0E-25|  0|  1|   0|            0|        1|          0|          0|       0|   0|  0|  1|   0.020202020202020204|\n",
      "|   00447923|    2739.00|        1|    4|              4|                    3|                 3|     2089.00|              0.25|  26|        11|      0.0|               0E-20|               0E-20|1.000000000000000...|               0E-20|0.371781115879828...|0.583261802575107...|0.044957081545064...|               0E-20|0.375036374974017...|0.507888172937019...|0.117075452088962...|0.955042918454935...|0.721159842028684...|             14217.08|                 0E-20|        0.008583690987124...|                 0.4|864.5909090909090...|548.2352941176470...|1436.119402985074...|0.029207740051113...|                    4.25|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|                     0E-25|                  0E-25|  -0.10000000000000...|                 0E-25|                     0E-25|                  0E-25|  -0.08333333333333...|  -0.01666666666666...|         -0.10000000000000...|         -0.10000000000000...|            -206.0720000000000|                          0E-25|                                0E-25|                    -0.1|        -65.6250000000000...|  -65.0000000000000...|  -120.000000000000...|                  0E-25|  1|  0|   0|            0|        1|          0|          0|       0|   0|  0|  1|    0.23529411764705882|\n",
      "|   00458134|     768.00|        1|    1|              1|                    1|                 0|        0.00|               1.0|  28|        11|      0.0|0.429717543001600...|0.015160374605859...|0.984839625394140...|0.063369268930590...|0.215006873998695...|0.439986663786686...|0.281637193284027...|0.011864742403077...|0.528305002480470...|0.205196603236436...|0.254633651880014...|0.624758049975534...|0.867411095481671...|             13735.58|  0.994913333333333...|        0.052575042809954...|0.016129032258064516|832.5283024691358...|415.2228125000000...|1405.735409836065...|6.367187500000000...|                   224.0|          0|                  0|              0|      0|    -0.05849676890093...|                   0E-25|   -0.10000000000000...|      -0.02977749788812...|   -0.00457446776067...|  -0.02158874314973...|  -0.04405929120146...|                     0E-25|   -0.05437500000000...|  -0.03312500000000...|  -0.01250000000000...|         -0.07006346311606...|         -0.10000000000000...|            -301.9960000000000|           -0.08266088888888...|                                0E-25|    -0.00833333333333...|        -106.520350000000...|  -25.2236153846153...|  -160.000000000000...|                  0E-25|  0|  1|   0|            0|        1|          0|          0|       0|   0|  0|  1|   0.004464285714285714|\n",
      "|   00461820|     100.00|        1|    1|              1|                    1|                 0|        0.00|               1.0|  27|        11|      0.0|0.791631935267448...|               0E-20|1.000000000000000...|               0E-20|0.046557017098013...|0.202675503689999...|0.750767479211986...|               0E-20|0.164974619289340...|0.479332849891225...|0.355692530819434...|0.159147742289629...|0.211747643219724...|             11557.36|  0.028666666666666...|        0.020330575151971...| 0.07142857142857142|666.2743842364532...|273.2611111111111...|1970.000000000000...|1.000000000000000...|                    18.0|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|                     0E-25|   -0.02439024390243...|  -0.07560975609756...|                 0E-25|                     0E-25|   -0.00057971014492...|  -0.09739130434782...|  -0.00202898550724...|                        0E-25|         -0.00260869565217...|            -637.1360000000000|                          0E-25|                 -0.02439024390243...|    -0.03333333333333333|        -79.6969696969696...|  -8.20000000000000...|  -246.428571428571...|   -0.10000000000000...|  0|  1|   0|            0|        1|          0|          0|       0|   0|  0|  1|    0.05555555555555555|\n",
      "|   00475697|     753.11|        1|    1|              1|                    1|                 0|        0.00|               1.0|  26|        11|      0.0|               0E-20|               0E-20|1.000000000000000...|0.057199032746502...|0.086195486961605...|0.469515753217079...|0.387089727074811...|0.042338709677419...|0.121975806451612...|0.376008064516129...|0.459677419354838...|0.453035009917651...|0.444556451612903...|              8525.32|                 0E-20|        0.076524690402970...|0.012195121951219513|388.8908370044052...|248.3037410071942...|604.8780487804878...|3.507044123700389...|                   139.0|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|      -0.00255737021697...|   -0.00263707639811...|  -0.00423745148602...|  -0.09056810189888...|                     0E-25|                  0E-25|  -0.04210526315789...|  -0.05789473684210...|         -0.05247531973639...|         -0.06315789473684...|            -153.8900000000000|                          0E-25|                 -0.01037196217863...|                   -0.01|        -23.9129166666666...|  -20.2057894736842...|  -38.0000000000000...|   -0.05287275431211...|  0|  1|   0|            0|        1|          0|          0|       0|   0|  0|  1|   0.007194244604316547|\n",
      "|   00522122|     178.00|        2|    2|              2|                    2|                 0|        0.00|               0.5|  40|        11|      0.0|0.473876011866207...|               0E-20|1.000000000000000...|0.070043374373439...|0.183346394947702...|0.552042413562021...|0.194567817116836...|0.009033423667570...|0.434507678410117...|0.478771454381210...|0.077687443541102...|0.486684338400024...|0.610659439927732...|            119380.30|  0.944426969222743...|        0.052608747870185...| 0.02127659574468085|1019.586846590909...|774.6092307692307...|1064.423076923076...|50.59561797752808...|                   110.5|          0|                  0|              0|      0|    -0.01658413433474...|                   0E-25|   -0.10000000000000...|      -0.00002116005759...|   -0.03761358329766...|  -0.05846159084718...|  -0.00390366579756...|                     0E-25|   -0.06969696969696...|  -0.03030303030303...|                 0E-25|         -0.01916225629450...|         -0.06666666666666...|           -6004.6570000000000|           -0.00117704225352...|                                0E-25|    -0.01428571428571...|        -98.0160000000000...|  -68.5253333333333...|  -82.5000000000000...|                  0E-25|  0|  1|   0|            0|        1|          0|          0|       0|   0|  1|  0|    0.00904977375565611|\n",
      "|   00529362|      51.00|        1|    1|              1|                    1|                 0|        0.00|               1.0|  32|        11|      0.0|               0E-20|               0E-20|1.000000000000000...|0.031129679691980...|0.102400262144671...|0.303416072745146...|0.563053985418202...|               0E-20|0.170560747663551...|0.829439252336448...|               0E-20|0.136260615493842...|0.446261682242990...|              8726.09|                 0E-20|        0.004096010485786...| 0.08333333333333333|709.0282051282051...|197.9513513513513...|3566.666666666666...|0.588235294117647...|                    37.0|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|                     0E-25|   -0.08349514563106...|                 0E-25|  -0.01650485436893...|                     0E-25|                  0E-25|  -0.10000000000000...|                 0E-25|         -0.08349514563106...|         -0.10000000000000...|             -26.8660000000000|                          0E-25|                                0E-25|    -0.03333333333333333|        -72.3166666666666...|  -10.3000000000000...|  -380.000000000000...|                  0E-25|  1|  0|   0|            0|        0|          0|          0|       1|   0|  0|  1|    0.02702702702702703|\n",
      "|   00731582|      98.00|        1|    1|              2|                    2|                 0|        0.00|               1.0|  44|        11|      0.0|0.908036173766601...|               0E-20|1.000000000000000...|0.002261920025374...|0.328565146581530...|0.404970184263125...|0.264202749129969...|               0E-20|0.755752212389380...|0.226548672566371...|0.017699115044247...|0.411707873240645...|0.751327433628318...|             49827.18|  0.697592692307692...|        0.024122614149432...| 0.00909090909090909|1064.582133333333...|871.1455384615384...|2404.255319148936...|69.69030612244897...|                   162.5|          0|                  0|              0|      0|    -0.08990654450337...|                   0E-25|   -0.10000000000000...|      -0.00183303122263...|   -0.01540604551154...|  -0.07989499349710...|  -0.00286592976871...|                     0E-25|                  0E-25|  -0.10000000000000...|                 0E-25|         -0.06306740317667...|                        0E-25|           -2004.3780000000000|           -0.03673076923076...|                 -0.01210848053349...|    -0.00666666666666...|        -74.7441818181818...|  -72.3564210526315...|  -200.000000000000...|   -1.69861224489795...|  0|  1|   0|            0|        0|          0|          0|       1|   0|  0|  1|   0.006153846153846154|\n",
      "|   00971551|    3182.00|        1|    2|              3|                    3|                 2|     1432.00|0.6666666666666666|  30|        11|      0.0|0.306236498370886...|               0E-20|1.000000000000000...|0.015708941735873...|0.627418738930048...|0.220389465491448...|0.136482853842629...|               0E-20|0.123386109685316...|0.518221660678327...|0.358392229636356...|0.732702845804695...|0.567862360326923...|             31111.14|  0.916483333333333...|        0.043054084541000...| 0.06451612903225806|887.7444715447154...|758.7356000000000...|2894.514285714285...|0.769956002514142...|                    25.0|          0|                  0|              0|      0|    -0.08702484434984...|                   0E-25|                  0E-25|      -0.00949416187615...|   -0.09050583812384...|                 0E-25|                 0E-25|                     0E-25|                  0E-25|                 0E-25|                 0E-25|         -0.09050583812384...|                        0E-25|             -58.0870000000000|           -0.05581666666666...|                                0E-25|                   -0.05|        -27.0115000000000...|  -33.5153333333333...|                 0E-22|                  0E-25|  1|  0|   0|            0|        1|          0|          0|       0|   0|  1|  0|                   0.04|\n",
      "|   01146807|    1157.00|        1|    1|              3|                    3|                 0|        0.00|               1.0|  38|        16|      0.0|               0E-20|               0E-20|1.000000000000000...|0.009772658039728...|0.152037467138336...|0.497329687222117...|0.340860187599817...|0.009920634920634...|0.313492063492063...|0.490079365079365...|0.186507936507936...|0.473036268006782...|0.488095238095238...|              9122.52|                 0E-20|        0.296432891773534...| 0.01818181818181818|464.9611724137931...|220.5479611650485...|446.0176991150442...|5.820138288677614...|      34.333333333333336|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|                     0E-25|   -0.02611978074425...|  -0.01070245722632...|  -0.06317776202941...|                     0E-25|   -0.02244897959183...|  -0.04897959183673...|  -0.02857142857142...|         -0.06273953979433...|         -0.03877551020408...|            -912.2520000000000|                          0E-25|                                0E-25|    -0.00909090909090909|        -67.0069354838709...|  -26.5934615384615...|  -44.5454545454545...|                  0E-25|  0|  1|   0|            0|        1|          0|          0|       0|   0|  0|  1|   0.029126213592233007|\n",
      "|   02039499|     448.35|        1|    1|              1|                    0|                 0|        0.00|               1.0|  41|        11|      0.0|0.058588760477428...|               0E-20|1.000000000000000...|0.016325126166080...|0.294659151319191...|0.540437230099257...|0.148578492415470...|0.043140638481449...|0.311475409836065...|0.570319240724762...|0.075064710957722...|0.845943023179603...|0.322691975841242...|             11761.76|  1.270313333333333...|        0.053344402449770...| 0.02702702702702703|1519.275277777777...|450.2262295081967...|3996.551724137931...|3.267625738820118...|                    61.0|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|      -0.03812986350299...|   -0.01700897223285...|  -0.04486116426414...|                 0E-25|                     0E-25|                  0E-25|  -0.04210526315789...|  -0.05789473684210...|         -0.10000000000000...|         -0.10000000000000...|           -1046.4490000000000|                          0E-25|                                0E-25|    -0.03333333333333333|        -81.9538888888888...|  -39.1950000000000...|  -126.666666666666...|                  0E-25|  1|  0|   0|            0|        1|          0|          0|       0|   0|  0|  1|    0.01639344262295082|\n",
      "|   02116751|     100.00|        1|    1|              1|                    1|                 0|        0.00|               1.0|  57|        10|      0.0|               0E-20|               0E-20|1.000000000000000...|0.093513452036444...|0.175159156928429...|0.444634487123769...|0.286692903911356...|               0E-20|0.145867098865478...|0.486223662884927...|0.367909238249594...|0.628803242092701...|0.706464973887988...|             20570.65|                 0E-20|        0.153291733949284...|                0.05|386.9962734584450...|108.3368452380952...|1354.390243902439...|27.90000000000000...|                   168.0|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|                     0E-25|   -0.02175692695214...|  -0.04093198992443...|  -0.03731108312342...|                     0E-25|                  0E-25|  -0.06000000000000...|  -0.04000000000000...|         -0.07257556675062...|         -0.04000000000000...|            -935.8530000000000|                          0E-25|                 -0.00944584382871...|                 -0.0125|        -16.1583333333333...|  -9.07428571428571...|  -100.000000000000...|   -0.30000000000000...|  1|  0|   0|            0|        1|          0|          0|       0|   0|  0|  1|   0.005952380952380952|\n",
      "|   02133818|    3075.80|        1|    1|              1|                    1|                 0|        0.00|               1.0|  29|        10|      0.0|               0E-20|               0E-20|1.000000000000000...|0.005023286722470...|0.223532610952897...|0.566425249564742...|0.205018852759889...|               0E-20|0.633893919793014...|0.256144890038809...|0.109961190168175...|0.467667713231505...|0.553040103492884...|              9837.32|                 0E-20|        0.041454743834827...|0.017857142857142856|542.6802285714285...|326.9177981651376...|417.8378378378378...|0.480265296833344...|                   109.0|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|      -0.00053894630422...|   -0.02890796469715...|  -0.04418802163962...|  -0.02636506735899...|                     0E-25|   -0.10000000000000...|                 0E-25|                 0E-25|         -0.04244053470907...|         -0.10000000000000...|            -983.7320000000000|                          0E-25|                 -0.00278765329770...|    -0.00909090909090909|        -56.0639411764705...|  -44.8405833333333...|  -50.0000000000000...|   -0.00487678002470...|  0|  1|   0|            0|        1|          0|          0|       0|   0|  0|  1|   0.009174311926605505|\n",
      "|   02295358|      99.00|        1|    1|              1|                    1|                 0|        0.00|               1.0|  22|        11|      0.0|               0E-20|               0E-20|0.990990990990990...|0.168643422699437...|0.307679819362683...|0.119136307123196...|0.404540450814681...|0.180180180180180...|               0E-20|0.342342342342342...|0.477477477477477...|0.273454150276530...|0.315315315315315...|              3200.00|                 0E-20|        0.285848944860392...|                0.04|253.0200714285714...|112.8300000000000...|326.4705882352941...|34.85858585858585...|                   107.0|          0|                  0|              0|      0|                   0E-25|                   0E-25|                  0E-25|      -0.02148670645686...|   -0.01806836679327...|  -0.00162778079218...|  -0.05881714595767...|                     0E-25|                  0E-25|                 0E-25|                 0E-25|         -0.01774281063483...|                        0E-25|             -15.6010000000000|                          0E-25|                 -0.06749864351600...|    -0.01428571428571...|        -11.6647058823529...|  -11.5187500000000...|                 0E-22|   -1.25656565656565...|  0|  1|   0|            0|        1|          0|          0|       0|   0|  0|  1|   0.009345794392523364|\n",
      "|   02390650|    1739.81|        2|    2|              2|                    2|                 1|     1645.00|               0.5|  33|        10|      0.0|1.000000000000000...|0.267256187645910...|0.732743812354089...|0.099367129315220...|0.146542290063050...|0.432448644875459...|0.321641935746269...|0.042847796779668...|0.390909894904411...|0.170075933234991...|0.396166375080927...|0.510553504104059...|0.545046878596397...|             51360.66|  0.543519842519685...|        0.094318209763858...|  0.0106951871657754|455.1348837209302...|357.1777027027027...|2519.882857142857...|11.46303906748438...|                   296.0|          0|                  0|              0|      0|    -0.10000000000000...|                   0E-25|   -0.10000000000000...|      -0.02492784741845...|   -0.01779593058127...|  -0.00765033920572...|  -0.04962588279454...|                     0E-25|   -0.10000000000000...|                 0E-25|                 0E-25|         -0.03406848687603...|         -0.10000000000000...|           -2000.0010000000000|           -0.01447401574803...|                 -0.00167890099707...|    -0.00416666666666...|        -24.5243947368421...|  -20.5926216216216...|  -170.000000000000...|   -0.13492247653201...|  0|  1|   0|            0|        0|          0|          0|       1|   0|  1|  0|   0.003378378378378...|\n",
      "+-----------+-----------+---------+-----+---------------+---------------------+------------------+------------+------------------+----+----------+---------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+---------------------+----------------------+----------------------------+--------------------+--------------------+--------------------+--------------------+--------------------+------------------------+-----------+-------------------+---------------+-------+------------------------+------------------------+-----------------------+--------------------------+-----------------------+----------------------+----------------------+--------------------------+-----------------------+----------------------+----------------------+-----------------------------+-----------------------------+------------------------------+-------------------------------+-------------------------------------+------------------------+----------------------------+----------------------+----------------------+-----------------------+---+---+----+-------------+---------+-----------+-----------+--------+----+---+---+-----------------------+\n",
      "only showing top 20 rows\n",
      "\n"
     ]
    }
   ],
   "source": [
    "ctes3.show() \n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Creando Vector"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "metadata": {},
   "outputs": [],
   "source": [
    "\n",
    "vecAssembler = VectorAssembler(inputCols=[\n",
    " 'monto_total',\n",
    " 'n_tarjeta',\n",
    " 'n_com',\n",
    " 'n_reclamaciones',\n",
    " 'dictamen_afavor_total',\n",
    " 'div_comercio',\n",
    " 'pendiente',\n",
    " 'COMPRAS_CREDITO',\n",
    " 'RETIROS_DEBITO',\n",
    " 'COMPRAS_MADRUGADA',\n",
    " 'COMPRAS_MANANA',\n",
    " 'COMPRAS_TARDE',\n",
    " 'COMPRAS_NOCHE',\n",
    " 'RETIROS_MADRUGADA',\n",
    " 'RETIROS_MANANA',\n",
    " 'RETIROS_TARDE',\n",
    " 'RETIROS_NOCHE',\n",
    " 'COMPRAS_ENTRE_SEMANA',\n",
    " 'RETIROS_ENTRE_SEMANA',\n",
    " 'MAX_DEBITO_DISPONIBLE',\n",
    " 'MAX_PORC_ENDEUDAMIENTO',\n",
    " 'razon_transacciones',\n",
    " 'razon_compras',\n",
    " 'razon_retiros',\n",
    " 'razon_ecomerce',\n",
    " 'aclarciones/facturacion',\n",
    " 'BEyG',\n",
    " 'Comercial',\n",
    " 'Corporativa',\n",
    " 'Patrimonial',\n",
    " 'Personal',\n",
    " 'C',\n",
    " 'Delta_Monto',\n",
    " 'Delta_Reclamaciones',\n",
    " 'Delta_Pendiente',\n",
    " 'Bandera',\n",
    "'COMPRAS_CREDITO_dif_mean', 'RETIROS_CREDITO_dif_mean', 'RETIROS_DEBITO_dif_mean', 'COMPRAS_MADRUGADA_dif_mean', 'COMPRAS_MANANA_dif_mean', 'COMPRAS_TARDE_dif_mean', 'COMPRAS_NOCHE_dif_mean', 'RETIROS_MADRUGADA_dif_mean', 'RETIROS_MANANA_dif_mean', 'RETIROS_TARDE_dif_mean', 'RETIROS_NOCHE_dif_mean', 'COMPRAS_ENTRE_SEMANA_dif_mean', 'RETIROS_ENTRE_SEMANA_dif_mean', 'MAX_DEBITO_DISPONIBLE_dif_mean', 'MAX_PORC_ENDEUDAMIENTO_dif_mean', 'PORCENTAJE_COMPRAS_ECOMMERCE_dif_mean', 'razon_comercios_dif_mean', 'razon_transacciones_dif_mean', 'razon_compras_dif_mean', 'razon_retiros_dif_mean', 'razon_ecomerce_dif_mean'\n",
    "    ], outputCol=\"features\")\n",
    "#print(vecAssembler)\n",
    "n_ctes = vecAssembler.transform(ctes3)\n",
    "#n_ctes.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## M√©todo del Codo"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 1440x720 with 1 Axes>"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "dataset = n_ctes\n",
    "# Calcular el coste y gr√°ficar\n",
    "cost = np.zeros(15)\n",
    "\n",
    "for k in range(2,15):\n",
    "    kmeans = KMeans().setK(k).setSeed(1).setFeaturesCol('features')\n",
    "    model = kmeans.fit(dataset.select('features'))\n",
    "    cost[k] = model.computeCost(dataset.select('features'))\n",
    "\n",
    "# Gr√°fica del coste\n",
    "df_cost = pd.DataFrame(cost[2:])\n",
    "df_cost.columns = [\"cost\"]\n",
    "\n",
    "new_col = [2,3,4,5,6,7,8, 9,10,11,12,13,14]\n",
    "df_cost.insert(0, 'cluster', new_col)\n",
    "\n",
    "import pylab as pl\n",
    "pl.figure(figsize=(20, 10))\n",
    "pl.plot(df_cost.cluster, df_cost.cost)\n",
    "pl.xlabel('Numero de Clusters')\n",
    "pl.ylabel('Score')\n",
    "pl.title('Curva de Codo')\n",
    "pl.show()\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## K - Means"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "+-----------+-----------+---------+-----+---------------+---------------------+------------------+------------+------------------+----+----------+---------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+---------------------+----------------------+----------------------------+--------------------+--------------------+--------------------+--------------------+--------------------+------------------------+-----------+-------------------+---------------+-------+------------------------+------------------------+-----------------------+--------------------------+-----------------------+----------------------+----------------------+--------------------------+-----------------------+----------------------+----------------------+-----------------------------+-----------------------------+------------------------------+-------------------------------+-------------------------------------+------------------------+----------------------------+----------------------+----------------------+-----------------------+---+---+----+-------------+---------+-----------+-----------+--------+----+---+---+-----------------------+--------------------+----------+\n",
      "|customer_id|monto_total|n_tarjeta|n_com|n_reclamaciones|dictamen_afavor_total|NO_CLAIMS_12_MONTH|monto_12_mes|      div_comercio|edad|antiguedad|pendiente|     COMPRAS_CREDITO|     RETIROS_CREDITO|      RETIROS_DEBITO|   COMPRAS_MADRUGADA|      COMPRAS_MANANA|       COMPRAS_TARDE|       COMPRAS_NOCHE|   RETIROS_MADRUGADA|      RETIROS_MANANA|       RETIROS_TARDE|       RETIROS_NOCHE|COMPRAS_ENTRE_SEMANA|RETIROS_ENTRE_SEMANA|MAX_DEBITO_DISPONIBLE|MAX_PORC_ENDEUDAMIENTO|PORCENTAJE_COMPRAS_ECOMMERCE|     razon_comercios| razon_transacciones|       razon_compras|       razon_retiros|      razon_ecomerce|facturacion/aclaraciones|Delta_Monto|Delta_Reclamaciones|Delta_Pendiente|Bandera|COMPRAS_CREDITO_dif_mean|RETIROS_CREDITO_dif_mean|RETIROS_DEBITO_dif_mean|COMPRAS_MADRUGADA_dif_mean|COMPRAS_MANANA_dif_mean|COMPRAS_TARDE_dif_mean|COMPRAS_NOCHE_dif_mean|RETIROS_MADRUGADA_dif_mean|RETIROS_MANANA_dif_mean|RETIROS_TARDE_dif_mean|RETIROS_NOCHE_dif_mean|COMPRAS_ENTRE_SEMANA_dif_mean|RETIROS_ENTRE_SEMANA_dif_mean|MAX_DEBITO_DISPONIBLE_dif_mean|MAX_PORC_ENDEUDAMIENTO_dif_mean|PORCENTAJE_COMPRAS_ECOMMERCE_dif_mean|razon_comercios_dif_mean|razon_transacciones_dif_mean|razon_compras_dif_mean|razon_retiros_dif_mean|razon_ecomerce_dif_mean|  F|  M|BEyG|Cliente Nuevo|Comercial|Corporativa|Patrimonial|Personal|PyME|  C|  D|aclarciones/facturacion|            features|prediction|\n",
      "+-----------+-----------+---------+-----+---------------+---------------------+------------------+------------+------------------+----+----------+---------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+---------------------+----------------------+----------------------------+--------------------+--------------------+--------------------+--------------------+--------------------+------------------------+-----------+-------------------+---------------+-------+------------------------+------------------------+-----------------------+--------------------------+-----------------------+----------------------+----------------------+--------------------------+-----------------------+----------------------+----------------------+-----------------------------+-----------------------------+------------------------------+-------------------------------+-------------------------------------+------------------------+----------------------------+----------------------+----------------------+-----------------------+---+---+----+-------------+---------+-----------+-----------+--------+----+---+---+-----------------------+--------------------+----------+\n",
      "|   00035838|     302.60|        1|    2|              5|                    5|                 4|      245.29|               0.8|  41|        19|  -133.97|               0E-20|               0E-20|1.000000000000000...|0.065294272678777...|0.114549033890350...|0.546681662275965...|0.273475031154906...|               0E-20|0.147058823529411...|0.431372549019607...|0.421568627450980...|0.627636704151962...|0.490196078431372...|              5811.54|                 0E-20|        0.232784467690041...| 0.06451612903225806|211.6773577235772...|163.5709146341463...|728.5714285714285...|20.63645076007931...|                    32.8|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|      -0.00537950242703...|   -0.00491930546273...|  -0.05944984453346...|  -0.03025134757676...|                     0E-25|                  0E-25|  -0.10000000000000...|                 0E-25|         -0.08044723141504...|         -0.10000000000000...|            -581.1540000000000|                          0E-25|                 -0.03001284549787...|    -0.03333333333333333|        -23.4107222222222...|  -17.8495000000000...|  -150.000000000000...|   -0.24785194976867...|  1|  0|   0|            0|        1|          0|          0|       0|   0|  0|  1|   0.030487804878048783|[302.6,1.0,2.0,5....|         0|\n",
      "|   00054168|     910.00|        1|    2|              2|                    2|                 1|       95.00|               0.5|  32|        11|      0.0|               0E-20|               0E-20|0.992300544271870...|0.127441894563249...|0.512441207735568...|0.285136049270907...|0.074980848430274...|               0E-20|0.399309703969202...|0.247245453338643...|0.353444842692154...|0.373703497045159...|0.613965219699986...|             47355.17|                 0E-20|        0.143899470642837...| 0.11764705882352941|2157.447964601769...|303.4632584269662...|3348.000000000000...|4.270846153846153...|                    44.5|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|                     0E-25|   -0.00172790567667...|  -0.09249377445748...|  -0.00577831986583...|                     0E-25|                  0E-25|                 0E-25|  -0.10000000000000...|         -0.00965594348732...|         -0.10000000000000...|           -1085.5040000000000|                          0E-25|                                0E-25|                  -0.025|        -159.552058823529...|  -19.6770000000000...|  -515.000000000000...|                  0E-25|  1|  0|   0|            0|        1|          0|          0|       0|   0|  0|  1|    0.02247191011235955|(57,[0,1,2,3,4,5,...|         0|\n",
      "|   00147123|    3600.00|        1|    1|              3|                    3|                 0|        0.00|               1.0|  29|        11|      0.0|0.000475816393873...|               0E-20|1.000000000000000...|0.004956103558583...|0.104494038258492...|0.409185920973558...|0.481363937209365...|               0E-20|0.581395348837209...|0.418604651162790...|               0E-20|0.908869740979829...|0.534883720930232...|             13899.98|  0.666666666666666...|                       0E-20| 0.08333333333333333|1362.276578947368...|840.6604000000000...|5016.666666666666...|               0E-20|       8.333333333333334|          0|                  0|              0|      0|    -0.00020686117133...|                   0E-25|   -0.10000000000000...|      -0.00049977658993...|                  0E-25|  -0.00020686117133...|  -0.09929336223873...|                     0E-25|   -0.10000000000000...|                 0E-25|                 0E-25|         -0.09979313882866...|                        0E-25|            -831.5740000000000|           -0.06666666666666...|                                0E-25|    -0.03333333333333333|        -149.177000000000...|  -80.5693333333333...|  -700.000000000000...|                  0E-25|  1|  0|   0|            0|        1|          0|          0|       0|   0|  0|  1|                   0.12|(57,[0,1,2,3,4,5,...|         0|\n",
      "|   00152272|    1053.90|        1|    2|              4|                    4|                 1|       99.00|               0.5|  27|        11|      0.0|               0E-20|               0E-20|1.000000000000000...|0.168606118600467...|0.196139735720107...|0.521015851864567...|0.114238293814857...|               0E-20|0.291954022988505...|0.535632183908045...|0.172413793103448...|0.493490733037196...|0.636781609195402...|             36238.06|                 0E-20|        0.397269668660082...| 0.16666666666666666|780.7880000000000...|301.7197435897435...|1359.375000000000...|4.435620077806243...|                    9.75|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|      -0.02930359648475...|   -0.00146222583265...|  -0.06807030499963...|  -0.00116387268296...|                     0E-25|                  0E-25|  -0.10000000000000...|                 0E-25|         -0.04711173473155...|         -0.02931034482758...|           -3623.8060000000000|                          0E-25|                 -0.06904512222140...|                   -0.05|        -42.4854838709677...|  -32.2404761904761...|  -82.8571428571428...|   -0.44356200778062...|  1|  0|   0|            0|        1|          0|          0|       0|   0|  0|  1|    0.10256410256410256|[1053.9,1.0,2.0,4...|         0|\n",
      "|   00194397|      99.00|        1|    1|              1|                    1|                 0|        0.00|               1.0|  28|        11|      0.0|               0E-20|               0E-20|1.000000000000000...|0.103444808238909...|0.043921526871988...|0.692807369351943...|0.159826295537158...|               0E-20|               0E-20|1.000000000000000...|               0E-20|0.785044794042052...|               0E-20|            135621.65|                 0E-20|        0.088864931692413...|                 0.1|707.8614285714285...|563.5050000000000...|3000.000000000000...|12.13959595959595...|                    24.0|          0|                  0|              0|      0|                   0E-25|                   0E-25|                  0E-25|                     0E-25|                  0E-25|  -0.10000000000000...|                 0E-25|                     0E-25|                  0E-25|                 0E-25|                 0E-25|         -0.10000000000000...|                        0E-25|          -11837.6850000000000|                          0E-25|                                0E-25|                    -0.1|        -158.551000000000...|  -158.551000000000...|                 0E-22|                  0E-25|  1|  0|   0|            0|        0|          0|          0|       1|   0|  0|  1|   0.041666666666666664|(57,[0,1,2,3,4,5,...|         0|\n",
      "|   00444268|     251.00|        1|    2|              2|                    2|                 1|      151.00|               0.5|  26|        11|      0.0|0.455541602660661...|0.064039408866995...|0.935960591133004...|0.070778362738810...|0.119415370389703...|0.569920209989411...|0.239886056882074...|               0E-20|0.133004926108374...|0.724137931034482...|0.142857142857142...|0.597687730235194...|0.408866995073891...|              3417.75|  0.577727272727272...|        0.089484124024995...| 0.08333333333333333|222.9747023809523...|169.3207070707070...|312.3076923076923...|5.976095617529880...|                    49.5|          0|                  0|              0|      0|    -0.09630750348305...|    -0.01142857142857...|   -0.18857142857142...|                     0E-25|   -0.01927831652451...|  -0.16945703943824...|  -0.01126464403724...|                     0E-25|   -0.03142857142857...|  -0.13142857142857...|  -0.03714285714285...|         -0.20000000000000...|         -0.06428571428571...|            -184.9410000000000|           -0.02566500000000...|                                0E-25|                  -0.045|        -35.3692727272727...|  -25.2756388888888...|  -51.9230769230769...|                  0E-25|  0|  1|   0|            0|        1|          0|          0|       0|   0|  0|  1|   0.020202020202020204|[251.0,1.0,2.0,2....|         0|\n",
      "|   00447923|    2739.00|        1|    4|              4|                    3|                 3|     2089.00|              0.25|  26|        11|      0.0|               0E-20|               0E-20|1.000000000000000...|               0E-20|0.371781115879828...|0.583261802575107...|0.044957081545064...|               0E-20|0.375036374974017...|0.507888172937019...|0.117075452088962...|0.955042918454935...|0.721159842028684...|             14217.08|                 0E-20|        0.008583690987124...|                 0.4|864.5909090909090...|548.2352941176470...|1436.119402985074...|0.029207740051113...|                    4.25|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|                     0E-25|                  0E-25|  -0.10000000000000...|                 0E-25|                     0E-25|                  0E-25|  -0.08333333333333...|  -0.01666666666666...|         -0.10000000000000...|         -0.10000000000000...|            -206.0720000000000|                          0E-25|                                0E-25|                    -0.1|        -65.6250000000000...|  -65.0000000000000...|  -120.000000000000...|                  0E-25|  1|  0|   0|            0|        1|          0|          0|       0|   0|  0|  1|    0.23529411764705882|(57,[0,1,2,3,4,5,...|         0|\n",
      "|   00458134|     768.00|        1|    1|              1|                    1|                 0|        0.00|               1.0|  28|        11|      0.0|0.429717543001600...|0.015160374605859...|0.984839625394140...|0.063369268930590...|0.215006873998695...|0.439986663786686...|0.281637193284027...|0.011864742403077...|0.528305002480470...|0.205196603236436...|0.254633651880014...|0.624758049975534...|0.867411095481671...|             13735.58|  0.994913333333333...|        0.052575042809954...|0.016129032258064516|832.5283024691358...|415.2228125000000...|1405.735409836065...|6.367187500000000...|                   224.0|          0|                  0|              0|      0|    -0.05849676890093...|                   0E-25|   -0.10000000000000...|      -0.02977749788812...|   -0.00457446776067...|  -0.02158874314973...|  -0.04405929120146...|                     0E-25|   -0.05437500000000...|  -0.03312500000000...|  -0.01250000000000...|         -0.07006346311606...|         -0.10000000000000...|            -301.9960000000000|           -0.08266088888888...|                                0E-25|    -0.00833333333333...|        -106.520350000000...|  -25.2236153846153...|  -160.000000000000...|                  0E-25|  0|  1|   0|            0|        1|          0|          0|       0|   0|  0|  1|   0.004464285714285714|[768.0,1.0,1.0,1....|         0|\n",
      "|   00461820|     100.00|        1|    1|              1|                    1|                 0|        0.00|               1.0|  27|        11|      0.0|0.791631935267448...|               0E-20|1.000000000000000...|               0E-20|0.046557017098013...|0.202675503689999...|0.750767479211986...|               0E-20|0.164974619289340...|0.479332849891225...|0.355692530819434...|0.159147742289629...|0.211747643219724...|             11557.36|  0.028666666666666...|        0.020330575151971...| 0.07142857142857142|666.2743842364532...|273.2611111111111...|1970.000000000000...|1.000000000000000...|                    18.0|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|                     0E-25|   -0.02439024390243...|  -0.07560975609756...|                 0E-25|                     0E-25|   -0.00057971014492...|  -0.09739130434782...|  -0.00202898550724...|                        0E-25|         -0.00260869565217...|            -637.1360000000000|                          0E-25|                 -0.02439024390243...|    -0.03333333333333333|        -79.6969696969696...|  -8.20000000000000...|  -246.428571428571...|   -0.10000000000000...|  0|  1|   0|            0|        1|          0|          0|       0|   0|  0|  1|    0.05555555555555555|[100.0,1.0,1.0,1....|         0|\n",
      "|   00475697|     753.11|        1|    1|              1|                    1|                 0|        0.00|               1.0|  26|        11|      0.0|               0E-20|               0E-20|1.000000000000000...|0.057199032746502...|0.086195486961605...|0.469515753217079...|0.387089727074811...|0.042338709677419...|0.121975806451612...|0.376008064516129...|0.459677419354838...|0.453035009917651...|0.444556451612903...|              8525.32|                 0E-20|        0.076524690402970...|0.012195121951219513|388.8908370044052...|248.3037410071942...|604.8780487804878...|3.507044123700389...|                   139.0|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|      -0.00255737021697...|   -0.00263707639811...|  -0.00423745148602...|  -0.09056810189888...|                     0E-25|                  0E-25|  -0.04210526315789...|  -0.05789473684210...|         -0.05247531973639...|         -0.06315789473684...|            -153.8900000000000|                          0E-25|                 -0.01037196217863...|                   -0.01|        -23.9129166666666...|  -20.2057894736842...|  -38.0000000000000...|   -0.05287275431211...|  0|  1|   0|            0|        1|          0|          0|       0|   0|  0|  1|   0.007194244604316547|[753.11,1.0,1.0,1...|         0|\n",
      "|   00522122|     178.00|        2|    2|              2|                    2|                 0|        0.00|               0.5|  40|        11|      0.0|0.473876011866207...|               0E-20|1.000000000000000...|0.070043374373439...|0.183346394947702...|0.552042413562021...|0.194567817116836...|0.009033423667570...|0.434507678410117...|0.478771454381210...|0.077687443541102...|0.486684338400024...|0.610659439927732...|            119380.30|  0.944426969222743...|        0.052608747870185...| 0.02127659574468085|1019.586846590909...|774.6092307692307...|1064.423076923076...|50.59561797752808...|                   110.5|          0|                  0|              0|      0|    -0.01658413433474...|                   0E-25|   -0.10000000000000...|      -0.00002116005759...|   -0.03761358329766...|  -0.05846159084718...|  -0.00390366579756...|                     0E-25|   -0.06969696969696...|  -0.03030303030303...|                 0E-25|         -0.01916225629450...|         -0.06666666666666...|           -6004.6570000000000|           -0.00117704225352...|                                0E-25|    -0.01428571428571...|        -98.0160000000000...|  -68.5253333333333...|  -82.5000000000000...|                  0E-25|  0|  1|   0|            0|        1|          0|          0|       0|   0|  1|  0|    0.00904977375565611|[178.0,2.0,2.0,2....|         0|\n",
      "|   00529362|      51.00|        1|    1|              1|                    1|                 0|        0.00|               1.0|  32|        11|      0.0|               0E-20|               0E-20|1.000000000000000...|0.031129679691980...|0.102400262144671...|0.303416072745146...|0.563053985418202...|               0E-20|0.170560747663551...|0.829439252336448...|               0E-20|0.136260615493842...|0.446261682242990...|              8726.09|                 0E-20|        0.004096010485786...| 0.08333333333333333|709.0282051282051...|197.9513513513513...|3566.666666666666...|0.588235294117647...|                    37.0|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|                     0E-25|   -0.08349514563106...|                 0E-25|  -0.01650485436893...|                     0E-25|                  0E-25|  -0.10000000000000...|                 0E-25|         -0.08349514563106...|         -0.10000000000000...|             -26.8660000000000|                          0E-25|                                0E-25|    -0.03333333333333333|        -72.3166666666666...|  -10.3000000000000...|  -380.000000000000...|                  0E-25|  1|  0|   0|            0|        0|          0|          0|       1|   0|  0|  1|    0.02702702702702703|(57,[0,1,2,3,4,5,...|         0|\n",
      "|   00731582|      98.00|        1|    1|              2|                    2|                 0|        0.00|               1.0|  44|        11|      0.0|0.908036173766601...|               0E-20|1.000000000000000...|0.002261920025374...|0.328565146581530...|0.404970184263125...|0.264202749129969...|               0E-20|0.755752212389380...|0.226548672566371...|0.017699115044247...|0.411707873240645...|0.751327433628318...|             49827.18|  0.697592692307692...|        0.024122614149432...| 0.00909090909090909|1064.582133333333...|871.1455384615384...|2404.255319148936...|69.69030612244897...|                   162.5|          0|                  0|              0|      0|    -0.08990654450337...|                   0E-25|   -0.10000000000000...|      -0.00183303122263...|   -0.01540604551154...|  -0.07989499349710...|  -0.00286592976871...|                     0E-25|                  0E-25|  -0.10000000000000...|                 0E-25|         -0.06306740317667...|                        0E-25|           -2004.3780000000000|           -0.03673076923076...|                 -0.01210848053349...|    -0.00666666666666...|        -74.7441818181818...|  -72.3564210526315...|  -200.000000000000...|   -1.69861224489795...|  0|  1|   0|            0|        0|          0|          0|       1|   0|  0|  1|   0.006153846153846154|[98.0,1.0,1.0,2.0...|         0|\n",
      "|   00971551|    3182.00|        1|    2|              3|                    3|                 2|     1432.00|0.6666666666666666|  30|        11|      0.0|0.306236498370886...|               0E-20|1.000000000000000...|0.015708941735873...|0.627418738930048...|0.220389465491448...|0.136482853842629...|               0E-20|0.123386109685316...|0.518221660678327...|0.358392229636356...|0.732702845804695...|0.567862360326923...|             31111.14|  0.916483333333333...|        0.043054084541000...| 0.06451612903225806|887.7444715447154...|758.7356000000000...|2894.514285714285...|0.769956002514142...|                    25.0|          0|                  0|              0|      0|    -0.08702484434984...|                   0E-25|                  0E-25|      -0.00949416187615...|   -0.09050583812384...|                 0E-25|                 0E-25|                     0E-25|                  0E-25|                 0E-25|                 0E-25|         -0.09050583812384...|                        0E-25|             -58.0870000000000|           -0.05581666666666...|                                0E-25|                   -0.05|        -27.0115000000000...|  -33.5153333333333...|                 0E-22|                  0E-25|  1|  0|   0|            0|        1|          0|          0|       0|   0|  1|  0|                   0.04|(57,[0,1,2,3,4,5,...|         0|\n",
      "|   01146807|    1157.00|        1|    1|              3|                    3|                 0|        0.00|               1.0|  38|        16|      0.0|               0E-20|               0E-20|1.000000000000000...|0.009772658039728...|0.152037467138336...|0.497329687222117...|0.340860187599817...|0.009920634920634...|0.313492063492063...|0.490079365079365...|0.186507936507936...|0.473036268006782...|0.488095238095238...|              9122.52|                 0E-20|        0.296432891773534...| 0.01818181818181818|464.9611724137931...|220.5479611650485...|446.0176991150442...|5.820138288677614...|      34.333333333333336|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|                     0E-25|   -0.02611978074425...|  -0.01070245722632...|  -0.06317776202941...|                     0E-25|   -0.02244897959183...|  -0.04897959183673...|  -0.02857142857142...|         -0.06273953979433...|         -0.03877551020408...|            -912.2520000000000|                          0E-25|                                0E-25|    -0.00909090909090909|        -67.0069354838709...|  -26.5934615384615...|  -44.5454545454545...|                  0E-25|  0|  1|   0|            0|        1|          0|          0|       0|   0|  0|  1|   0.029126213592233007|[1157.0,1.0,1.0,3...|         0|\n",
      "|   02039499|     448.35|        1|    1|              1|                    0|                 0|        0.00|               1.0|  41|        11|      0.0|0.058588760477428...|               0E-20|1.000000000000000...|0.016325126166080...|0.294659151319191...|0.540437230099257...|0.148578492415470...|0.043140638481449...|0.311475409836065...|0.570319240724762...|0.075064710957722...|0.845943023179603...|0.322691975841242...|             11761.76|  1.270313333333333...|        0.053344402449770...| 0.02702702702702703|1519.275277777777...|450.2262295081967...|3996.551724137931...|3.267625738820118...|                    61.0|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|      -0.03812986350299...|   -0.01700897223285...|  -0.04486116426414...|                 0E-25|                     0E-25|                  0E-25|  -0.04210526315789...|  -0.05789473684210...|         -0.10000000000000...|         -0.10000000000000...|           -1046.4490000000000|                          0E-25|                                0E-25|    -0.03333333333333333|        -81.9538888888888...|  -39.1950000000000...|  -126.666666666666...|                  0E-25|  1|  0|   0|            0|        1|          0|          0|       0|   0|  0|  1|    0.01639344262295082|[448.35,1.0,1.0,1...|         0|\n",
      "|   02116751|     100.00|        1|    1|              1|                    1|                 0|        0.00|               1.0|  57|        10|      0.0|               0E-20|               0E-20|1.000000000000000...|0.093513452036444...|0.175159156928429...|0.444634487123769...|0.286692903911356...|               0E-20|0.145867098865478...|0.486223662884927...|0.367909238249594...|0.628803242092701...|0.706464973887988...|             20570.65|                 0E-20|        0.153291733949284...|                0.05|386.9962734584450...|108.3368452380952...|1354.390243902439...|27.90000000000000...|                   168.0|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|                     0E-25|   -0.02175692695214...|  -0.04093198992443...|  -0.03731108312342...|                     0E-25|                  0E-25|  -0.06000000000000...|  -0.04000000000000...|         -0.07257556675062...|         -0.04000000000000...|            -935.8530000000000|                          0E-25|                 -0.00944584382871...|                 -0.0125|        -16.1583333333333...|  -9.07428571428571...|  -100.000000000000...|   -0.30000000000000...|  1|  0|   0|            0|        1|          0|          0|       0|   0|  0|  1|   0.005952380952380952|[100.0,1.0,1.0,1....|         0|\n",
      "|   02133818|    3075.80|        1|    1|              1|                    1|                 0|        0.00|               1.0|  29|        10|      0.0|               0E-20|               0E-20|1.000000000000000...|0.005023286722470...|0.223532610952897...|0.566425249564742...|0.205018852759889...|               0E-20|0.633893919793014...|0.256144890038809...|0.109961190168175...|0.467667713231505...|0.553040103492884...|              9837.32|                 0E-20|        0.041454743834827...|0.017857142857142856|542.6802285714285...|326.9177981651376...|417.8378378378378...|0.480265296833344...|                   109.0|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|      -0.00053894630422...|   -0.02890796469715...|  -0.04418802163962...|  -0.02636506735899...|                     0E-25|   -0.10000000000000...|                 0E-25|                 0E-25|         -0.04244053470907...|         -0.10000000000000...|            -983.7320000000000|                          0E-25|                 -0.00278765329770...|    -0.00909090909090909|        -56.0639411764705...|  -44.8405833333333...|  -50.0000000000000...|   -0.00487678002470...|  0|  1|   0|            0|        1|          0|          0|       0|   0|  0|  1|   0.009174311926605505|[3075.8,1.0,1.0,1...|         0|\n",
      "|   02295358|      99.00|        1|    1|              1|                    1|                 0|        0.00|               1.0|  22|        11|      0.0|               0E-20|               0E-20|0.990990990990990...|0.168643422699437...|0.307679819362683...|0.119136307123196...|0.404540450814681...|0.180180180180180...|               0E-20|0.342342342342342...|0.477477477477477...|0.273454150276530...|0.315315315315315...|              3200.00|                 0E-20|        0.285848944860392...|                0.04|253.0200714285714...|112.8300000000000...|326.4705882352941...|34.85858585858585...|                   107.0|          0|                  0|              0|      0|                   0E-25|                   0E-25|                  0E-25|      -0.02148670645686...|   -0.01806836679327...|  -0.00162778079218...|  -0.05881714595767...|                     0E-25|                  0E-25|                 0E-25|                 0E-25|         -0.01774281063483...|                        0E-25|             -15.6010000000000|                          0E-25|                 -0.06749864351600...|    -0.01428571428571...|        -11.6647058823529...|  -11.5187500000000...|                 0E-22|   -1.25656565656565...|  0|  1|   0|            0|        1|          0|          0|       0|   0|  0|  1|   0.009345794392523364|(57,[0,1,2,3,4,5,...|         0|\n",
      "|   02390650|    1739.81|        2|    2|              2|                    2|                 1|     1645.00|               0.5|  33|        10|      0.0|1.000000000000000...|0.267256187645910...|0.732743812354089...|0.099367129315220...|0.146542290063050...|0.432448644875459...|0.321641935746269...|0.042847796779668...|0.390909894904411...|0.170075933234991...|0.396166375080927...|0.510553504104059...|0.545046878596397...|             51360.66|  0.543519842519685...|        0.094318209763858...|  0.0106951871657754|455.1348837209302...|357.1777027027027...|2519.882857142857...|11.46303906748438...|                   296.0|          0|                  0|              0|      0|    -0.10000000000000...|                   0E-25|   -0.10000000000000...|      -0.02492784741845...|   -0.01779593058127...|  -0.00765033920572...|  -0.04962588279454...|                     0E-25|   -0.10000000000000...|                 0E-25|                 0E-25|         -0.03406848687603...|         -0.10000000000000...|           -2000.0010000000000|           -0.01447401574803...|                 -0.00167890099707...|    -0.00416666666666...|        -24.5243947368421...|  -20.5926216216216...|  -170.000000000000...|   -0.13492247653201...|  0|  1|   0|            0|        0|          0|          0|       1|   0|  1|  0|   0.003378378378378...|[1739.81,2.0,2.0,...|         0|\n",
      "+-----------+-----------+---------+-----+---------------+---------------------+------------------+------------+------------------+----+----------+---------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+---------------------+----------------------+----------------------------+--------------------+--------------------+--------------------+--------------------+--------------------+------------------------+-----------+-------------------+---------------+-------+------------------------+------------------------+-----------------------+--------------------------+-----------------------+----------------------+----------------------+--------------------------+-----------------------+----------------------+----------------------+-----------------------------+-----------------------------+------------------------------+-------------------------------+-------------------------------------+------------------------+----------------------------+----------------------+----------------------+-----------------------+---+---+----+-------------+---------+-----------+-----------+--------+----+---+---+-----------------------+--------------------+----------+\n",
      "only showing top 20 rows\n",
      "\n"
     ]
    }
   ],
   "source": [
    "dataset = n_ctes\n",
    "# Instanciamos el modelo K-Means con el n√∫mero de Clusters \"K\" visto en el m√©todo del codo\n",
    "kmeans = KMeans().setK(4).setSeed(0)\n",
    "model = kmeans.fit(dataset.select('features'))\n",
    "\n",
    "# Realizamos la predicci√≥n\n",
    "predictions = model.transform(dataset)\n",
    "predictions.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Centroides"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Cluster Centers: \n",
      "[ 2.55320529e+03  1.19375671e+00  1.64878294e+00  3.15557970e+00\n",
      "  2.81690958e+00  8.37577393e-01 -2.41413702e+01  3.18066337e-01\n",
      "  8.90521887e-01  7.75116111e-02  2.12488935e-01  4.24594417e-01\n",
      "  2.83756703e-01  1.09824332e-02  2.32681416e-01  4.69643991e-01\n",
      "  2.21062003e-01  5.64176165e-01  5.23122354e-01  9.36391427e+05\n",
      "  4.99354685e-01  1.05551972e+03  7.15654772e+02  1.81839096e+03\n",
      "  1.28214839e+02  6.32446747e-02  5.48109519e-04  7.52852255e-01\n",
      "  8.53938743e-05  9.10735599e-03  2.37208296e-01  3.02586243e-01\n",
      "  9.62766285e-02  3.58376245e-02  2.56916407e-02  2.73220680e-02\n",
      " -3.23215958e-02 -1.79759712e-03 -6.82123304e-02 -1.06436839e-02\n",
      " -2.34583913e-02 -4.22762988e-02 -3.03885917e-02 -8.90865648e-04\n",
      " -1.74089878e-02 -3.52321123e-02 -1.68792554e-02 -6.24717983e-02\n",
      " -4.05373691e-02 -3.91778626e+04 -3.03212767e-02 -1.83868470e-02\n",
      " -3.64937799e-02 -1.11765296e+02 -7.84678457e+01 -1.36762800e+02\n",
      " -3.91071409e+00]\n",
      "[ 3.35954930e+03  1.30757342e+00  1.75425039e+00  5.00927357e+00\n",
      "  2.81143740e+00  8.25492734e-01  2.94992272e-01  2.75674983e-01\n",
      "  8.58880931e-01  8.89550641e-02  1.76149957e-01  4.62380085e-01\n",
      "  2.72514894e-01  1.49701186e-02  1.73363296e-01  4.95932237e-01\n",
      "  2.02905910e-01  6.07686053e-01  5.48298435e-01  9.79211736e+10\n",
      "  5.01328020e-01  1.66466239e+03  1.16123188e+03  3.21124996e+03\n",
      "  1.33978233e+02  7.00505963e-02  0.00000000e+00  4.89953632e-01\n",
      "  0.00000000e+00  3.86398764e-02  4.71406491e-01  1.63833076e-01\n",
      "  1.29829985e-01  8.34621329e-02  2.93663060e-02  4.94590417e-02\n",
      " -2.99002947e-02 -1.53828546e-03 -6.07484557e-02 -1.05706782e-02\n",
      " -1.85903179e-02 -4.61564209e-02 -3.19468798e-02 -7.65452266e-04\n",
      " -1.25999834e-02 -3.58845646e-02 -1.30374803e-02 -6.63498370e-02\n",
      " -3.95099535e-02 -6.04204236e+09 -2.73466559e-02 -1.38592395e-02\n",
      " -3.05743551e-02 -1.65663287e+02 -1.14559906e+02 -2.34601187e+02\n",
      " -2.38592857e+00]\n",
      "[ 4.04181901e+03  1.31626506e+00  1.68373494e+00  3.23192771e+00\n",
      "  2.19277108e+00  8.25770501e-01 -2.43527831e+02  4.48730615e-01\n",
      "  8.18781424e-01  7.75662508e-02  1.64339248e-01  4.81122446e-01\n",
      "  2.76972056e-01  1.42535038e-02  1.52862202e-01  4.62148186e-01\n",
      "  2.23145747e-01  6.12682413e-01  5.03682398e-01  7.93765046e+10\n",
      "  5.97092145e-01  1.86666173e+03  1.14597965e+03  2.82692598e+03\n",
      "  7.00945948e+01  5.74517359e-02  0.00000000e+00  4.06626506e-01\n",
      "  0.00000000e+00  3.61445783e-02  5.57228916e-01  2.71084337e-01\n",
      "  1.29518072e-01  4.51807229e-02  3.01204819e-02  4.21686747e-02\n",
      " -4.43021323e-02 -1.33371045e-03 -5.34739521e-02 -1.06160100e-02\n",
      " -1.64320977e-02 -4.85665257e-02 -2.86022341e-02 -6.54825018e-04\n",
      " -8.83682408e-03 -3.24216001e-02 -1.29060279e-02 -6.46450755e-02\n",
      " -3.48898354e-02 -3.34608973e+09 -3.49092516e-02 -1.18326296e-02\n",
      " -2.92675155e-02 -3.45115621e+02 -1.30294247e+02 -1.93380592e+02\n",
      " -1.82315674e+00]\n",
      "[ 2.96828652e+03  1.19565217e+00  1.56521739e+00  2.64130435e+00\n",
      "  1.58695652e+00  8.27870680e-01 -4.97411957e+01  4.37309159e-01\n",
      "  8.35483063e-01  5.89179780e-02  1.79345846e-01  4.51368187e-01\n",
      "  3.10367989e-01  9.63499124e-03  1.68534850e-01  4.95655570e-01\n",
      "  1.84870241e-01  6.43721585e-01  5.00299765e-01  4.69347805e+10\n",
      "  4.81514683e-01  1.87761913e+03  1.24713365e+03  3.00359782e+03\n",
      "  1.36665176e+02  7.11067612e-02  0.00000000e+00  4.02173913e-01\n",
      "  0.00000000e+00  7.60869565e-02  5.21739130e-01  2.93478261e-01\n",
      "  1.08695652e-01  3.26086957e-02  3.26086957e-02  3.26086957e-02\n",
      " -3.48820068e-02 -4.41829778e-04 -5.06451267e-02 -7.88330764e-03\n",
      " -2.08227310e-02 -4.14250767e-02 -2.87819281e-02 -4.72589792e-04\n",
      " -8.32788631e-03 -3.11827427e-02 -1.11037377e-02 -6.48885856e-02\n",
      " -2.96739659e-02 -1.83587580e+09 -2.38290732e-02 -8.95629235e-03\n",
      " -3.23353667e-02 -1.56538879e+02 -1.11635724e+02 -1.79751203e+02\n",
      " -7.78344551e-01]\n"
     ]
    }
   ],
   "source": [
    "centers = model.clusterCenters()\n",
    "print(\"Cluster Centers: \")\n",
    "for center in centers:\n",
    "    print(center)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Normalizaci√≥n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "metadata": {},
   "outputs": [],
   "source": [
    "from pyspark.ml.feature import Normalizer\n",
    "from pyspark.ml.linalg import Vectors\n",
    "\n",
    "# Normalizando el Vector usando $L^1$ norm.\n",
    "normalizer = Normalizer(inputCol=\"features\", outputCol=\"normFeatures\", p=1.0)\n",
    "l1NormData = normalizer.transform(n_ctes)\n",
    "#print(\"Normalized using L^1 norm\")\n",
    "#l1NormData.show()\n",
    "\n",
    "# Normalize el Vector usando  $L^\\infty$ norm.\n",
    "lInfNormData = normalizer.transform(n_ctes, {normalizer.p: float(\"inf\")})\n",
    "#print(\"Normalized using L^inf norm\")\n",
    "#lInfNormData.show()\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 15,
   "metadata": {},
   "outputs": [],
   "source": [
    "l1NormData = l1NormData.drop('features')\n",
    "l1NormData = l1NormData.withColumnRenamed('normFeatures','features')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 16,
   "metadata": {},
   "outputs": [],
   "source": [
    "#print(l1NormData.select('features').collect()[0])\n",
    "# print(lInfNormData.select('normFeatures').collect()[0])"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## PCA"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 17,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "+-----------+-----------+---------+-----+---------------+---------------------+------------------+------------+------------------+----+----------+---------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+---------------------+----------------------+----------------------------+--------------------+--------------------+--------------------+--------------------+--------------------+------------------------+-----------+-------------------+---------------+-------+------------------------+------------------------+-----------------------+--------------------------+-----------------------+----------------------+----------------------+--------------------------+-----------------------+----------------------+----------------------+-----------------------------+-----------------------------+------------------------------+-------------------------------+-------------------------------------+------------------------+----------------------------+----------------------+----------------------+-----------------------+---+---+----+-------------+---------+-----------+-----------+--------+----+---+---+-----------------------+--------------------+--------------------+\n",
      "|customer_id|monto_total|n_tarjeta|n_com|n_reclamaciones|dictamen_afavor_total|NO_CLAIMS_12_MONTH|monto_12_mes|      div_comercio|edad|antiguedad|pendiente|     COMPRAS_CREDITO|     RETIROS_CREDITO|      RETIROS_DEBITO|   COMPRAS_MADRUGADA|      COMPRAS_MANANA|       COMPRAS_TARDE|       COMPRAS_NOCHE|   RETIROS_MADRUGADA|      RETIROS_MANANA|       RETIROS_TARDE|       RETIROS_NOCHE|COMPRAS_ENTRE_SEMANA|RETIROS_ENTRE_SEMANA|MAX_DEBITO_DISPONIBLE|MAX_PORC_ENDEUDAMIENTO|PORCENTAJE_COMPRAS_ECOMMERCE|     razon_comercios| razon_transacciones|       razon_compras|       razon_retiros|      razon_ecomerce|facturacion/aclaraciones|Delta_Monto|Delta_Reclamaciones|Delta_Pendiente|Bandera|COMPRAS_CREDITO_dif_mean|RETIROS_CREDITO_dif_mean|RETIROS_DEBITO_dif_mean|COMPRAS_MADRUGADA_dif_mean|COMPRAS_MANANA_dif_mean|COMPRAS_TARDE_dif_mean|COMPRAS_NOCHE_dif_mean|RETIROS_MADRUGADA_dif_mean|RETIROS_MANANA_dif_mean|RETIROS_TARDE_dif_mean|RETIROS_NOCHE_dif_mean|COMPRAS_ENTRE_SEMANA_dif_mean|RETIROS_ENTRE_SEMANA_dif_mean|MAX_DEBITO_DISPONIBLE_dif_mean|MAX_PORC_ENDEUDAMIENTO_dif_mean|PORCENTAJE_COMPRAS_ECOMMERCE_dif_mean|razon_comercios_dif_mean|razon_transacciones_dif_mean|razon_compras_dif_mean|razon_retiros_dif_mean|razon_ecomerce_dif_mean|  F|  M|BEyG|Cliente Nuevo|Comercial|Corporativa|Patrimonial|Personal|PyME|  C|  D|aclarciones/facturacion|            features|                 pca|\n",
      "+-----------+-----------+---------+-----+---------------+---------------------+------------------+------------+------------------+----+----------+---------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+---------------------+----------------------+----------------------------+--------------------+--------------------+--------------------+--------------------+--------------------+------------------------+-----------+-------------------+---------------+-------+------------------------+------------------------+-----------------------+--------------------------+-----------------------+----------------------+----------------------+--------------------------+-----------------------+----------------------+----------------------+-----------------------------+-----------------------------+------------------------------+-------------------------------+-------------------------------------+------------------------+----------------------------+----------------------+----------------------+-----------------------+---+---+----+-------------+---------+-----------+-----------+--------+----+---+---+-----------------------+--------------------+--------------------+\n",
      "|   00035838|     302.60|        1|    2|              5|                    5|                 4|      245.29|               0.8|  41|        19|  -133.97|               0E-20|               0E-20|1.000000000000000...|0.065294272678777...|0.114549033890350...|0.546681662275965...|0.273475031154906...|               0E-20|0.147058823529411...|0.431372549019607...|0.421568627450980...|0.627636704151962...|0.490196078431372...|              5811.54|                 0E-20|        0.232784467690041...| 0.06451612903225806|211.6773577235772...|163.5709146341463...|728.5714285714285...|20.63645076007931...|                    32.8|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|      -0.00537950242703...|   -0.00491930546273...|  -0.05944984453346...|  -0.03025134757676...|                     0E-25|                  0E-25|  -0.10000000000000...|                 0E-25|         -0.08044723141504...|         -0.10000000000000...|            -581.1540000000000|                          0E-25|                 -0.03001284549787...|    -0.03333333333333333|        -23.4107222222222...|  -17.8495000000000...|  -150.000000000000...|   -0.24785194976867...|  1|  0|   0|            0|        1|          0|          0|       0|   0|  0|  1|   0.030487804878048783|[0.03706189402749...|[0.59170686786555...|\n",
      "|   00054168|     910.00|        1|    2|              2|                    2|                 1|       95.00|               0.5|  32|        11|      0.0|               0E-20|               0E-20|0.992300544271870...|0.127441894563249...|0.512441207735568...|0.285136049270907...|0.074980848430274...|               0E-20|0.399309703969202...|0.247245453338643...|0.353444842692154...|0.373703497045159...|0.613965219699986...|             47355.17|                 0E-20|        0.143899470642837...| 0.11764705882352941|2157.447964601769...|303.4632584269662...|3348.000000000000...|4.270846153846153...|                    44.5|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|                     0E-25|   -0.00172790567667...|  -0.09249377445748...|  -0.00577831986583...|                     0E-25|                  0E-25|                 0E-25|  -0.10000000000000...|         -0.00965594348732...|         -0.10000000000000...|           -1085.5040000000000|                          0E-25|                                0E-25|                  -0.025|        -159.552058823529...|  -19.6770000000000...|  -515.000000000000...|                  0E-25|  1|  0|   0|            0|        1|          0|          0|       0|   0|  0|  1|    0.02247191011235955|(57,[0,1,2,3,4,5,...|[0.72078532727354...|\n",
      "|   00147123|    3600.00|        1|    1|              3|                    3|                 0|        0.00|               1.0|  29|        11|      0.0|0.000475816393873...|               0E-20|1.000000000000000...|0.004956103558583...|0.104494038258492...|0.409185920973558...|0.481363937209365...|               0E-20|0.581395348837209...|0.418604651162790...|               0E-20|0.908869740979829...|0.534883720930232...|             13899.98|  0.666666666666666...|                       0E-20| 0.08333333333333333|1362.276578947368...|840.6604000000000...|5016.666666666666...|               0E-20|       8.333333333333334|          0|                  0|              0|      0|    -0.00020686117133...|                   0E-25|   -0.10000000000000...|      -0.00049977658993...|                  0E-25|  -0.00020686117133...|  -0.09929336223873...|                     0E-25|   -0.10000000000000...|                 0E-25|                 0E-25|         -0.09979313882866...|                        0E-25|            -831.5740000000000|           -0.06666666666666...|                                0E-25|    -0.03333333333333333|        -149.177000000000...|  -80.5693333333333...|  -700.000000000000...|                  0E-25|  1|  0|   0|            0|        1|          0|          0|       0|   0|  0|  1|                   0.12|(57,[0,1,2,3,4,5,...|[0.36841018273327...|\n",
      "|   00152272|    1053.90|        1|    2|              4|                    4|                 1|       99.00|               0.5|  27|        11|      0.0|               0E-20|               0E-20|1.000000000000000...|0.168606118600467...|0.196139735720107...|0.521015851864567...|0.114238293814857...|               0E-20|0.291954022988505...|0.535632183908045...|0.172413793103448...|0.493490733037196...|0.636781609195402...|             36238.06|                 0E-20|        0.397269668660082...| 0.16666666666666666|780.7880000000000...|301.7197435897435...|1359.375000000000...|4.435620077806243...|                    9.75|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|      -0.02930359648475...|   -0.00146222583265...|  -0.06807030499963...|  -0.00116387268296...|                     0E-25|                  0E-25|  -0.10000000000000...|                 0E-25|         -0.04711173473155...|         -0.02931034482758...|           -3623.8060000000000|                          0E-25|                 -0.06904512222140...|                   -0.05|        -42.4854838709677...|  -32.2404761904761...|  -82.8571428571428...|   -0.44356200778062...|  1|  0|   0|            0|        1|          0|          0|       0|   0|  0|  1|    0.10256410256410256|[0.02420680767737...|[0.71295785016334...|\n",
      "|   00194397|      99.00|        1|    1|              1|                    1|                 0|        0.00|               1.0|  28|        11|      0.0|               0E-20|               0E-20|1.000000000000000...|0.103444808238909...|0.043921526871988...|0.692807369351943...|0.159826295537158...|               0E-20|               0E-20|1.000000000000000...|               0E-20|0.785044794042052...|               0E-20|            135621.65|                 0E-20|        0.088864931692413...|                 0.1|707.8614285714285...|563.5050000000000...|3000.000000000000...|12.13959595959595...|                    24.0|          0|                  0|              0|      0|                   0E-25|                   0E-25|                  0E-25|                     0E-25|                  0E-25|  -0.10000000000000...|                 0E-25|                     0E-25|                  0E-25|                 0E-25|                 0E-25|         -0.10000000000000...|                        0E-25|          -11837.6850000000000|                          0E-25|                                0E-25|                    -0.1|        -158.551000000000...|  -158.551000000000...|                 0E-22|                  0E-25|  1|  0|   0|            0|        0|          0|          0|       1|   0|  0|  1|   0.041666666666666664|(57,[0,1,2,3,4,5,...|[0.77819501844789...|\n",
      "|   00444268|     251.00|        1|    2|              2|                    2|                 1|      151.00|               0.5|  26|        11|      0.0|0.455541602660661...|0.064039408866995...|0.935960591133004...|0.070778362738810...|0.119415370389703...|0.569920209989411...|0.239886056882074...|               0E-20|0.133004926108374...|0.724137931034482...|0.142857142857142...|0.597687730235194...|0.408866995073891...|              3417.75|  0.577727272727272...|        0.089484124024995...| 0.08333333333333333|222.9747023809523...|169.3207070707070...|312.3076923076923...|5.976095617529880...|                    49.5|          0|                  0|              0|      0|    -0.09630750348305...|    -0.01142857142857...|   -0.18857142857142...|                     0E-25|   -0.01927831652451...|  -0.16945703943824...|  -0.01126464403724...|                     0E-25|   -0.03142857142857...|  -0.13142857142857...|  -0.03714285714285...|         -0.20000000000000...|         -0.06428571428571...|            -184.9410000000000|           -0.02566500000000...|                                0E-25|                  -0.045|        -35.3692727272727...|  -25.2756388888888...|  -51.9230769230769...|                  0E-25|  0|  1|   0|            0|        1|          0|          0|       0|   0|  0|  1|   0.020202020202020204|[0.05350254712123...|[0.59516849632489...|\n",
      "|   00447923|    2739.00|        1|    4|              4|                    3|                 3|     2089.00|              0.25|  26|        11|      0.0|               0E-20|               0E-20|1.000000000000000...|               0E-20|0.371781115879828...|0.583261802575107...|0.044957081545064...|               0E-20|0.375036374974017...|0.507888172937019...|0.117075452088962...|0.955042918454935...|0.721159842028684...|             14217.08|                 0E-20|        0.008583690987124...|                 0.4|864.5909090909090...|548.2352941176470...|1436.119402985074...|0.029207740051113...|                    4.25|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|                     0E-25|                  0E-25|  -0.10000000000000...|                 0E-25|                     0E-25|                  0E-25|  -0.08333333333333...|  -0.01666666666666...|         -0.10000000000000...|         -0.10000000000000...|            -206.0720000000000|                          0E-25|                                0E-25|                    -0.1|        -65.6250000000000...|  -65.0000000000000...|  -120.000000000000...|                  0E-25|  1|  0|   0|            0|        1|          0|          0|       0|   0|  0|  1|    0.23529411764705882|(57,[0,1,2,3,4,5,...|[0.53862502061050...|\n",
      "|   00458134|     768.00|        1|    1|              1|                    1|                 0|        0.00|               1.0|  28|        11|      0.0|0.429717543001600...|0.015160374605859...|0.984839625394140...|0.063369268930590...|0.215006873998695...|0.439986663786686...|0.281637193284027...|0.011864742403077...|0.528305002480470...|0.205196603236436...|0.254633651880014...|0.624758049975534...|0.867411095481671...|             13735.58|  0.994913333333333...|        0.052575042809954...|0.016129032258064516|832.5283024691358...|415.2228125000000...|1405.735409836065...|6.367187500000000...|                   224.0|          0|                  0|              0|      0|    -0.05849676890093...|                   0E-25|   -0.10000000000000...|      -0.02977749788812...|   -0.00457446776067...|  -0.02158874314973...|  -0.04405929120146...|                     0E-25|   -0.05437500000000...|  -0.03312500000000...|  -0.01250000000000...|         -0.07006346311606...|         -0.10000000000000...|            -301.9960000000000|           -0.08266088888888...|                                0E-25|    -0.00833333333333...|        -106.520350000000...|  -25.2236153846153...|  -160.000000000000...|                  0E-25|  0|  1|   0|            0|        1|          0|          0|       0|   0|  0|  1|   0.004464285714285714|[0.04321963953778...|[0.63816382338958...|\n",
      "|   00461820|     100.00|        1|    1|              1|                    1|                 0|        0.00|               1.0|  27|        11|      0.0|0.791631935267448...|               0E-20|1.000000000000000...|               0E-20|0.046557017098013...|0.202675503689999...|0.750767479211986...|               0E-20|0.164974619289340...|0.479332849891225...|0.355692530819434...|0.159147742289629...|0.211747643219724...|             11557.36|  0.028666666666666...|        0.020330575151971...| 0.07142857142857142|666.2743842364532...|273.2611111111111...|1970.000000000000...|1.000000000000000...|                    18.0|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|                     0E-25|   -0.02439024390243...|  -0.07560975609756...|                 0E-25|                     0E-25|   -0.00057971014492...|  -0.09739130434782...|  -0.00202898550724...|                        0E-25|         -0.00260869565217...|            -637.1360000000000|                          0E-25|                 -0.02439024390243...|    -0.03333333333333333|        -79.6969696969696...|  -8.20000000000000...|  -246.428571428571...|   -0.10000000000000...|  0|  1|   0|            0|        1|          0|          0|       0|   0|  0|  1|    0.05555555555555555|[0.00643084165051...|[0.62390553679853...|\n",
      "|   00475697|     753.11|        1|    1|              1|                    1|                 0|        0.00|               1.0|  26|        11|      0.0|               0E-20|               0E-20|1.000000000000000...|0.057199032746502...|0.086195486961605...|0.469515753217079...|0.387089727074811...|0.042338709677419...|0.121975806451612...|0.376008064516129...|0.459677419354838...|0.453035009917651...|0.444556451612903...|              8525.32|                 0E-20|        0.076524690402970...|0.012195121951219513|388.8908370044052...|248.3037410071942...|604.8780487804878...|3.507044123700389...|                   139.0|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|      -0.00255737021697...|   -0.00263707639811...|  -0.00423745148602...|  -0.09056810189888...|                     0E-25|                  0E-25|  -0.04210526315789...|  -0.05789473684210...|         -0.05247531973639...|         -0.06315789473684...|            -153.8900000000000|                          0E-25|                 -0.01037196217863...|                   -0.01|        -23.9129166666666...|  -20.2057894736842...|  -38.0000000000000...|   -0.05287275431211...|  0|  1|   0|            0|        1|          0|          0|       0|   0|  0|  1|   0.007194244604316547|[0.06992397293200...|[0.64812970909831...|\n",
      "|   00522122|     178.00|        2|    2|              2|                    2|                 0|        0.00|               0.5|  40|        11|      0.0|0.473876011866207...|               0E-20|1.000000000000000...|0.070043374373439...|0.183346394947702...|0.552042413562021...|0.194567817116836...|0.009033423667570...|0.434507678410117...|0.478771454381210...|0.077687443541102...|0.486684338400024...|0.610659439927732...|            119380.30|  0.944426969222743...|        0.052608747870185...| 0.02127659574468085|1019.586846590909...|774.6092307692307...|1064.423076923076...|50.59561797752808...|                   110.5|          0|                  0|              0|      0|    -0.01658413433474...|                   0E-25|   -0.10000000000000...|      -0.00002116005759...|   -0.03761358329766...|  -0.05846159084718...|  -0.00390366579756...|                     0E-25|   -0.06969696969696...|  -0.03030303030303...|                 0E-25|         -0.01916225629450...|         -0.06666666666666...|           -6004.6570000000000|           -0.00117704225352...|                                0E-25|    -0.01428571428571...|        -98.0160000000000...|  -68.5253333333333...|  -82.5000000000000...|                  0E-25|  0|  1|   0|            0|        1|          0|          0|       0|   0|  1|  0|    0.00904977375565611|[0.00138265683853...|[0.80898126880177...|\n",
      "|   00529362|      51.00|        1|    1|              1|                    1|                 0|        0.00|               1.0|  32|        11|      0.0|               0E-20|               0E-20|1.000000000000000...|0.031129679691980...|0.102400262144671...|0.303416072745146...|0.563053985418202...|               0E-20|0.170560747663551...|0.829439252336448...|               0E-20|0.136260615493842...|0.446261682242990...|              8726.09|                 0E-20|        0.004096010485786...| 0.08333333333333333|709.0282051282051...|197.9513513513513...|3566.666666666666...|0.588235294117647...|                    37.0|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|                     0E-25|   -0.08349514563106...|                 0E-25|  -0.01650485436893...|                     0E-25|                  0E-25|  -0.10000000000000...|                 0E-25|         -0.08349514563106...|         -0.10000000000000...|             -26.8660000000000|                          0E-25|                                0E-25|    -0.03333333333333333|        -72.3166666666666...|  -10.3000000000000...|  -380.000000000000...|                  0E-25|  1|  0|   0|            0|        0|          0|          0|       1|   0|  0|  1|    0.02702702702702703|(57,[0,1,2,3,4,5,...|[0.51227555755403...|\n",
      "|   00731582|      98.00|        1|    1|              2|                    2|                 0|        0.00|               1.0|  44|        11|      0.0|0.908036173766601...|               0E-20|1.000000000000000...|0.002261920025374...|0.328565146581530...|0.404970184263125...|0.264202749129969...|               0E-20|0.755752212389380...|0.226548672566371...|0.017699115044247...|0.411707873240645...|0.751327433628318...|             49827.18|  0.697592692307692...|        0.024122614149432...| 0.00909090909090909|1064.582133333333...|871.1455384615384...|2404.255319148936...|69.69030612244897...|                   162.5|          0|                  0|              0|      0|    -0.08990654450337...|                   0E-25|   -0.10000000000000...|      -0.00183303122263...|   -0.01540604551154...|  -0.07989499349710...|  -0.00286592976871...|                     0E-25|                  0E-25|  -0.10000000000000...|                 0E-25|         -0.06306740317667...|                        0E-25|           -2004.3780000000000|           -0.03673076923076...|                 -0.01210848053349...|    -0.00666666666666...|        -74.7441818181818...|  -72.3564210526315...|  -200.000000000000...|   -1.69861224489795...|  0|  1|   0|            0|        0|          0|          0|       1|   0|  0|  1|   0.006153846153846154|[0.00172832453236...|[0.75879190344185...|\n",
      "|   00971551|    3182.00|        1|    2|              3|                    3|                 2|     1432.00|0.6666666666666666|  30|        11|      0.0|0.306236498370886...|               0E-20|1.000000000000000...|0.015708941735873...|0.627418738930048...|0.220389465491448...|0.136482853842629...|               0E-20|0.123386109685316...|0.518221660678327...|0.358392229636356...|0.732702845804695...|0.567862360326923...|             31111.14|  0.916483333333333...|        0.043054084541000...| 0.06451612903225806|887.7444715447154...|758.7356000000000...|2894.514285714285...|0.769956002514142...|                    25.0|          0|                  0|              0|      0|    -0.08702484434984...|                   0E-25|                  0E-25|      -0.00949416187615...|   -0.09050583812384...|                 0E-25|                 0E-25|                     0E-25|                  0E-25|                 0E-25|                 0E-25|         -0.09050583812384...|                        0E-25|             -58.0870000000000|           -0.05581666666666...|                                0E-25|                   -0.05|        -27.0115000000000...|  -33.5153333333333...|                 0E-22|                  0E-25|  1|  0|   0|            0|        1|          0|          0|       0|   0|  1|  0|                   0.04|(57,[0,1,2,3,4,5,...|[0.64975467372331...|\n",
      "|   01146807|    1157.00|        1|    1|              3|                    3|                 0|        0.00|               1.0|  38|        16|      0.0|               0E-20|               0E-20|1.000000000000000...|0.009772658039728...|0.152037467138336...|0.497329687222117...|0.340860187599817...|0.009920634920634...|0.313492063492063...|0.490079365079365...|0.186507936507936...|0.473036268006782...|0.488095238095238...|              9122.52|                 0E-20|        0.296432891773534...| 0.01818181818181818|464.9611724137931...|220.5479611650485...|446.0176991150442...|5.820138288677614...|      34.333333333333336|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|                     0E-25|   -0.02611978074425...|  -0.01070245722632...|  -0.06317776202941...|                     0E-25|   -0.02244897959183...|  -0.04897959183673...|  -0.02857142857142...|         -0.06273953979433...|         -0.03877551020408...|            -912.2520000000000|                          0E-25|                                0E-25|    -0.00909090909090909|        -67.0069354838709...|  -26.5934615384615...|  -44.5454545454545...|                  0E-25|  0|  1|   0|            0|        1|          0|          0|       0|   0|  0|  1|   0.029126213592233007|[0.09269596134725...|[0.59020056761778...|\n",
      "|   02039499|     448.35|        1|    1|              1|                    0|                 0|        0.00|               1.0|  41|        11|      0.0|0.058588760477428...|               0E-20|1.000000000000000...|0.016325126166080...|0.294659151319191...|0.540437230099257...|0.148578492415470...|0.043140638481449...|0.311475409836065...|0.570319240724762...|0.075064710957722...|0.845943023179603...|0.322691975841242...|             11761.76|  1.270313333333333...|        0.053344402449770...| 0.02702702702702703|1519.275277777777...|450.2262295081967...|3996.551724137931...|3.267625738820118...|                    61.0|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|      -0.03812986350299...|   -0.01700897223285...|  -0.04486116426414...|                 0E-25|                     0E-25|                  0E-25|  -0.04210526315789...|  -0.05789473684210...|         -0.10000000000000...|         -0.10000000000000...|           -1046.4490000000000|                          0E-25|                                0E-25|    -0.03333333333333333|        -81.9538888888888...|  -39.1950000000000...|  -126.666666666666...|                  0E-25|  1|  0|   0|            0|        1|          0|          0|       0|   0|  0|  1|    0.01639344262295082|[0.02301031157772...|[0.47919937515641...|\n",
      "|   02116751|     100.00|        1|    1|              1|                    1|                 0|        0.00|               1.0|  57|        10|      0.0|               0E-20|               0E-20|1.000000000000000...|0.093513452036444...|0.175159156928429...|0.444634487123769...|0.286692903911356...|               0E-20|0.145867098865478...|0.486223662884927...|0.367909238249594...|0.628803242092701...|0.706464973887988...|             20570.65|                 0E-20|        0.153291733949284...|                0.05|386.9962734584450...|108.3368452380952...|1354.390243902439...|27.90000000000000...|                   168.0|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|                     0E-25|   -0.02175692695214...|  -0.04093198992443...|  -0.03731108312342...|                     0E-25|                  0E-25|  -0.06000000000000...|  -0.04000000000000...|         -0.07257556675062...|         -0.04000000000000...|            -935.8530000000000|                          0E-25|                 -0.00944584382871...|                 -0.0125|        -16.1583333333333...|  -9.07428571428571...|  -100.000000000000...|   -0.30000000000000...|  1|  0|   0|            0|        1|          0|          0|       0|   0|  0|  1|   0.005952380952380952|[0.00423362233464...|[0.75120230139596...|\n",
      "|   02133818|    3075.80|        1|    1|              1|                    1|                 0|        0.00|               1.0|  29|        10|      0.0|               0E-20|               0E-20|1.000000000000000...|0.005023286722470...|0.223532610952897...|0.566425249564742...|0.205018852759889...|               0E-20|0.633893919793014...|0.256144890038809...|0.109961190168175...|0.467667713231505...|0.553040103492884...|              9837.32|                 0E-20|        0.041454743834827...|0.017857142857142856|542.6802285714285...|326.9177981651376...|417.8378378378378...|0.480265296833344...|                   109.0|          0|                  0|              0|      0|                   0E-25|                   0E-25|   -0.10000000000000...|      -0.00053894630422...|   -0.02890796469715...|  -0.04418802163962...|  -0.02636506735899...|                     0E-25|   -0.10000000000000...|                 0E-25|                 0E-25|         -0.04244053470907...|         -0.10000000000000...|            -983.7320000000000|                          0E-25|                 -0.00278765329770...|    -0.00909090909090909|        -56.0639411764705...|  -44.8405833333333...|  -50.0000000000000...|   -0.00487678002470...|  0|  1|   0|            0|        1|          0|          0|       0|   0|  0|  1|   0.009174311926605505|[0.20042796717753...|[0.46801312185501...|\n",
      "|   02295358|      99.00|        1|    1|              1|                    1|                 0|        0.00|               1.0|  22|        11|      0.0|               0E-20|               0E-20|0.990990990990990...|0.168643422699437...|0.307679819362683...|0.119136307123196...|0.404540450814681...|0.180180180180180...|               0E-20|0.342342342342342...|0.477477477477477...|0.273454150276530...|0.315315315315315...|              3200.00|                 0E-20|        0.285848944860392...|                0.04|253.0200714285714...|112.8300000000000...|326.4705882352941...|34.85858585858585...|                   107.0|          0|                  0|              0|      0|                   0E-25|                   0E-25|                  0E-25|      -0.02148670645686...|   -0.01806836679327...|  -0.00162778079218...|  -0.05881714595767...|                     0E-25|                  0E-25|                 0E-25|                 0E-25|         -0.01774281063483...|                        0E-25|             -15.6010000000000|                          0E-25|                 -0.06749864351600...|    -0.01428571428571...|        -11.6647058823529...|  -11.5187500000000...|                 0E-22|   -1.25656565656565...|  0|  1|   0|            0|        1|          0|          0|       0|   0|  0|  1|   0.009345794392523364|(57,[0,1,2,3,4,5,...|[0.65274496272090...|\n",
      "|   02390650|    1739.81|        2|    2|              2|                    2|                 1|     1645.00|               0.5|  33|        10|      0.0|1.000000000000000...|0.267256187645910...|0.732743812354089...|0.099367129315220...|0.146542290063050...|0.432448644875459...|0.321641935746269...|0.042847796779668...|0.390909894904411...|0.170075933234991...|0.396166375080927...|0.510553504104059...|0.545046878596397...|             51360.66|  0.543519842519685...|        0.094318209763858...|  0.0106951871657754|455.1348837209302...|357.1777027027027...|2519.882857142857...|11.46303906748438...|                   296.0|          0|                  0|              0|      0|    -0.10000000000000...|                   0E-25|   -0.10000000000000...|      -0.02492784741845...|   -0.01779593058127...|  -0.00765033920572...|  -0.04962588279454...|                     0E-25|   -0.10000000000000...|                 0E-25|                 0E-25|         -0.03406848687603...|         -0.10000000000000...|           -2000.0010000000000|           -0.01447401574803...|                 -0.00167890099707...|    -0.00416666666666...|        -24.5243947368421...|  -20.5926216216216...|  -170.000000000000...|   -0.13492247653201...|  0|  1|   0|            0|        0|          0|          0|       1|   0|  1|  0|   0.003378378378378...|[0.02965125074299...|[0.74755422552601...|\n",
      "+-----------+-----------+---------+-----+---------------+---------------------+------------------+------------+------------------+----+----------+---------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+---------------------+----------------------+----------------------------+--------------------+--------------------+--------------------+--------------------+--------------------+------------------------+-----------+-------------------+---------------+-------+------------------------+------------------------+-----------------------+--------------------------+-----------------------+----------------------+----------------------+--------------------------+-----------------------+----------------------+----------------------+-----------------------------+-----------------------------+------------------------------+-------------------------------+-------------------------------------+------------------------+----------------------------+----------------------+----------------------+-----------------------+---+---+----+-------------+---------+-----------+-----------+--------+----+---+---+-----------------------+--------------------+--------------------+\n",
      "only showing top 20 rows\n",
      "\n"
     ]
    }
   ],
   "source": [
    "from pyspark.ml.feature import PCA as PCAml\n",
    "\n",
    "pca = PCAml(k=2, inputCol=\"features\", outputCol=\"pca\")\n",
    "model = pca.fit(l1NormData)\n",
    "transformed = model.transform(l1NormData)\n",
    "transformed.show()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 18,
   "metadata": {},
   "outputs": [],
   "source": [
    "#transformed.select('pca').collect()[0]"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Codo (PCA)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 19,
   "metadata": {},
   "outputs": [],
   "source": [
    "\n",
    "vecAssembler = VectorAssembler(inputCols=[\n",
    " 'pca'], outputCol=\"pca_v\")\n",
    "#print(vecAssembler)\n",
    "n_ctes1 = vecAssembler.transform(transformed)\n",
    "#n_ctes.show()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 20,
   "metadata": {},
   "outputs": [],
   "source": [
    "dataset1 = n_ctes1"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 21,
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "ERROR:root:Exception while sending command.\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:py4j.java_gateway:An error occurred while trying to connect to the Java server (127.0.0.1:37121)\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 827, in _get_connection\n",
      "    connection = self.deque.pop()\n",
      "IndexError: pop from an empty deque\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 963, in start\n",
      "    self.socket.connect((self.address, self.port))\n",
      "ConnectionRefusedError: [Errno 111] Connection refused\n",
      "ERROR:root:Exception while sending command.\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n",
      "ERROR:root:Exception while sending command.\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1035, in send_command\n",
      "    raise Py4JNetworkError(\"Answer from Java side is empty\")\n",
      "py4j.protocol.Py4JNetworkError: Answer from Java side is empty\n",
      "\n",
      "During handling of the above exception, another exception occurred:\n",
      "\n",
      "Traceback (most recent call last):\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 883, in send_command\n",
      "    response = connection.send_command(command)\n",
      "  File \"/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1040, in send_command\n",
      "    \"Error while receiving\", e, proto.ERROR_ON_RECEIVE)\n",
      "py4j.protocol.Py4JNetworkError: Error while receiving\n"
     ]
    },
    {
     "ename": "Py4JError",
     "evalue": "An error occurred while calling o935.fit",
     "output_type": "error",
     "traceback": [
      "\u001b[0;31m---------------------------------------------------------------------------\u001b[0m",
      "\u001b[0;31mPy4JError\u001b[0m                                 Traceback (most recent call last)",
      "\u001b[0;32m<ipython-input-21-7bcba4689ed7>\u001b[0m in \u001b[0;36m<module>\u001b[0;34m()\u001b[0m\n\u001b[1;32m      4\u001b[0m \u001b[0;32mfor\u001b[0m \u001b[0mk\u001b[0m \u001b[0;32min\u001b[0m \u001b[0mrange\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;36m2\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0;36m15\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m      5\u001b[0m     \u001b[0mkmeans\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mKMeans\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0msetK\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mk\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0msetSeed\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;36m1\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0msetFeaturesCol\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m'pca_v'\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m----> 6\u001b[0;31m     \u001b[0mmodel\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mkmeans\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mfit\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mdataset1\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mselect\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m'pca_v'\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m      7\u001b[0m     \u001b[0mcost\u001b[0m\u001b[0;34m[\u001b[0m\u001b[0mk\u001b[0m\u001b[0;34m]\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mmodel\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mcomputeCost\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mdataset1\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mselect\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m'pca_v'\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m      8\u001b[0m \u001b[0;31m# Gr√°fica del coste\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n",
      "\u001b[0;32m/opt/spark/dist/python/pyspark/ml/base.py\u001b[0m in \u001b[0;36mfit\u001b[0;34m(self, dataset, params)\u001b[0m\n\u001b[1;32m     62\u001b[0m                 \u001b[0;32mreturn\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mcopy\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mparams\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0m_fit\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mdataset\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m     63\u001b[0m             \u001b[0;32melse\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m---> 64\u001b[0;31m                 \u001b[0;32mreturn\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0m_fit\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mdataset\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m     65\u001b[0m         \u001b[0;32melse\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m     66\u001b[0m             raise ValueError(\"Params must be either a param map or a list/tuple of param maps, \"\n",
      "\u001b[0;32m/opt/spark/dist/python/pyspark/ml/wrapper.py\u001b[0m in \u001b[0;36m_fit\u001b[0;34m(self, dataset)\u001b[0m\n\u001b[1;32m    263\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    264\u001b[0m     \u001b[0;32mdef\u001b[0m \u001b[0m_fit\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mself\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mdataset\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m--> 265\u001b[0;31m         \u001b[0mjava_model\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0m_fit_java\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mdataset\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m    266\u001b[0m         \u001b[0;32mreturn\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0m_create_model\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mjava_model\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    267\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n",
      "\u001b[0;32m/opt/spark/dist/python/pyspark/ml/wrapper.py\u001b[0m in \u001b[0;36m_fit_java\u001b[0;34m(self, dataset)\u001b[0m\n\u001b[1;32m    260\u001b[0m         \"\"\"\n\u001b[1;32m    261\u001b[0m         \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0m_transfer_params_to_java\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m--> 262\u001b[0;31m         \u001b[0;32mreturn\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0m_java_obj\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mfit\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mdataset\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0m_jdf\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m    263\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    264\u001b[0m     \u001b[0;32mdef\u001b[0m \u001b[0m_fit\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mself\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mdataset\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n",
      "\u001b[0;32m/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\u001b[0m in \u001b[0;36m__call__\u001b[0;34m(self, *args)\u001b[0m\n\u001b[1;32m   1131\u001b[0m         \u001b[0manswer\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mgateway_client\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0msend_command\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mcommand\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m   1132\u001b[0m         return_value = get_return_value(\n\u001b[0;32m-> 1133\u001b[0;31m             answer, self.gateway_client, self.target_id, self.name)\n\u001b[0m\u001b[1;32m   1134\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m   1135\u001b[0m         \u001b[0;32mfor\u001b[0m \u001b[0mtemp_arg\u001b[0m \u001b[0;32min\u001b[0m \u001b[0mtemp_args\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n",
      "\u001b[0;32m/opt/spark/dist/python/pyspark/sql/utils.py\u001b[0m in \u001b[0;36mdeco\u001b[0;34m(*a, **kw)\u001b[0m\n\u001b[1;32m     61\u001b[0m     \u001b[0;32mdef\u001b[0m \u001b[0mdeco\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m*\u001b[0m\u001b[0ma\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0;34m**\u001b[0m\u001b[0mkw\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m     62\u001b[0m         \u001b[0;32mtry\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m---> 63\u001b[0;31m             \u001b[0;32mreturn\u001b[0m \u001b[0mf\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m*\u001b[0m\u001b[0ma\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0;34m**\u001b[0m\u001b[0mkw\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m     64\u001b[0m         \u001b[0;32mexcept\u001b[0m \u001b[0mpy4j\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mprotocol\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mPy4JJavaError\u001b[0m \u001b[0;32mas\u001b[0m \u001b[0me\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m     65\u001b[0m             \u001b[0ms\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0me\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mjava_exception\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mtoString\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n",
      "\u001b[0;32m/opt/spark/dist/python/lib/py4j-0.10.4-src.zip/py4j/protocol.py\u001b[0m in \u001b[0;36mget_return_value\u001b[0;34m(answer, gateway_client, target_id, name)\u001b[0m\n\u001b[1;32m    325\u001b[0m             raise Py4JError(\n\u001b[1;32m    326\u001b[0m                 \u001b[0;34m\"An error occurred while calling {0}{1}{2}\"\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m--> 327\u001b[0;31m                 format(target_id, \".\", name))\n\u001b[0m\u001b[1;32m    328\u001b[0m     \u001b[0;32melse\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    329\u001b[0m         \u001b[0mtype\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0manswer\u001b[0m\u001b[0;34m[\u001b[0m\u001b[0;36m1\u001b[0m\u001b[0;34m]\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n",
      "\u001b[0;31mPy4JError\u001b[0m: An error occurred while calling o935.fit"
     ]
    }
   ],
   "source": [
    "\n",
    "# Calcular el coste y gr√°ficar\n",
    "cost = np.zeros(15)\n",
    "for k in range(2,15):\n",
    "    kmeans = KMeans().setK(k).setSeed(1).setFeaturesCol('pca_v')\n",
    "    model = kmeans.fit(dataset1.select('pca_v'))\n",
    "    cost[k] = model.computeCost(dataset1.select('pca_v'))\n",
    "# Gr√°fica del coste\n",
    "df_cost = pd.DataFrame(cost[2:])\n",
    "df_cost.columns = [\"cost\"]\n",
    "\n",
    "new_col = [2,3,4,5,6,7,8, 9,10,11,12,13,14]\n",
    "df_cost.insert(0, 'cluster', new_col)\n",
    "\n",
    "import pylab as pl\n",
    "pl.figure(figsize=(20, 10))\n",
    "pl.plot(df_cost.cluster, df_cost.cost)\n",
    "pl.xlabel('N√∫mero de Clusters')\n",
    "pl.ylabel('Score')\n",
    "pl.title('Curva de Codo')\n",
    "pl.show()\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "dataset1 = dataset1.drop('features')\n",
    "dataset1 = dataset1.withColumnRenamed('pca_v','features')"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## K-Means (PCA)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "from pyspark.ml.clustering import KMeans\n",
    "\n",
    "# Instanciamos el modelo K-Means con el n√∫mero de Clusters \"K\" visto en el m√©todo del codo\n",
    "kmeans = KMeans().setK(3).setSeed(0)\n",
    "model = kmeans.fit(dataset1.select('features'))\n",
    "# Realizamos la predicci√≥n\n",
    "predictions_pca = model.transform(dataset1)\n",
    "predictions_pca.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Centroides (PCA)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "centers_pca = model.clusterCenters()\n",
    "#type(centers_pca)\n",
    "print(\"Cluster Centers: \")\n",
    "#print(centers_pca[0,:])\n",
    "#centers_li = centers_pca.collect()\n",
    "for center in centers_pca:\n",
    "    print(center)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "cent = np.array(centers_pca)\n",
    "cent[:,0]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "from pyspark.ml.feature import PCA\n",
    "k=2\n",
    "pcaModel = PCA(k=k, inputCol=\"features\", outputCol=\"featuresPCA\").fit(dataset1)\n",
    "transformedFeaturesDF = pcaModel.transform(dataset1)\n",
    "\n",
    "plt.figure(figsize=(7,7))\n",
    "eigenvalues = [float(value) for value in pcaModel.explainedVariance]\n",
    "plt.bar(list(range(1,len(eigenvalues)+1)),eigenvalues)\n",
    "pd.DataFrame(eigenvalues,columns=['explained variance'])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "#------------------------------------------------------------------------"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "\n",
    "from pyspark.ml.linalg import Vectors\n",
    "\n",
    "var = transformed.select('customer_id','pca')\n",
    "\n",
    "def extract(row):\n",
    "    return (row.customer_id, ) + tuple(row.pca.toArray().tolist())\n",
    "\n",
    "var_a = var.rdd.map(extract).toDF([\"customer_id\"]) \n",
    "# Vector values will be named _2, _3, ...\n",
    "var_a = var_a.withColumnRenamed(\"_2\",\"x\")\n",
    "var_a = var_a.withColumnRenamed(\"_3\",\"y\")\n",
    "#var_a = var_a.withColumnRenamed(\"_4\",\"z\")\n",
    "var_a.show()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "x = list(var_a.select('x').collect())\n",
    "y = list(var_a.select('y').collect())\n",
    "#z = list(var_a.select('z').collect())\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "#jupyter --NotebookApp.iopub_data_rate_limit=1.0e10\n",
    "#print(x)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "corr = predictions_pca.join(var_a, on = ['customer_id'], how = 'left')"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Correlaci√≥n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "################################################################################################################\n",
    "################################ Correlaci√≥n variables num√©ricas ###############################################\n",
    "################################################################################################################\n",
    "from pyspark.mllib.stat import Statistics\n",
    "import matplotlib.pyplot as plt\n",
    "import seaborn as sns\n",
    "from math import log\n",
    "import numpy as np\n",
    "import seaborn as sns # importando seaborn\n",
    "from scipy import stats # importando scipy.stats\n",
    "# Librer√≠a para obtener correlaci√≥n\n",
    "import scipy.stats as ss\n",
    "# Librer√≠a para obtener todas las combinaciones (c/repetidos) de una lista\n",
    "from itertools import product\n",
    "\n",
    "\n",
    "# Lista de variables num√©ricas\n",
    "var_num = [\n",
    "'monto_total',\n",
    " 'n_tarjeta',\n",
    " 'n_com',\n",
    " 'n_reclamaciones',\n",
    " 'dictamen_afavor_total',\n",
    " 'div_comercio',\n",
    " 'pendiente',\n",
    " 'COMPRAS_CREDITO',\n",
    " 'RETIROS_DEBITO',\n",
    " 'COMPRAS_MADRUGADA',\n",
    " 'COMPRAS_MANANA',\n",
    " 'COMPRAS_TARDE',\n",
    " 'COMPRAS_NOCHE',\n",
    " 'RETIROS_MADRUGADA',\n",
    " 'RETIROS_MANANA',\n",
    " 'RETIROS_TARDE',\n",
    " 'RETIROS_NOCHE',\n",
    " 'COMPRAS_ENTRE_SEMANA',\n",
    " 'RETIROS_ENTRE_SEMANA',\n",
    " 'MAX_DEBITO_DISPONIBLE',\n",
    " 'MAX_PORC_ENDEUDAMIENTO',\n",
    " 'razon_transacciones',\n",
    " 'razon_compras',\n",
    " 'razon_retiros',\n",
    " 'razon_ecomerce',\n",
    " 'aclarciones/facturacion',\n",
    " 'BEyG',\n",
    " 'Comercial',\n",
    " 'Corporativa',\n",
    " 'Patrimonial',\n",
    " 'Personal',\n",
    " 'Delta_Monto',\n",
    " 'Delta_Reclamaciones',\n",
    " 'Delta_Pendiente',\n",
    " 'C',\n",
    " 'x',\n",
    " 'y'\n",
    "]\n",
    "# Convertir a df\n",
    "tabla_aux =  corr[var_num].toPandas()\n",
    "\n",
    "# ----------------------------------------------- Correlaci√≥n de Pearson -----------------------------------------------\n",
    "tabla_corr = tabla_aux\n",
    "for var in var_num:\n",
    "    tabla_corr[var]=tabla_corr[var].astype(float)\n",
    "    \n",
    "corr = tabla_corr.corr(method = \"pearson\")\n",
    "plt.figure(figsize=(20, 10))\n",
    "sns.heatmap(corr, xticklabels = corr.columns.values,yticklabels = corr.columns.values, annot = True,linewidths = .6, cmap=\"Blues\")\n",
    "plt.title(\"Tabla de Correlacion pearson\")\n",
    "plt.show()\n",
    "plt.clf()\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "carac_var = corr.to_csv(\"caracterizacion_variables.txt\")"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Clusters"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "#%% Plot k-means clustering.\n",
    "#predictions_pca = predictions_pca.withColumn('pca', F.col('pca').cast(IntegerType()))\n",
    "#%matplotlib qt\n",
    "from mpl_toolkits import mplot3d\n",
    "import matplotlib.pyplot as plt\n",
    "df = predictions_pca.toPandas()\n",
    "colores=['blue','green','red','yellow','fuchsia','cyan','purple']\n",
    "asignar=[]\n",
    "for row in range (len(df)):\n",
    "    asignar.append(colores[df['prediction'][row]])\n",
    "plt.figure(figsize = (16, 9))\n",
    "#ax = plt.axes(projection =\"3d\")     \n",
    "plt.scatter(x, y, c=asignar)\n",
    "plt.scatter(cent[:,0], cent[:,1],marker='*', c='black') # Marco centroides.\n",
    "plt.xlabel('X')\n",
    "plt.ylabel('Y')\n",
    "#ax.set_zlabel('Var_3')\n",
    "#plt.zlabel('Var_3')\n",
    "plt.title('K-Means Clustering')\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "#%% Plot k-means clustering.\n",
    "#predictions_pca = predictions_pca.withColumn('pca', F.col('pca').cast(IntegerType()))\n",
    "#%matplotlib qt\n",
    "from mpl_toolkits import mplot3d\n",
    "import matplotlib.pyplot as plt\n",
    "\n",
    "df = predictions_pca.toPandas()\n",
    "colores=['blue','red','green','yellow','fuchsia','cyan','purple']\n",
    "asignar=[]\n",
    "for row in range (len(df)):\n",
    "    asignar.append(colores[df['prediction'][row]])\n",
    "\n",
    "plt.figure(figsize = (16, 9))\n",
    "#ax = plt.axes(projection =\"3d\")     \n",
    "plt.scatter(x, y, c=asignar, s = 0.01 )\n",
    "plt.scatter(cent[:,0], cent[:,1],marker='*', c='black') # Marco centroides.\n",
    "plt.xlabel('X')\n",
    "plt.ylabel('Y')\n",
    "#ax.set_zlabel('Var_3')\n",
    "#plt.zlabel('Var_3')\n",
    "plt.title('K-Means Clustering')\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "pd.DataFrame(data = {\n",
    "    'color':asignar\n",
    "}).value_counts()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "df.shape"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Caracterizaci√≥n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "df[[\n",
    " 'monto_total',\n",
    " 'n_tarjeta',\n",
    " 'n_com',\n",
    " 'n_reclamaciones',\n",
    " 'dictamen_afavor_total',\n",
    " 'div_comercio',\n",
    " 'pendiente',\n",
    " 'COMPRAS_CREDITO',\n",
    " 'RETIROS_DEBITO',\n",
    " 'COMPRAS_MADRUGADA',\n",
    " 'COMPRAS_MANANA',\n",
    " 'COMPRAS_TARDE',\n",
    " 'COMPRAS_NOCHE',\n",
    " 'RETIROS_MADRUGADA',\n",
    " 'RETIROS_MANANA',\n",
    " 'RETIROS_TARDE',\n",
    " 'RETIROS_NOCHE',\n",
    " 'COMPRAS_ENTRE_SEMANA',\n",
    " 'RETIROS_ENTRE_SEMANA',\n",
    " 'MAX_DEBITO_DISPONIBLE',\n",
    " 'MAX_PORC_ENDEUDAMIENTO',\n",
    " 'razon_transacciones',\n",
    " 'razon_compras',\n",
    " 'razon_retiros',\n",
    " 'razon_ecomerce',\n",
    " 'aclarciones/facturacion',\n",
    " 'BEyG',\n",
    " 'Comercial',\n",
    " 'Corporativa',\n",
    " 'Patrimonial',\n",
    " 'Personal',\n",
    " 'C',\n",
    " 'Delta_Monto',\n",
    " 'Delta_Reclamaciones',\n",
    " 'Delta_Pendiente'\n",
    "]] = df [[\n",
    " 'monto_total',\n",
    " 'n_tarjeta',\n",
    " 'n_com',\n",
    " 'n_reclamaciones',\n",
    " 'dictamen_afavor_total',\n",
    " 'div_comercio',\n",
    " 'pendiente',\n",
    " 'COMPRAS_CREDITO',\n",
    " 'RETIROS_DEBITO',\n",
    " 'COMPRAS_MADRUGADA',\n",
    " 'COMPRAS_MANANA',\n",
    " 'COMPRAS_TARDE',\n",
    " 'COMPRAS_NOCHE',\n",
    " 'RETIROS_MADRUGADA',\n",
    " 'RETIROS_MANANA',\n",
    " 'RETIROS_TARDE',\n",
    " 'RETIROS_NOCHE',\n",
    " 'COMPRAS_ENTRE_SEMANA',\n",
    " 'RETIROS_ENTRE_SEMANA',\n",
    " 'MAX_DEBITO_DISPONIBLE',\n",
    " 'MAX_PORC_ENDEUDAMIENTO',\n",
    " 'razon_transacciones',\n",
    " 'razon_compras',\n",
    " 'razon_retiros',\n",
    " 'razon_ecomerce',\n",
    " 'aclarciones/facturacion',\n",
    " 'BEyG',\n",
    " 'Comercial',\n",
    " 'Corporativa',\n",
    " 'Patrimonial',\n",
    " 'Personal',\n",
    " 'C',\n",
    " 'Delta_Monto',\n",
    " 'Delta_Reclamaciones',\n",
    " 'Delta_Pendiente']].astype(float)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "#Borremos columnas auxiliares del DF\n",
    "df = df.drop(\"features\", axis = 1)\n",
    "df = df.drop(\"pca\", axis = 1)\n",
    "#df = df.drop(\"pca_v\", axis = 1)\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "#Filtramos el primer cluster (cluster 0)\n",
    "cluster_f1 = df.loc[df['prediction'] == 0]\n",
    "cluster_f1.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "cluster_f1.shape #Verdes"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "#Filtramos el segundo cluster (cluster 1)\n",
    "cluster_f2 = df.loc[df['prediction'] == 1]\n",
    "cluster_f2.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "cluster_f2.shape # Rojos"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "#Filtramos el tercer cluster (cluster 2)\n",
    "cluster_f3 = df.loc[df['prediction'] == 2]\n",
    "cluster_f3.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "cluster_f3.shape #Azules"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "#Filtramos el quinto cluster (cluster 4)\n",
    "#cluster_f5 = df.loc[df['prediction'] == 4]\n",
    "#cluster_f5.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "#Filtramos el sexto cluster (cluster 5)\n",
    "#cluster_f6 = df.loc[df['prediction'] == 5]\n",
    "#cluster_f6.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "#Filtramos el s√©ptimo cluster (cluster 6)\n",
    "#cluster_f7 = df.loc[df['prediction'] == 6]\n",
    "#cluster_f7.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "#Descripciones Estadisticas\n",
    "c1 = cluster_f1.describe()\n",
    "cluster1 = c1.to_csv(\"cluster1_.txt\")\n",
    "\n",
    "c2 = cluster_f2.describe()\n",
    "cluster2 = c2.to_csv(\"cluster2_.txt\")\n",
    "\n",
    "c3 = cluster_f3.describe()\n",
    "cluster3 = c3.to_csv(\"cluster3_.txt\")\n",
    "\n",
    "#c4 = cluster_f4.describe()\n",
    "#cluster4 = c4.to_csv(\"cluster4_.txt\")\n",
    "\n",
    "#c5 = cluster_f5.describe()\n",
    "#cluster5 = c5.to_csv(\"cluster5.txt\")\n",
    "\n",
    "#c6 = cluster_f6.describe()\n",
    "#cluster6 = c6.to_csv(\"cluster6.txt\")\n",
    "\n",
    "#c7 = cluster_f7.describe()\n",
    "#cluster7 = c7.to_csv(\"cluster7.txt\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "d1-spark2python3",
   "language": "python",
   "name": "spark-python-d1-spark2python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.6.11"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}