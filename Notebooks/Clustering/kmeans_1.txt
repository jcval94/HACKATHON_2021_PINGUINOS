{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Estilo"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<style>\n",
       ".output_subarea.output_text.output_stream.output_stdout > pre {\n",
       "   width:max-content;\n",
       "}\n",
       ".p-Widget.jp-RenderedText.jp-OutputArea-output > pre {\n",
       "   width:max-content;\n",
       "}\n",
       "</style>"
      ],
      "text/plain": [
       "<IPython.core.display.HTML object>"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "%%html\n",
    "<style>\n",
    ".output_subarea.output_text.output_stream.output_stdout > pre {\n",
    "   width:max-content;\n",
    "}\n",
    ".p-Widget.jp-RenderedText.jp-OutputArea-output > pre {\n",
    "   width:max-content;\n",
    "}\n",
    "</style>"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "metadata": {},
   "outputs": [],
   "source": [
    "#quitamos estas variables:\n",
    "#Edad\n",
    "# Genero\n",
    "# Retiros_credito\n",
    "# NO_CLAIMS_12\n",
    "# monto_12 meses\n",
    "# PORCENTAJE_ECOMMERCE\n",
    "# C\n",
    "# razon comercio = Numero de comercios con incidencia/distintos giros de compra\n",
    "#cambiamos facturacion/aclaraciones por aclaraciones/facturacion"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Librerias"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "metadata": {},
   "outputs": [],
   "source": [
    "# Librer√≠as\n",
    "from pyspark.sql import functions as F\n",
    "from pyspark.sql.types import *\n",
    "from time import time\n",
    "# from distinctExtract import get_table_data\n",
    "import datetime as dt\n",
    "import dateutil.relativedelta as rd\n",
    "import pandas as pd\n",
    "import matplotlib.pyplot as plt\n",
    "# import seaborn as sns\n",
    "# from math import log\n",
    "import numpy as np\n",
    "\n",
    "from pyspark.ml.feature import VectorAssembler\n",
    "from pyspark.ml.clustering import KMeans"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Paths"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {},
   "outputs": [],
   "source": [
    "path = '/data/sandboxes/ceaa/data/XME7865/tabla_pivote_seis_meses'\n",
    "ctes = spark.read.parquet(path)\n",
    "\n",
    "path_master = '/data/sandboxes/ceaa/data/XME7865/master'\n",
    "master = spark.read.parquet(path_master)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "metadata": {},
   "outputs": [],
   "source": [
    "#ctes.show()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "metadata": {},
   "outputs": [],
   "source": [
    "#master.show()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "+-----------+-----------+---------+-----+---------------+---------------------+------------------+------------+------------+-----------------+----------+---------+--------------------+----+----------+---------+---------------+---------------+--------------------+--------------------+--------------------+--------------------+--------------------+-----------------+--------------------+--------------------+--------------------+--------------------+--------------------+---------------------+----------------------+----------------------------+-------------------+--------------------+--------------------+--------------------+--------------------+------------------------+------+---+-------+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+-----------+-------------------+---------------+-------+\n",
      "|customer_id|monto_total|n_tarjeta|n_com|n_reclamaciones|dictamen_afavor_total|NO_CLAIMS_12_MONTH|monto_12_mes|div_comercio|tipo_tarjeta_moda|segment_id|gender_id|Segmento_descripcion|edad|antiguedad|pendiente|COMPRAS_CREDITO|RETIROS_CREDITO|      RETIROS_DEBITO|   COMPRAS_MADRUGADA|      COMPRAS_MANANA|       COMPRAS_TARDE|       COMPRAS_NOCHE|RETIROS_MADRUGADA|      RETIROS_MANANA|       RETIROS_TARDE|       RETIROS_NOCHE|COMPRAS_ENTRE_SEMANA|RETIROS_ENTRE_SEMANA|MAX_DEBITO_DISPONIBLE|MAX_PORC_ENDEUDAMIENTO|PORCENTAJE_COMPRAS_ECOMMERCE|    razon_comercios| razon_transacciones|       razon_compras|       razon_retiros|      razon_ecomerce|facturacion/aclaraciones|    m1| r1|     p1|  m2| r2| p2|  m3| r3| p3|  m4| r4| p4|  m5| r5| p5|  m6| r6| p6|  m7| r7| p7|  m8| r8| p8|  m9| r9| p9| m10|r10|p10| m11|r11|p11| m12|r12|p12| m13|r13|p13|Delta_Monto|Delta_Reclamaciones|Delta_Pendiente|Bandera|\n",
      "+-----------+-----------+---------+-----+---------------+---------------------+------------------+------------+------------+-----------------+----------+---------+--------------------+----+----------+---------+---------------+---------------+--------------------+--------------------+--------------------+--------------------+--------------------+-----------------+--------------------+--------------------+--------------------+--------------------+--------------------+---------------------+----------------------+----------------------------+-------------------+--------------------+--------------------+--------------------+--------------------+------------------------+------+---+-------+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+-----------+-------------------+---------------+-------+\n",
      "|   00035838|     302.60|        1|    2|              5|                    5|                 4|      245.29|         0.8|                D|        B1|        F|           Comercial|  41|        19|  -133.97|          0E-20|          0E-20|1.000000000000000...|0.065294272678777...|0.114549033890350...|0.546681662275965...|0.273475031154906...|            0E-20|0.147058823529411...|0.431372549019607...|0.421568627450980...|0.627636704151962...|0.490196078431372...|              5811.54|                 0E-20|        0.232784467690041...|0.06451612903225806|211.6773577235772...|163.5709146341463...|728.5714285714285...|20.63645076007931...|                    32.8|302.60|  5|-133.97|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|\n",
      "|   00035838|     302.60|        1|    2|              5|                    5|                 4|      245.29|         0.8|                D|        B1|        F|           Comercial|  41|        19|  -133.97|          0E-20|          0E-20|1.000000000000000...|0.065294272678777...|0.114549033890350...|0.546681662275965...|0.273475031154906...|            0E-20|0.147058823529411...|0.431372549019607...|0.421568627450980...|0.627636704151962...|0.490196078431372...|              5811.54|                 0E-20|        0.232784467690041...|0.06451612903225806|211.6773577235772...|163.5709146341463...|728.5714285714285...|20.63645076007931...|                    32.8|302.60|  5|-133.97|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|\n",
      "|   00035838|     302.60|        1|    2|              5|                    5|                 4|      245.29|         0.8|                D|        B1|        F|           Comercial|  41|        19|  -133.97|          0E-20|          0E-20|1.000000000000000...|0.065294272678777...|0.114549033890350...|0.546681662275965...|0.273475031154906...|            0E-20|0.147058823529411...|0.431372549019607...|0.421568627450980...|0.627636704151962...|0.490196078431372...|              5811.54|                 0E-20|        0.232784467690041...|0.06451612903225806|211.6773577235772...|163.5709146341463...|728.5714285714285...|20.63645076007931...|                    32.8|302.60|  5|-133.97|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|\n",
      "|   00035838|     302.60|        1|    2|              5|                    5|                 4|      245.29|         0.8|                D|        B1|        F|           Comercial|  41|        19|  -133.97|          0E-20|          0E-20|1.000000000000000...|0.065294272678777...|0.114549033890350...|0.546681662275965...|0.273475031154906...|            0E-20|0.147058823529411...|0.431372549019607...|0.421568627450980...|0.627636704151962...|0.490196078431372...|              5811.54|                 0E-20|        0.232784467690041...|0.06451612903225806|211.6773577235772...|163.5709146341463...|728.5714285714285...|20.63645076007931...|                    32.8|302.60|  5|-133.97|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|\n",
      "|   00035838|     302.60|        1|    2|              5|                    5|                 4|      245.29|         0.8|                D|        B1|        F|           Comercial|  41|        19|  -133.97|          0E-20|          0E-20|1.000000000000000...|0.065294272678777...|0.114549033890350...|0.546681662275965...|0.273475031154906...|            0E-20|0.147058823529411...|0.431372549019607...|0.421568627450980...|0.627636704151962...|0.490196078431372...|              5811.54|                 0E-20|        0.232784467690041...|0.06451612903225806|211.6773577235772...|163.5709146341463...|728.5714285714285...|20.63645076007931...|                    32.8|302.60|  5|-133.97|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|\n",
      "|   00035838|     302.60|        1|    2|              5|                    5|                 4|      245.29|         0.8|                D|        B1|        F|           Comercial|  41|        19|  -133.97|          0E-20|          0E-20|1.000000000000000...|0.065294272678777...|0.114549033890350...|0.546681662275965...|0.273475031154906...|            0E-20|0.147058823529411...|0.431372549019607...|0.421568627450980...|0.627636704151962...|0.490196078431372...|              5811.54|                 0E-20|        0.232784467690041...|0.06451612903225806|211.6773577235772...|163.5709146341463...|728.5714285714285...|20.63645076007931...|                    32.8|302.60|  5|-133.97|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|\n",
      "|   00035838|     302.60|        1|    2|              5|                    5|                 4|      245.29|         0.8|                D|        B1|        F|           Comercial|  41|        19|  -133.97|          0E-20|          0E-20|1.000000000000000...|0.065294272678777...|0.114549033890350...|0.546681662275965...|0.273475031154906...|            0E-20|0.147058823529411...|0.431372549019607...|0.421568627450980...|0.627636704151962...|0.490196078431372...|              5811.54|                 0E-20|        0.232784467690041...|0.06451612903225806|211.6773577235772...|163.5709146341463...|728.5714285714285...|20.63645076007931...|                    32.8|302.60|  5|-133.97|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|\n",
      "|   00035838|     302.60|        1|    2|              5|                    5|                 4|      245.29|         0.8|                D|        B1|        F|           Comercial|  41|        19|  -133.97|          0E-20|          0E-20|1.000000000000000...|0.065294272678777...|0.114549033890350...|0.546681662275965...|0.273475031154906...|            0E-20|0.147058823529411...|0.431372549019607...|0.421568627450980...|0.627636704151962...|0.490196078431372...|              5811.54|                 0E-20|        0.232784467690041...|0.06451612903225806|211.6773577235772...|163.5709146341463...|728.5714285714285...|20.63645076007931...|                    32.8|302.60|  5|-133.97|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|\n",
      "|   00035838|     302.60|        1|    2|              5|                    5|                 4|      245.29|         0.8|                D|        B1|        F|           Comercial|  41|        19|  -133.97|          0E-20|          0E-20|1.000000000000000...|0.065294272678777...|0.114549033890350...|0.546681662275965...|0.273475031154906...|            0E-20|0.147058823529411...|0.431372549019607...|0.421568627450980...|0.627636704151962...|0.490196078431372...|              5811.54|                 0E-20|        0.232784467690041...|0.06451612903225806|211.6773577235772...|163.5709146341463...|728.5714285714285...|20.63645076007931...|                    32.8|302.60|  5|-133.97|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|\n",
      "|   00035838|     302.60|        1|    2|              5|                    5|                 4|      245.29|         0.8|                D|        B1|        F|           Comercial|  41|        19|  -133.97|          0E-20|          0E-20|1.000000000000000...|0.065294272678777...|0.114549033890350...|0.546681662275965...|0.273475031154906...|            0E-20|0.147058823529411...|0.431372549019607...|0.421568627450980...|0.627636704151962...|0.490196078431372...|              5811.54|                 0E-20|        0.232784467690041...|0.06451612903225806|211.6773577235772...|163.5709146341463...|728.5714285714285...|20.63645076007931...|                    32.8|302.60|  5|-133.97|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|\n",
      "|   00035838|     302.60|        1|    2|              5|                    5|                 4|      245.29|         0.8|                D|        B1|        F|           Comercial|  41|        19|  -133.97|          0E-20|          0E-20|1.000000000000000...|0.065294272678777...|0.114549033890350...|0.546681662275965...|0.273475031154906...|            0E-20|0.147058823529411...|0.431372549019607...|0.421568627450980...|0.627636704151962...|0.490196078431372...|              5811.54|                 0E-20|        0.232784467690041...|0.06451612903225806|211.6773577235772...|163.5709146341463...|728.5714285714285...|20.63645076007931...|                    32.8|302.60|  5|-133.97|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|\n",
      "|   00035838|     302.60|        1|    2|              5|                    5|                 4|      245.29|         0.8|                D|        B1|        F|           Comercial|  41|        19|  -133.97|          0E-20|          0E-20|1.000000000000000...|0.065294272678777...|0.114549033890350...|0.546681662275965...|0.273475031154906...|            0E-20|0.147058823529411...|0.431372549019607...|0.421568627450980...|0.627636704151962...|0.490196078431372...|              5811.54|                 0E-20|        0.232784467690041...|0.06451612903225806|211.6773577235772...|163.5709146341463...|728.5714285714285...|20.63645076007931...|                    32.8|302.60|  5|-133.97|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|\n",
      "|   00035838|     302.60|        1|    2|              5|                    5|                 4|      245.29|         0.8|                D|        B1|        F|           Comercial|  41|        19|  -133.97|          0E-20|          0E-20|1.000000000000000...|0.065294272678777...|0.114549033890350...|0.546681662275965...|0.273475031154906...|            0E-20|0.147058823529411...|0.431372549019607...|0.421568627450980...|0.627636704151962...|0.490196078431372...|              5811.54|                 0E-20|        0.232784467690041...|0.06451612903225806|211.6773577235772...|163.5709146341463...|728.5714285714285...|20.63645076007931...|                    32.8|302.60|  5|-133.97|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|\n",
      "|   00035838|     302.60|        1|    2|              5|                    5|                 4|      245.29|         0.8|                D|        B1|        F|           Comercial|  41|        19|  -133.97|          0E-20|          0E-20|1.000000000000000...|0.065294272678777...|0.114549033890350...|0.546681662275965...|0.273475031154906...|            0E-20|0.147058823529411...|0.431372549019607...|0.421568627450980...|0.627636704151962...|0.490196078431372...|              5811.54|                 0E-20|        0.232784467690041...|0.06451612903225806|211.6773577235772...|163.5709146341463...|728.5714285714285...|20.63645076007931...|                    32.8|302.60|  5|-133.97|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|\n",
      "|   00035838|     302.60|        1|    2|              5|                    5|                 4|      245.29|         0.8|                D|        B1|        F|           Comercial|  41|        19|  -133.97|          0E-20|          0E-20|1.000000000000000...|0.065294272678777...|0.114549033890350...|0.546681662275965...|0.273475031154906...|            0E-20|0.147058823529411...|0.431372549019607...|0.421568627450980...|0.627636704151962...|0.490196078431372...|              5811.54|                 0E-20|        0.232784467690041...|0.06451612903225806|211.6773577235772...|163.5709146341463...|728.5714285714285...|20.63645076007931...|                    32.8|302.60|  5|-133.97|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|\n",
      "|   00035838|     302.60|        1|    2|              5|                    5|                 4|      245.29|         0.8|                D|        R1|        F|           Comercial|  41|        19|  -133.97|          0E-20|          0E-20|1.000000000000000...|0.065294272678777...|0.114549033890350...|0.546681662275965...|0.273475031154906...|            0E-20|0.147058823529411...|0.431372549019607...|0.421568627450980...|0.627636704151962...|0.490196078431372...|              5811.54|                 0E-20|        0.232784467690041...|0.06451612903225806|211.6773577235772...|163.5709146341463...|728.5714285714285...|20.63645076007931...|                    32.8|302.60|  5|-133.97|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|\n",
      "|   00035838|     302.60|        1|    2|              5|                    5|                 4|      245.29|         0.8|                D|        B1|        F|           Comercial|  41|        19|  -133.97|          0E-20|          0E-20|1.000000000000000...|0.065294272678777...|0.114549033890350...|0.546681662275965...|0.273475031154906...|            0E-20|0.147058823529411...|0.431372549019607...|0.421568627450980...|0.627636704151962...|0.490196078431372...|              5811.54|                 0E-20|        0.232784467690041...|0.06451612903225806|211.6773577235772...|163.5709146341463...|728.5714285714285...|20.63645076007931...|                    32.8|302.60|  5|-133.97|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|\n",
      "|   00035838|     302.60|        1|    2|              5|                    5|                 4|      245.29|         0.8|                D|        B1|        F|           Comercial|  41|        19|  -133.97|          0E-20|          0E-20|1.000000000000000...|0.065294272678777...|0.114549033890350...|0.546681662275965...|0.273475031154906...|            0E-20|0.147058823529411...|0.431372549019607...|0.421568627450980...|0.627636704151962...|0.490196078431372...|              5811.54|                 0E-20|        0.232784467690041...|0.06451612903225806|211.6773577235772...|163.5709146341463...|728.5714285714285...|20.63645076007931...|                    32.8|302.60|  5|-133.97|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|\n",
      "|   00035838|     302.60|        1|    2|              5|                    5|                 4|      245.29|         0.8|                D|        B1|        F|           Comercial|  41|        19|  -133.97|          0E-20|          0E-20|1.000000000000000...|0.065294272678777...|0.114549033890350...|0.546681662275965...|0.273475031154906...|            0E-20|0.147058823529411...|0.431372549019607...|0.421568627450980...|0.627636704151962...|0.490196078431372...|              5811.54|                 0E-20|        0.232784467690041...|0.06451612903225806|211.6773577235772...|163.5709146341463...|728.5714285714285...|20.63645076007931...|                    32.8|302.60|  5|-133.97|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|\n",
      "|   00035838|     302.60|        1|    2|              5|                    5|                 4|      245.29|         0.8|                D|        B1|        F|           Comercial|  41|        19|  -133.97|          0E-20|          0E-20|1.000000000000000...|0.065294272678777...|0.114549033890350...|0.546681662275965...|0.273475031154906...|            0E-20|0.147058823529411...|0.431372549019607...|0.421568627450980...|0.627636704151962...|0.490196078431372...|              5811.54|                 0E-20|        0.232784467690041...|0.06451612903225806|211.6773577235772...|163.5709146341463...|728.5714285714285...|20.63645076007931...|                    32.8|302.60|  5|-133.97|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|\n",
      "+-----------+-----------+---------+-----+---------------+---------------------+------------------+------------+------------+-----------------+----------+---------+--------------------+----+----------+---------+---------------+---------------+--------------------+--------------------+--------------------+--------------------+--------------------+-----------------+--------------------+--------------------+--------------------+--------------------+--------------------+---------------------+----------------------+----------------------------+-------------------+--------------------+--------------------+--------------------+--------------------+------------------------+------+---+-------+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+-----------+-------------------+---------------+-------+\n",
      "only showing top 20 rows\n",
      "\n"
     ]
    }
   ],
   "source": [
    "ctes = ctes.join(master,on=['customer_id'],how='left')\n",
    "ctes.show()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "+-----------+-----------+---------+-----+---------------+---------------------+------------------+------------+------------------+-----------------+----------+---------+--------------------+----+----------+---------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+---------------------+----------------------+----------------------------+--------------------+--------------------+--------------------+--------------------+--------------------+------------------------+-------+---+-------+------+---+---+-------+---+---+----+---+---+-----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+-----------+-------------------+---------------+-------+\n",
      "|customer_id|monto_total|n_tarjeta|n_com|n_reclamaciones|dictamen_afavor_total|NO_CLAIMS_12_MONTH|monto_12_mes|      div_comercio|tipo_tarjeta_moda|segment_id|gender_id|Segmento_descripcion|edad|antiguedad|pendiente|     COMPRAS_CREDITO|     RETIROS_CREDITO|      RETIROS_DEBITO|   COMPRAS_MADRUGADA|      COMPRAS_MANANA|       COMPRAS_TARDE|       COMPRAS_NOCHE|   RETIROS_MADRUGADA|      RETIROS_MANANA|       RETIROS_TARDE|       RETIROS_NOCHE|COMPRAS_ENTRE_SEMANA|RETIROS_ENTRE_SEMANA|MAX_DEBITO_DISPONIBLE|MAX_PORC_ENDEUDAMIENTO|PORCENTAJE_COMPRAS_ECOMMERCE|     razon_comercios| razon_transacciones|       razon_compras|       razon_retiros|      razon_ecomerce|facturacion/aclaraciones|     m1| r1|     p1|    m2| r2| p2|     m3| r3| p3|  m4| r4| p4|   m5| r5| p5|  m6| r6| p6|  m7| r7| p7|  m8| r8| p8|  m9| r9| p9| m10|r10|p10| m11|r11|p11| m12|r12|p12| m13|r13|p13|Delta_Monto|Delta_Reclamaciones|Delta_Pendiente|Bandera|\n",
      "+-----------+-----------+---------+-----+---------------+---------------------+------------------+------------+------------------+-----------------+----------+---------+--------------------+----+----------+---------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+---------------------+----------------------+----------------------------+--------------------+--------------------+--------------------+--------------------+--------------------+------------------------+-------+---+-------+------+---+---+-------+---+---+----+---+---+-----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+-----------+-------------------+---------------+-------+\n",
      "|   00035838|     302.60|        1|    2|              5|                    5|                 4|      245.29|               0.8|                D|        B1|        F|           Comercial|  41|        19|  -133.97|               0E-20|               0E-20|1.000000000000000...|0.065294272678777...|0.114549033890350...|0.546681662275965...|0.273475031154906...|               0E-20|0.147058823529411...|0.431372549019607...|0.421568627450980...|0.627636704151962...|0.490196078431372...|              5811.54|                 0E-20|        0.232784467690041...| 0.06451612903225806|211.6773577235772...|163.5709146341463...|728.5714285714285...|20.63645076007931...|                    32.8| 302.60|  5|-133.97|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|\n",
      "|   00054168|     910.00|        1|    2|              2|                    2|                 1|       95.00|               0.5|                D|        B1|        F|           Comercial|  32|        11|      0.0|               0E-20|               0E-20|0.992300544271870...|0.127441894563249...|0.512441207735568...|0.285136049270907...|0.074980848430274...|               0E-20|0.399309703969202...|0.247245453338643...|0.353444842692154...|0.373703497045159...|0.613965219699986...|             47355.17|                 0E-20|        0.143899470642837...| 0.11764705882352941|2157.447964601769...|303.4632584269662...|3348.000000000000...|4.270846153846153...|                    44.5| 815.00|  1|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0|95.00|  1|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|\n",
      "|   00147123|    3600.00|        1|    1|              3|                    3|                 0|        0.00|               1.0|                D|        B1|        F|           Comercial|  29|        11|      0.0|0.000475816393873...|               0E-20|1.000000000000000...|0.004956103558583...|0.104494038258492...|0.409185920973558...|0.481363937209365...|               0E-20|0.581395348837209...|0.418604651162790...|               0E-20|0.908869740979829...|0.534883720930232...|             13899.98|  0.666666666666666...|                       0E-20| 0.08333333333333333|1362.276578947368...|840.6604000000000...|5016.666666666666...|               0E-20|       8.333333333333334|3600.00|  3|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|\n",
      "|   00152272|    1053.90|        1|    2|              4|                    4|                 1|       99.00|               0.5|                D|        B1|        F|           Comercial|  27|        11|      0.0|               0E-20|               0E-20|1.000000000000000...|0.168606118600467...|0.196139735720107...|0.521015851864567...|0.114238293814857...|               0E-20|0.291954022988505...|0.535632183908045...|0.172413793103448...|0.493490733037196...|0.636781609195402...|             36238.06|                 0E-20|        0.397269668660082...| 0.16666666666666666|780.7880000000000...|301.7197435897435...|1359.375000000000...|4.435620077806243...|                    9.75|1053.90|  4|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|\n",
      "|   00194397|      99.00|        1|    1|              1|                    1|                 0|        0.00|               1.0|                D|        F9|        F|            Personal|  28|        11|      0.0|               0E-20|               0E-20|1.000000000000000...|0.103444808238909...|0.043921526871988...|0.692807369351943...|0.159826295537158...|               0E-20|               0E-20|1.000000000000000...|               0E-20|0.785044794042052...|               0E-20|            135621.65|                 0E-20|        0.088864931692413...|                 0.1|707.8614285714285...|563.5050000000000...|3000.000000000000...|12.13959595959595...|                    24.0|  99.00|  1|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|\n",
      "|   00444268|     251.00|        1|    2|              2|                    2|                 1|      151.00|               0.5|                D|        B1|        M|           Comercial|  26|        11|      0.0|0.455541602660661...|0.064039408866995...|0.935960591133004...|0.070778362738810...|0.119415370389703...|0.569920209989411...|0.239886056882074...|               0E-20|0.133004926108374...|0.724137931034482...|0.142857142857142...|0.597687730235194...|0.408866995073891...|              3417.75|  0.577727272727272...|        0.089484124024995...| 0.08333333333333333|222.9747023809523...|169.3207070707070...|312.3076923076923...|5.976095617529880...|                    49.5| 100.00|  1|    0.0|151.00|  1|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|\n",
      "|   00447923|    2739.00|        1|    4|              4|                    3|                 3|     2089.00|              0.25|                D|        B1|        F|           Comercial|  26|        11|      0.0|               0E-20|               0E-20|1.000000000000000...|               0E-20|0.371781115879828...|0.583261802575107...|0.044957081545064...|               0E-20|0.375036374974017...|0.507888172937019...|0.117075452088962...|0.955042918454935...|0.721159842028684...|             14217.08|                 0E-20|        0.008583690987124...|                 0.4|864.5909090909090...|548.2352941176470...|1436.119402985074...|0.029207740051113...|                    4.25| 650.00|  1|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|\n",
      "|   00458134|     768.00|        1|    1|              1|                    1|                 0|        0.00|               1.0|                D|        B1|        M|           Comercial|  28|        11|      0.0|0.429717543001600...|0.015160374605859...|0.984839625394140...|0.063369268930590...|0.215006873998695...|0.439986663786686...|0.281637193284027...|0.011864742403077...|0.528305002480470...|0.205196603236436...|0.254633651880014...|0.624758049975534...|0.867411095481671...|             13735.58|  0.994913333333333...|        0.052575042809954...|0.016129032258064516|832.5283024691358...|415.2228125000000...|1405.735409836065...|6.367187500000000...|                   224.0| 768.00|  1|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|\n",
      "|   00461820|     100.00|        1|    1|              1|                    1|                 0|        0.00|               1.0|                D|        B1|        M|           Comercial|  27|        11|      0.0|0.791631935267448...|               0E-20|1.000000000000000...|               0E-20|0.046557017098013...|0.202675503689999...|0.750767479211986...|               0E-20|0.164974619289340...|0.479332849891225...|0.355692530819434...|0.159147742289629...|0.211747643219724...|             11557.36|  0.028666666666666...|        0.020330575151971...| 0.07142857142857142|666.2743842364532...|273.2611111111111...|1970.000000000000...|1.000000000000000...|                    18.0| 100.00|  1|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|\n",
      "|   00475697|     753.11|        1|    1|              1|                    1|                 0|        0.00|               1.0|                D|        R1|        M|           Comercial|  26|        11|      0.0|               0E-20|               0E-20|1.000000000000000...|0.057199032746502...|0.086195486961605...|0.469515753217079...|0.387089727074811...|0.042338709677419...|0.121975806451612...|0.376008064516129...|0.459677419354838...|0.453035009917651...|0.444556451612903...|              8525.32|                 0E-20|        0.076524690402970...|0.012195121951219513|388.8908370044052...|248.3037410071942...|604.8780487804878...|3.507044123700389...|                   139.0| 753.11|  1|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|\n",
      "|   00522122|     178.00|        2|    2|              2|                    2|                 0|        0.00|               0.5|                C|        B1|        M|           Comercial|  40|        11|      0.0|0.473876011866207...|               0E-20|1.000000000000000...|0.070043374373439...|0.183346394947702...|0.552042413562021...|0.194567817116836...|0.009033423667570...|0.434507678410117...|0.478771454381210...|0.077687443541102...|0.486684338400024...|0.610659439927732...|            119380.30|  0.944426969222743...|        0.052608747870185...| 0.02127659574468085|1019.586846590909...|774.6092307692307...|1064.423076923076...|50.59561797752808...|                   110.5|  79.00|  1|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|\n",
      "|   00529362|      51.00|        1|    1|              1|                    1|                 0|        0.00|               1.0|                D|        F9|        F|            Personal|  32|        11|      0.0|               0E-20|               0E-20|1.000000000000000...|0.031129679691980...|0.102400262144671...|0.303416072745146...|0.563053985418202...|               0E-20|0.170560747663551...|0.829439252336448...|               0E-20|0.136260615493842...|0.446261682242990...|              8726.09|                 0E-20|        0.004096010485786...| 0.08333333333333333|709.0282051282051...|197.9513513513513...|3566.666666666666...|0.588235294117647...|                    37.0|  51.00|  1|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|\n",
      "|   00731582|      98.00|        1|    1|              2|                    2|                 0|        0.00|               1.0|                D|        Q1|        M|            Personal|  44|        11|      0.0|0.908036173766601...|               0E-20|1.000000000000000...|0.002261920025374...|0.328565146581530...|0.404970184263125...|0.264202749129969...|               0E-20|0.755752212389380...|0.226548672566371...|0.017699115044247...|0.411707873240645...|0.751327433628318...|             49827.18|  0.697592692307692...|        0.024122614149432...| 0.00909090909090909|1064.582133333333...|871.1455384615384...|2404.255319148936...|69.69030612244897...|                   162.5|  98.00|  2|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|\n",
      "|   00971551|    3182.00|        1|    2|              3|                    3|                 2|     1432.00|0.6666666666666666|                C|        B1|        F|           Comercial|  30|        11|      0.0|0.306236498370886...|               0E-20|1.000000000000000...|0.015708941735873...|0.627418738930048...|0.220389465491448...|0.136482853842629...|               0E-20|0.123386109685316...|0.518221660678327...|0.358392229636356...|0.732702845804695...|0.567862360326923...|             31111.14|  0.916483333333333...|        0.043054084541000...| 0.06451612903225806|887.7444715447154...|758.7356000000000...|2894.514285714285...|0.769956002514142...|                    25.0|1750.00|  1|    0.0|  0.00|  0|0.0|1432.00|  2|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|\n",
      "|   01146807|    1157.00|        1|    1|              3|                    3|                 0|        0.00|               1.0|                D|        R1|        M|           Comercial|  38|        16|      0.0|               0E-20|               0E-20|1.000000000000000...|0.009772658039728...|0.152037467138336...|0.497329687222117...|0.340860187599817...|0.009920634920634...|0.313492063492063...|0.490079365079365...|0.186507936507936...|0.473036268006782...|0.488095238095238...|              9122.52|                 0E-20|        0.296432891773534...| 0.01818181818181818|464.9611724137931...|220.5479611650485...|446.0176991150442...|5.820138288677614...|      34.333333333333336|1157.00|  3|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|\n",
      "|   02039499|     448.35|        1|    1|              1|                    0|                 0|        0.00|               1.0|                D|        B1|        F|           Comercial|  41|        11|      0.0|0.058588760477428...|               0E-20|1.000000000000000...|0.016325126166080...|0.294659151319191...|0.540437230099257...|0.148578492415470...|0.043140638481449...|0.311475409836065...|0.570319240724762...|0.075064710957722...|0.845943023179603...|0.322691975841242...|             11761.76|  1.270313333333333...|        0.053344402449770...| 0.02702702702702703|1519.275277777777...|450.2262295081967...|3996.551724137931...|3.267625738820118...|                    61.0| 448.35|  1|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|\n",
      "|   02116751|     100.00|        1|    1|              1|                    1|                 0|        0.00|               1.0|                D|        R1|        F|           Comercial|  57|        10|      0.0|               0E-20|               0E-20|1.000000000000000...|0.093513452036444...|0.175159156928429...|0.444634487123769...|0.286692903911356...|               0E-20|0.145867098865478...|0.486223662884927...|0.367909238249594...|0.628803242092701...|0.706464973887988...|             20570.65|                 0E-20|        0.153291733949284...|                0.05|386.9962734584450...|108.3368452380952...|1354.390243902439...|27.90000000000000...|                   168.0| 100.00|  1|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|\n",
      "|   02133818|    3075.80|        1|    1|              1|                    1|                 0|        0.00|               1.0|                D|        B1|        M|           Comercial|  29|        10|      0.0|               0E-20|               0E-20|1.000000000000000...|0.005023286722470...|0.223532610952897...|0.566425249564742...|0.205018852759889...|               0E-20|0.633893919793014...|0.256144890038809...|0.109961190168175...|0.467667713231505...|0.553040103492884...|              9837.32|                 0E-20|        0.041454743834827...|0.017857142857142856|542.6802285714285...|326.9177981651376...|417.8378378378378...|0.480265296833344...|                   109.0|3075.80|  1|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|\n",
      "|   02295358|      99.00|        1|    1|              1|                    1|                 0|        0.00|               1.0|                D|        R1|        M|           Comercial|  22|        11|      0.0|               0E-20|               0E-20|0.990990990990990...|0.168643422699437...|0.307679819362683...|0.119136307123196...|0.404540450814681...|0.180180180180180...|               0E-20|0.342342342342342...|0.477477477477477...|0.273454150276530...|0.315315315315315...|              3200.00|                 0E-20|        0.285848944860392...|                0.04|253.0200714285714...|112.8300000000000...|326.4705882352941...|34.85858585858585...|                   107.0|  99.00|  1|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|\n",
      "|   02390650|    1739.81|        2|    2|              2|                    2|                 1|     1645.00|               0.5|                C|        Q1|        M|            Personal|  33|        10|      0.0|1.000000000000000...|0.267256187645910...|0.732743812354089...|0.099367129315220...|0.146542290063050...|0.432448644875459...|0.321641935746269...|0.042847796779668...|0.390909894904411...|0.170075933234991...|0.396166375080927...|0.510553504104059...|0.545046878596397...|             51360.66|  0.543519842519685...|        0.094318209763858...|  0.0106951871657754|455.1348837209302...|357.1777027027027...|2519.882857142857...|11.46303906748438...|                   296.0|  94.81|  1|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|\n",
      "+-----------+-----------+---------+-----+---------------+---------------------+------------------+------------+------------------+-----------------+----------+---------+--------------------+----+----------+---------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+---------------------+----------------------+----------------------------+--------------------+--------------------+--------------------+--------------------+--------------------+------------------------+-------+---+-------+------+---+---+-------+---+---+----+---+---+-----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+-----------+-------------------+---------------+-------+\n",
      "only showing top 20 rows\n",
      "\n"
     ]
    }
   ],
   "source": [
    "#Quitamos duplicados y cambiamos NA\n",
    "ctes = ctes.drop_duplicates(subset=[\"customer_id\"])\n",
    "ctes.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Data Wrangling"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "metadata": {},
   "outputs": [],
   "source": [
    "###-------------------Tratamiento de variables categoricas a numericas---------------------\n",
    "pivoted = ctes.groupBy(\"customer_id\").pivot(\"gender_id\").agg(F.lit(1))\n",
    "pivoted = pivoted.drop('null').na.fill(0)\n",
    "\n",
    "comercial = ['B1','B2','B3','B4','B5','B6','B7','B8','B9','BA','BB','BC','BF',\n",
    "           'D1','D2','D3','D4','D7','D8','D9','F1','F2','F3','F4','F5','F6',\n",
    "           'F7','F8','FE','FF','FM','H1','N1','R1','R2','R3','R4','R5','R6',\n",
    "           'S0','S1','T1','U1','X1','X2','X3','X4','X5']\n",
    "corporativa = ['C0']\n",
    "beyg = ['E0','E1','E2','E3','G0','G1','G2','G3']\n",
    "personal = ['F9','Q1']\n",
    "patrimonial = ['P0','P1','P2','P3','P4','P5','P6','P7','P8','P9']\n",
    "pyme = ['Y1','Y2']\n",
    "ctes_seg = ctes.withColumn(\"Segmento_descripcion\", F.when(F.col('segment_id').isin(comercial), 'Comercial')\n",
    "                              .when(F.col('segment_id').isin(corporativa), 'Corporativa')\n",
    "                              .when(F.col('segment_id').isin(beyg), 'BEyG')\n",
    "                              .when(F.col('segment_id').isin(personal), 'Personal')\n",
    "                              .when(F.col('segment_id').isin(patrimonial), 'Patrimonial')\n",
    "                              .when(F.col('segment_id').isin(pyme), 'PyME')\n",
    "                              .otherwise('Cliente Nuevo'))\n",
    "\n",
    "pivoted1 = ctes_seg.groupBy(\"customer_id\").pivot(\"Segmento_descripcion\").agg(F.lit(1))\n",
    "pivoted1 = pivoted1.drop('null').na.fill(0)\n",
    "\n",
    "pivoted2 = ctes_seg.groupBy(\"customer_id\").pivot(\"tipo_tarjeta_moda\").agg(F.lit(1))\n",
    "pivoted2 = pivoted2.drop('null').na.fill(0)\n",
    "\n",
    "#----------------------Union de la tabla con las variables dummy creadas\n",
    "ctes_d = ctes_seg.drop('tipo_tarjeta_moda','gender_id','segment_id','Segmento_descripcion')\n",
    "ctes1 = ctes_d.join(pivoted, on = ['customer_id'], how = 'left')\n",
    "ctes2 = ctes1.join(pivoted1, on = ['customer_id'], how = 'left')\n",
    "ctes3 = ctes2.join(pivoted2, on = ['customer_id'], how = 'left')\n",
    "\n",
    "ctes3 = ctes3.withColumn('aclarciones/facturacion', 1/ F.col('facturacion/aclaraciones'))\n",
    "\n",
    "ctes3 = ctes3.fillna(0)\n",
    "#ctes3.columns\n",
    "\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "+-----------+-----------+---------+-----+---------------+---------------------+------------------+------------+------------------+----+----------+---------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+---------------------+----------------------+----------------------------+--------------------+--------------------+--------------------+--------------------+--------------------+------------------------+-------+---+-------+------+---+---+-------+---+---+----+---+---+-----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+-----------+-------------------+---------------+-------+---+---+----+-------------+---------+-----------+-----------+--------+----+---+---+-----------------------+\n",
      "|customer_id|monto_total|n_tarjeta|n_com|n_reclamaciones|dictamen_afavor_total|NO_CLAIMS_12_MONTH|monto_12_mes|      div_comercio|edad|antiguedad|pendiente|     COMPRAS_CREDITO|     RETIROS_CREDITO|      RETIROS_DEBITO|   COMPRAS_MADRUGADA|      COMPRAS_MANANA|       COMPRAS_TARDE|       COMPRAS_NOCHE|   RETIROS_MADRUGADA|      RETIROS_MANANA|       RETIROS_TARDE|       RETIROS_NOCHE|COMPRAS_ENTRE_SEMANA|RETIROS_ENTRE_SEMANA|MAX_DEBITO_DISPONIBLE|MAX_PORC_ENDEUDAMIENTO|PORCENTAJE_COMPRAS_ECOMMERCE|     razon_comercios| razon_transacciones|       razon_compras|       razon_retiros|      razon_ecomerce|facturacion/aclaraciones|     m1| r1|     p1|    m2| r2| p2|     m3| r3| p3|  m4| r4| p4|   m5| r5| p5|  m6| r6| p6|  m7| r7| p7|  m8| r8| p8|  m9| r9| p9| m10|r10|p10| m11|r11|p11| m12|r12|p12| m13|r13|p13|Delta_Monto|Delta_Reclamaciones|Delta_Pendiente|Bandera|  F|  M|BEyG|Cliente Nuevo|Comercial|Corporativa|Patrimonial|Personal|PyME|  C|  D|aclarciones/facturacion|\n",
      "+-----------+-----------+---------+-----+---------------+---------------------+------------------+------------+------------------+----+----------+---------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+---------------------+----------------------+----------------------------+--------------------+--------------------+--------------------+--------------------+--------------------+------------------------+-------+---+-------+------+---+---+-------+---+---+----+---+---+-----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+-----------+-------------------+---------------+-------+---+---+----+-------------+---------+-----------+-----------+--------+----+---+---+-----------------------+\n",
      "|   00035838|     302.60|        1|    2|              5|                    5|                 4|      245.29|               0.8|  41|        19|  -133.97|               0E-20|               0E-20|1.000000000000000...|0.065294272678777...|0.114549033890350...|0.546681662275965...|0.273475031154906...|               0E-20|0.147058823529411...|0.431372549019607...|0.421568627450980...|0.627636704151962...|0.490196078431372...|              5811.54|                 0E-20|        0.232784467690041...| 0.06451612903225806|211.6773577235772...|163.5709146341463...|728.5714285714285...|20.63645076007931...|                    32.8| 302.60|  5|-133.97|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  1|  0|   0|            0|        1|          0|          0|       0|   0|  0|  1|   0.030487804878048783|\n",
      "|   00054168|     910.00|        1|    2|              2|                    2|                 1|       95.00|               0.5|  32|        11|      0.0|               0E-20|               0E-20|0.992300544271870...|0.127441894563249...|0.512441207735568...|0.285136049270907...|0.074980848430274...|               0E-20|0.399309703969202...|0.247245453338643...|0.353444842692154...|0.373703497045159...|0.613965219699986...|             47355.17|                 0E-20|        0.143899470642837...| 0.11764705882352941|2157.447964601769...|303.4632584269662...|3348.000000000000...|4.270846153846153...|                    44.5| 815.00|  1|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0|95.00|  1|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  1|  0|   0|            0|        1|          0|          0|       0|   0|  0|  1|    0.02247191011235955|\n",
      "|   00147123|    3600.00|        1|    1|              3|                    3|                 0|        0.00|               1.0|  29|        11|      0.0|0.000475816393873...|               0E-20|1.000000000000000...|0.004956103558583...|0.104494038258492...|0.409185920973558...|0.481363937209365...|               0E-20|0.581395348837209...|0.418604651162790...|               0E-20|0.908869740979829...|0.534883720930232...|             13899.98|  0.666666666666666...|                       0E-20| 0.08333333333333333|1362.276578947368...|840.6604000000000...|5016.666666666666...|               0E-20|       8.333333333333334|3600.00|  3|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  1|  0|   0|            0|        1|          0|          0|       0|   0|  0|  1|                   0.12|\n",
      "|   00152272|    1053.90|        1|    2|              4|                    4|                 1|       99.00|               0.5|  27|        11|      0.0|               0E-20|               0E-20|1.000000000000000...|0.168606118600467...|0.196139735720107...|0.521015851864567...|0.114238293814857...|               0E-20|0.291954022988505...|0.535632183908045...|0.172413793103448...|0.493490733037196...|0.636781609195402...|             36238.06|                 0E-20|        0.397269668660082...| 0.16666666666666666|780.7880000000000...|301.7197435897435...|1359.375000000000...|4.435620077806243...|                    9.75|1053.90|  4|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  1|  0|   0|            0|        1|          0|          0|       0|   0|  0|  1|    0.10256410256410256|\n",
      "|   00194397|      99.00|        1|    1|              1|                    1|                 0|        0.00|               1.0|  28|        11|      0.0|               0E-20|               0E-20|1.000000000000000...|0.103444808238909...|0.043921526871988...|0.692807369351943...|0.159826295537158...|               0E-20|               0E-20|1.000000000000000...|               0E-20|0.785044794042052...|               0E-20|            135621.65|                 0E-20|        0.088864931692413...|                 0.1|707.8614285714285...|563.5050000000000...|3000.000000000000...|12.13959595959595...|                    24.0|  99.00|  1|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  1|  0|   0|            0|        0|          0|          0|       1|   0|  0|  1|   0.041666666666666664|\n",
      "|   00444268|     251.00|        1|    2|              2|                    2|                 1|      151.00|               0.5|  26|        11|      0.0|0.455541602660661...|0.064039408866995...|0.935960591133004...|0.070778362738810...|0.119415370389703...|0.569920209989411...|0.239886056882074...|               0E-20|0.133004926108374...|0.724137931034482...|0.142857142857142...|0.597687730235194...|0.408866995073891...|              3417.75|  0.577727272727272...|        0.089484124024995...| 0.08333333333333333|222.9747023809523...|169.3207070707070...|312.3076923076923...|5.976095617529880...|                    49.5| 100.00|  1|    0.0|151.00|  1|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  0|  1|   0|            0|        1|          0|          0|       0|   0|  0|  1|   0.020202020202020204|\n",
      "|   00447923|    2739.00|        1|    4|              4|                    3|                 3|     2089.00|              0.25|  26|        11|      0.0|               0E-20|               0E-20|1.000000000000000...|               0E-20|0.371781115879828...|0.583261802575107...|0.044957081545064...|               0E-20|0.375036374974017...|0.507888172937019...|0.117075452088962...|0.955042918454935...|0.721159842028684...|             14217.08|                 0E-20|        0.008583690987124...|                 0.4|864.5909090909090...|548.2352941176470...|1436.119402985074...|0.029207740051113...|                    4.25| 650.00|  1|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  1|  0|   0|            0|        1|          0|          0|       0|   0|  0|  1|    0.23529411764705882|\n",
      "|   00458134|     768.00|        1|    1|              1|                    1|                 0|        0.00|               1.0|  28|        11|      0.0|0.429717543001600...|0.015160374605859...|0.984839625394140...|0.063369268930590...|0.215006873998695...|0.439986663786686...|0.281637193284027...|0.011864742403077...|0.528305002480470...|0.205196603236436...|0.254633651880014...|0.624758049975534...|0.867411095481671...|             13735.58|  0.994913333333333...|        0.052575042809954...|0.016129032258064516|832.5283024691358...|415.2228125000000...|1405.735409836065...|6.367187500000000...|                   224.0| 768.00|  1|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  0|  1|   0|            0|        1|          0|          0|       0|   0|  0|  1|   0.004464285714285714|\n",
      "|   00461820|     100.00|        1|    1|              1|                    1|                 0|        0.00|               1.0|  27|        11|      0.0|0.791631935267448...|               0E-20|1.000000000000000...|               0E-20|0.046557017098013...|0.202675503689999...|0.750767479211986...|               0E-20|0.164974619289340...|0.479332849891225...|0.355692530819434...|0.159147742289629...|0.211747643219724...|             11557.36|  0.028666666666666...|        0.020330575151971...| 0.07142857142857142|666.2743842364532...|273.2611111111111...|1970.000000000000...|1.000000000000000...|                    18.0| 100.00|  1|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  0|  1|   0|            0|        1|          0|          0|       0|   0|  0|  1|    0.05555555555555555|\n",
      "|   00475697|     753.11|        1|    1|              1|                    1|                 0|        0.00|               1.0|  26|        11|      0.0|               0E-20|               0E-20|1.000000000000000...|0.057199032746502...|0.086195486961605...|0.469515753217079...|0.387089727074811...|0.042338709677419...|0.121975806451612...|0.376008064516129...|0.459677419354838...|0.453035009917651...|0.444556451612903...|              8525.32|                 0E-20|        0.076524690402970...|0.012195121951219513|388.8908370044052...|248.3037410071942...|604.8780487804878...|3.507044123700389...|                   139.0| 753.11|  1|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  0|  1|   0|            0|        1|          0|          0|       0|   0|  0|  1|   0.007194244604316547|\n",
      "|   00522122|     178.00|        2|    2|              2|                    2|                 0|        0.00|               0.5|  40|        11|      0.0|0.473876011866207...|               0E-20|1.000000000000000...|0.070043374373439...|0.183346394947702...|0.552042413562021...|0.194567817116836...|0.009033423667570...|0.434507678410117...|0.478771454381210...|0.077687443541102...|0.486684338400024...|0.610659439927732...|            119380.30|  0.944426969222743...|        0.052608747870185...| 0.02127659574468085|1019.586846590909...|774.6092307692307...|1064.423076923076...|50.59561797752808...|                   110.5|  79.00|  1|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  0|  1|   0|            0|        1|          0|          0|       0|   0|  1|  0|    0.00904977375565611|\n",
      "|   00529362|      51.00|        1|    1|              1|                    1|                 0|        0.00|               1.0|  32|        11|      0.0|               0E-20|               0E-20|1.000000000000000...|0.031129679691980...|0.102400262144671...|0.303416072745146...|0.563053985418202...|               0E-20|0.170560747663551...|0.829439252336448...|               0E-20|0.136260615493842...|0.446261682242990...|              8726.09|                 0E-20|        0.004096010485786...| 0.08333333333333333|709.0282051282051...|197.9513513513513...|3566.666666666666...|0.588235294117647...|                    37.0|  51.00|  1|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  1|  0|   0|            0|        0|          0|          0|       1|   0|  0|  1|    0.02702702702702703|\n",
      "|   00731582|      98.00|        1|    1|              2|                    2|                 0|        0.00|               1.0|  44|        11|      0.0|0.908036173766601...|               0E-20|1.000000000000000...|0.002261920025374...|0.328565146581530...|0.404970184263125...|0.264202749129969...|               0E-20|0.755752212389380...|0.226548672566371...|0.017699115044247...|0.411707873240645...|0.751327433628318...|             49827.18|  0.697592692307692...|        0.024122614149432...| 0.00909090909090909|1064.582133333333...|871.1455384615384...|2404.255319148936...|69.69030612244897...|                   162.5|  98.00|  2|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  0|  1|   0|            0|        0|          0|          0|       1|   0|  0|  1|   0.006153846153846154|\n",
      "|   00971551|    3182.00|        1|    2|              3|                    3|                 2|     1432.00|0.6666666666666666|  30|        11|      0.0|0.306236498370886...|               0E-20|1.000000000000000...|0.015708941735873...|0.627418738930048...|0.220389465491448...|0.136482853842629...|               0E-20|0.123386109685316...|0.518221660678327...|0.358392229636356...|0.732702845804695...|0.567862360326923...|             31111.14|  0.916483333333333...|        0.043054084541000...| 0.06451612903225806|887.7444715447154...|758.7356000000000...|2894.514285714285...|0.769956002514142...|                    25.0|1750.00|  1|    0.0|  0.00|  0|0.0|1432.00|  2|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  1|  0|   0|            0|        1|          0|          0|       0|   0|  1|  0|                   0.04|\n",
      "|   01146807|    1157.00|        1|    1|              3|                    3|                 0|        0.00|               1.0|  38|        16|      0.0|               0E-20|               0E-20|1.000000000000000...|0.009772658039728...|0.152037467138336...|0.497329687222117...|0.340860187599817...|0.009920634920634...|0.313492063492063...|0.490079365079365...|0.186507936507936...|0.473036268006782...|0.488095238095238...|              9122.52|                 0E-20|        0.296432891773534...| 0.01818181818181818|464.9611724137931...|220.5479611650485...|446.0176991150442...|5.820138288677614...|      34.333333333333336|1157.00|  3|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  0|  1|   0|            0|        1|          0|          0|       0|   0|  0|  1|   0.029126213592233007|\n",
      "|   02039499|     448.35|        1|    1|              1|                    0|                 0|        0.00|               1.0|  41|        11|      0.0|0.058588760477428...|               0E-20|1.000000000000000...|0.016325126166080...|0.294659151319191...|0.540437230099257...|0.148578492415470...|0.043140638481449...|0.311475409836065...|0.570319240724762...|0.075064710957722...|0.845943023179603...|0.322691975841242...|             11761.76|  1.270313333333333...|        0.053344402449770...| 0.02702702702702703|1519.275277777777...|450.2262295081967...|3996.551724137931...|3.267625738820118...|                    61.0| 448.35|  1|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  1|  0|   0|            0|        1|          0|          0|       0|   0|  0|  1|    0.01639344262295082|\n",
      "|   02116751|     100.00|        1|    1|              1|                    1|                 0|        0.00|               1.0|  57|        10|      0.0|               0E-20|               0E-20|1.000000000000000...|0.093513452036444...|0.175159156928429...|0.444634487123769...|0.286692903911356...|               0E-20|0.145867098865478...|0.486223662884927...|0.367909238249594...|0.628803242092701...|0.706464973887988...|             20570.65|                 0E-20|        0.153291733949284...|                0.05|386.9962734584450...|108.3368452380952...|1354.390243902439...|27.90000000000000...|                   168.0| 100.00|  1|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  1|  0|   0|            0|        1|          0|          0|       0|   0|  0|  1|   0.005952380952380952|\n",
      "|   02133818|    3075.80|        1|    1|              1|                    1|                 0|        0.00|               1.0|  29|        10|      0.0|               0E-20|               0E-20|1.000000000000000...|0.005023286722470...|0.223532610952897...|0.566425249564742...|0.205018852759889...|               0E-20|0.633893919793014...|0.256144890038809...|0.109961190168175...|0.467667713231505...|0.553040103492884...|              9837.32|                 0E-20|        0.041454743834827...|0.017857142857142856|542.6802285714285...|326.9177981651376...|417.8378378378378...|0.480265296833344...|                   109.0|3075.80|  1|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  0|  1|   0|            0|        1|          0|          0|       0|   0|  0|  1|   0.009174311926605505|\n",
      "|   02295358|      99.00|        1|    1|              1|                    1|                 0|        0.00|               1.0|  22|        11|      0.0|               0E-20|               0E-20|0.990990990990990...|0.168643422699437...|0.307679819362683...|0.119136307123196...|0.404540450814681...|0.180180180180180...|               0E-20|0.342342342342342...|0.477477477477477...|0.273454150276530...|0.315315315315315...|              3200.00|                 0E-20|        0.285848944860392...|                0.04|253.0200714285714...|112.8300000000000...|326.4705882352941...|34.85858585858585...|                   107.0|  99.00|  1|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  0|  1|   0|            0|        1|          0|          0|       0|   0|  0|  1|   0.009345794392523364|\n",
      "|   02390650|    1739.81|        2|    2|              2|                    2|                 1|     1645.00|               0.5|  33|        10|      0.0|1.000000000000000...|0.267256187645910...|0.732743812354089...|0.099367129315220...|0.146542290063050...|0.432448644875459...|0.321641935746269...|0.042847796779668...|0.390909894904411...|0.170075933234991...|0.396166375080927...|0.510553504104059...|0.545046878596397...|             51360.66|  0.543519842519685...|        0.094318209763858...|  0.0106951871657754|455.1348837209302...|357.1777027027027...|2519.882857142857...|11.46303906748438...|                   296.0|  94.81|  1|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  0|  1|   0|            0|        0|          0|          0|       1|   0|  1|  0|   0.003378378378378...|\n",
      "+-----------+-----------+---------+-----+---------------+---------------------+------------------+------------+------------------+----+----------+---------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+---------------------+----------------------+----------------------------+--------------------+--------------------+--------------------+--------------------+--------------------+------------------------+-------+---+-------+------+---+---+-------+---+---+----+---+---+-----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+-----------+-------------------+---------------+-------+---+---+----+-------------+---------+-----------+-----------+--------+----+---+---+-----------------------+\n",
      "only showing top 20 rows\n",
      "\n"
     ]
    }
   ],
   "source": [
    "ctes3.show() \n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Creando Vector"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "metadata": {},
   "outputs": [],
   "source": [
    "\n",
    "vecAssembler = VectorAssembler(inputCols=[\n",
    " 'monto_total',\n",
    " 'n_tarjeta',\n",
    " 'n_com',\n",
    " 'n_reclamaciones',\n",
    " 'dictamen_afavor_total',\n",
    " 'div_comercio',\n",
    " 'pendiente',\n",
    " 'COMPRAS_CREDITO',\n",
    " 'RETIROS_DEBITO',\n",
    " 'COMPRAS_MADRUGADA',\n",
    " 'COMPRAS_MANANA',\n",
    " 'COMPRAS_TARDE',\n",
    " 'COMPRAS_NOCHE',\n",
    " 'RETIROS_MADRUGADA',\n",
    " 'RETIROS_MANANA',\n",
    " 'RETIROS_TARDE',\n",
    " 'RETIROS_NOCHE',\n",
    " 'COMPRAS_ENTRE_SEMANA',\n",
    " 'RETIROS_ENTRE_SEMANA',\n",
    " 'MAX_DEBITO_DISPONIBLE',\n",
    " 'MAX_PORC_ENDEUDAMIENTO',\n",
    " 'razon_transacciones',\n",
    " 'razon_compras',\n",
    " 'razon_retiros',\n",
    " 'razon_ecomerce',\n",
    " 'aclarciones/facturacion',\n",
    " 'BEyG',\n",
    " 'Comercial',\n",
    " 'Corporativa',\n",
    " 'Patrimonial',\n",
    " 'Personal',\n",
    " 'C',\n",
    " 'Delta_Monto',\n",
    " 'Delta_Reclamaciones',\n",
    " 'Delta_Pendiente',\n",
    "], outputCol=\"features\")\n",
    "#print(vecAssembler)\n",
    "n_ctes = vecAssembler.transform(ctes3)\n",
    "#n_ctes.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## M√©todo del Codo"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 1440x720 with 1 Axes>"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "dataset = n_ctes\n",
    "# Calcular el coste y gr√°ficar\n",
    "cost = np.zeros(15)\n",
    "\n",
    "for k in range(2,15):\n",
    "    kmeans = KMeans().setK(k).setSeed(1).setFeaturesCol('features')\n",
    "    model = kmeans.fit(dataset.select('features'))\n",
    "    cost[k] = model.computeCost(dataset.select('features'))\n",
    "\n",
    "# Gr√°fica del coste\n",
    "df_cost = pd.DataFrame(cost[2:])\n",
    "df_cost.columns = [\"cost\"]\n",
    "\n",
    "new_col = [2,3,4,5,6,7,8, 9,10,11,12,13,14]\n",
    "df_cost.insert(0, 'cluster', new_col)\n",
    "\n",
    "import pylab as pl\n",
    "pl.figure(figsize=(20, 10))\n",
    "pl.plot(df_cost.cluster, df_cost.cost)\n",
    "pl.xlabel('Numero de Clusters')\n",
    "pl.ylabel('Score')\n",
    "pl.title('Curva de Codo')\n",
    "pl.show()\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## K - Means"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "+-----------+-----------+---------+-----+---------------+---------------------+------------------+------------+------------------+----+----------+---------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+---------------------+----------------------+----------------------------+--------------------+--------------------+--------------------+--------------------+--------------------+------------------------+-------+---+-------+------+---+---+-------+---+---+----+---+---+-----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+-----------+-------------------+---------------+-------+---+---+----+-------------+---------+-----------+-----------+--------+----+---+---+-----------------------+--------------------+----------+\n",
      "|customer_id|monto_total|n_tarjeta|n_com|n_reclamaciones|dictamen_afavor_total|NO_CLAIMS_12_MONTH|monto_12_mes|      div_comercio|edad|antiguedad|pendiente|     COMPRAS_CREDITO|     RETIROS_CREDITO|      RETIROS_DEBITO|   COMPRAS_MADRUGADA|      COMPRAS_MANANA|       COMPRAS_TARDE|       COMPRAS_NOCHE|   RETIROS_MADRUGADA|      RETIROS_MANANA|       RETIROS_TARDE|       RETIROS_NOCHE|COMPRAS_ENTRE_SEMANA|RETIROS_ENTRE_SEMANA|MAX_DEBITO_DISPONIBLE|MAX_PORC_ENDEUDAMIENTO|PORCENTAJE_COMPRAS_ECOMMERCE|     razon_comercios| razon_transacciones|       razon_compras|       razon_retiros|      razon_ecomerce|facturacion/aclaraciones|     m1| r1|     p1|    m2| r2| p2|     m3| r3| p3|  m4| r4| p4|   m5| r5| p5|  m6| r6| p6|  m7| r7| p7|  m8| r8| p8|  m9| r9| p9| m10|r10|p10| m11|r11|p11| m12|r12|p12| m13|r13|p13|Delta_Monto|Delta_Reclamaciones|Delta_Pendiente|Bandera|  F|  M|BEyG|Cliente Nuevo|Comercial|Corporativa|Patrimonial|Personal|PyME|  C|  D|aclarciones/facturacion|            features|prediction|\n",
      "+-----------+-----------+---------+-----+---------------+---------------------+------------------+------------+------------------+----+----------+---------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+---------------------+----------------------+----------------------------+--------------------+--------------------+--------------------+--------------------+--------------------+------------------------+-------+---+-------+------+---+---+-------+---+---+----+---+---+-----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+-----------+-------------------+---------------+-------+---+---+----+-------------+---------+-----------+-----------+--------+----+---+---+-----------------------+--------------------+----------+\n",
      "|   00035838|     302.60|        1|    2|              5|                    5|                 4|      245.29|               0.8|  41|        19|  -133.97|               0E-20|               0E-20|1.000000000000000...|0.065294272678777...|0.114549033890350...|0.546681662275965...|0.273475031154906...|               0E-20|0.147058823529411...|0.431372549019607...|0.421568627450980...|0.627636704151962...|0.490196078431372...|              5811.54|                 0E-20|        0.232784467690041...| 0.06451612903225806|211.6773577235772...|163.5709146341463...|728.5714285714285...|20.63645076007931...|                    32.8| 302.60|  5|-133.97|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  1|  0|   0|            0|        1|          0|          0|       0|   0|  0|  1|   0.030487804878048783|[302.6,1.0,2.0,5....|         0|\n",
      "|   00054168|     910.00|        1|    2|              2|                    2|                 1|       95.00|               0.5|  32|        11|      0.0|               0E-20|               0E-20|0.992300544271870...|0.127441894563249...|0.512441207735568...|0.285136049270907...|0.074980848430274...|               0E-20|0.399309703969202...|0.247245453338643...|0.353444842692154...|0.373703497045159...|0.613965219699986...|             47355.17|                 0E-20|        0.143899470642837...| 0.11764705882352941|2157.447964601769...|303.4632584269662...|3348.000000000000...|4.270846153846153...|                    44.5| 815.00|  1|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0|95.00|  1|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  1|  0|   0|            0|        1|          0|          0|       0|   0|  0|  1|    0.02247191011235955|[910.0,1.0,2.0,2....|         0|\n",
      "|   00147123|    3600.00|        1|    1|              3|                    3|                 0|        0.00|               1.0|  29|        11|      0.0|0.000475816393873...|               0E-20|1.000000000000000...|0.004956103558583...|0.104494038258492...|0.409185920973558...|0.481363937209365...|               0E-20|0.581395348837209...|0.418604651162790...|               0E-20|0.908869740979829...|0.534883720930232...|             13899.98|  0.666666666666666...|                       0E-20| 0.08333333333333333|1362.276578947368...|840.6604000000000...|5016.666666666666...|               0E-20|       8.333333333333334|3600.00|  3|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  1|  0|   0|            0|        1|          0|          0|       0|   0|  0|  1|                   0.12|[3600.0,1.0,1.0,3...|         0|\n",
      "|   00152272|    1053.90|        1|    2|              4|                    4|                 1|       99.00|               0.5|  27|        11|      0.0|               0E-20|               0E-20|1.000000000000000...|0.168606118600467...|0.196139735720107...|0.521015851864567...|0.114238293814857...|               0E-20|0.291954022988505...|0.535632183908045...|0.172413793103448...|0.493490733037196...|0.636781609195402...|             36238.06|                 0E-20|        0.397269668660082...| 0.16666666666666666|780.7880000000000...|301.7197435897435...|1359.375000000000...|4.435620077806243...|                    9.75|1053.90|  4|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  1|  0|   0|            0|        1|          0|          0|       0|   0|  0|  1|    0.10256410256410256|[1053.9,1.0,2.0,4...|         0|\n",
      "|   00194397|      99.00|        1|    1|              1|                    1|                 0|        0.00|               1.0|  28|        11|      0.0|               0E-20|               0E-20|1.000000000000000...|0.103444808238909...|0.043921526871988...|0.692807369351943...|0.159826295537158...|               0E-20|               0E-20|1.000000000000000...|               0E-20|0.785044794042052...|               0E-20|            135621.65|                 0E-20|        0.088864931692413...|                 0.1|707.8614285714285...|563.5050000000000...|3000.000000000000...|12.13959595959595...|                    24.0|  99.00|  1|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  1|  0|   0|            0|        0|          0|          0|       1|   0|  0|  1|   0.041666666666666664|(35,[0,1,2,3,4,5,...|         0|\n",
      "|   00444268|     251.00|        1|    2|              2|                    2|                 1|      151.00|               0.5|  26|        11|      0.0|0.455541602660661...|0.064039408866995...|0.935960591133004...|0.070778362738810...|0.119415370389703...|0.569920209989411...|0.239886056882074...|               0E-20|0.133004926108374...|0.724137931034482...|0.142857142857142...|0.597687730235194...|0.408866995073891...|              3417.75|  0.577727272727272...|        0.089484124024995...| 0.08333333333333333|222.9747023809523...|169.3207070707070...|312.3076923076923...|5.976095617529880...|                    49.5| 100.00|  1|    0.0|151.00|  1|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  0|  1|   0|            0|        1|          0|          0|       0|   0|  0|  1|   0.020202020202020204|[251.0,1.0,2.0,2....|         0|\n",
      "|   00447923|    2739.00|        1|    4|              4|                    3|                 3|     2089.00|              0.25|  26|        11|      0.0|               0E-20|               0E-20|1.000000000000000...|               0E-20|0.371781115879828...|0.583261802575107...|0.044957081545064...|               0E-20|0.375036374974017...|0.507888172937019...|0.117075452088962...|0.955042918454935...|0.721159842028684...|             14217.08|                 0E-20|        0.008583690987124...|                 0.4|864.5909090909090...|548.2352941176470...|1436.119402985074...|0.029207740051113...|                    4.25| 650.00|  1|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  1|  0|   0|            0|        1|          0|          0|       0|   0|  0|  1|    0.23529411764705882|(35,[0,1,2,3,4,5,...|         0|\n",
      "|   00458134|     768.00|        1|    1|              1|                    1|                 0|        0.00|               1.0|  28|        11|      0.0|0.429717543001600...|0.015160374605859...|0.984839625394140...|0.063369268930590...|0.215006873998695...|0.439986663786686...|0.281637193284027...|0.011864742403077...|0.528305002480470...|0.205196603236436...|0.254633651880014...|0.624758049975534...|0.867411095481671...|             13735.58|  0.994913333333333...|        0.052575042809954...|0.016129032258064516|832.5283024691358...|415.2228125000000...|1405.735409836065...|6.367187500000000...|                   224.0| 768.00|  1|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  0|  1|   0|            0|        1|          0|          0|       0|   0|  0|  1|   0.004464285714285714|[768.0,1.0,1.0,1....|         0|\n",
      "|   00461820|     100.00|        1|    1|              1|                    1|                 0|        0.00|               1.0|  27|        11|      0.0|0.791631935267448...|               0E-20|1.000000000000000...|               0E-20|0.046557017098013...|0.202675503689999...|0.750767479211986...|               0E-20|0.164974619289340...|0.479332849891225...|0.355692530819434...|0.159147742289629...|0.211747643219724...|             11557.36|  0.028666666666666...|        0.020330575151971...| 0.07142857142857142|666.2743842364532...|273.2611111111111...|1970.000000000000...|1.000000000000000...|                    18.0| 100.00|  1|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  0|  1|   0|            0|        1|          0|          0|       0|   0|  0|  1|    0.05555555555555555|[100.0,1.0,1.0,1....|         0|\n",
      "|   00475697|     753.11|        1|    1|              1|                    1|                 0|        0.00|               1.0|  26|        11|      0.0|               0E-20|               0E-20|1.000000000000000...|0.057199032746502...|0.086195486961605...|0.469515753217079...|0.387089727074811...|0.042338709677419...|0.121975806451612...|0.376008064516129...|0.459677419354838...|0.453035009917651...|0.444556451612903...|              8525.32|                 0E-20|        0.076524690402970...|0.012195121951219513|388.8908370044052...|248.3037410071942...|604.8780487804878...|3.507044123700389...|                   139.0| 753.11|  1|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  0|  1|   0|            0|        1|          0|          0|       0|   0|  0|  1|   0.007194244604316547|[753.11,1.0,1.0,1...|         0|\n",
      "|   00522122|     178.00|        2|    2|              2|                    2|                 0|        0.00|               0.5|  40|        11|      0.0|0.473876011866207...|               0E-20|1.000000000000000...|0.070043374373439...|0.183346394947702...|0.552042413562021...|0.194567817116836...|0.009033423667570...|0.434507678410117...|0.478771454381210...|0.077687443541102...|0.486684338400024...|0.610659439927732...|            119380.30|  0.944426969222743...|        0.052608747870185...| 0.02127659574468085|1019.586846590909...|774.6092307692307...|1064.423076923076...|50.59561797752808...|                   110.5|  79.00|  1|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  0|  1|   0|            0|        1|          0|          0|       0|   0|  1|  0|    0.00904977375565611|[178.0,2.0,2.0,2....|         0|\n",
      "|   00529362|      51.00|        1|    1|              1|                    1|                 0|        0.00|               1.0|  32|        11|      0.0|               0E-20|               0E-20|1.000000000000000...|0.031129679691980...|0.102400262144671...|0.303416072745146...|0.563053985418202...|               0E-20|0.170560747663551...|0.829439252336448...|               0E-20|0.136260615493842...|0.446261682242990...|              8726.09|                 0E-20|        0.004096010485786...| 0.08333333333333333|709.0282051282051...|197.9513513513513...|3566.666666666666...|0.588235294117647...|                    37.0|  51.00|  1|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  1|  0|   0|            0|        0|          0|          0|       1|   0|  0|  1|    0.02702702702702703|(35,[0,1,2,3,4,5,...|         0|\n",
      "|   00731582|      98.00|        1|    1|              2|                    2|                 0|        0.00|               1.0|  44|        11|      0.0|0.908036173766601...|               0E-20|1.000000000000000...|0.002261920025374...|0.328565146581530...|0.404970184263125...|0.264202749129969...|               0E-20|0.755752212389380...|0.226548672566371...|0.017699115044247...|0.411707873240645...|0.751327433628318...|             49827.18|  0.697592692307692...|        0.024122614149432...| 0.00909090909090909|1064.582133333333...|871.1455384615384...|2404.255319148936...|69.69030612244897...|                   162.5|  98.00|  2|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  0|  1|   0|            0|        0|          0|          0|       1|   0|  0|  1|   0.006153846153846154|[98.0,1.0,1.0,2.0...|         0|\n",
      "|   00971551|    3182.00|        1|    2|              3|                    3|                 2|     1432.00|0.6666666666666666|  30|        11|      0.0|0.306236498370886...|               0E-20|1.000000000000000...|0.015708941735873...|0.627418738930048...|0.220389465491448...|0.136482853842629...|               0E-20|0.123386109685316...|0.518221660678327...|0.358392229636356...|0.732702845804695...|0.567862360326923...|             31111.14|  0.916483333333333...|        0.043054084541000...| 0.06451612903225806|887.7444715447154...|758.7356000000000...|2894.514285714285...|0.769956002514142...|                    25.0|1750.00|  1|    0.0|  0.00|  0|0.0|1432.00|  2|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  1|  0|   0|            0|        1|          0|          0|       0|   0|  1|  0|                   0.04|[3182.0,1.0,2.0,3...|         0|\n",
      "|   01146807|    1157.00|        1|    1|              3|                    3|                 0|        0.00|               1.0|  38|        16|      0.0|               0E-20|               0E-20|1.000000000000000...|0.009772658039728...|0.152037467138336...|0.497329687222117...|0.340860187599817...|0.009920634920634...|0.313492063492063...|0.490079365079365...|0.186507936507936...|0.473036268006782...|0.488095238095238...|              9122.52|                 0E-20|        0.296432891773534...| 0.01818181818181818|464.9611724137931...|220.5479611650485...|446.0176991150442...|5.820138288677614...|      34.333333333333336|1157.00|  3|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  0|  1|   0|            0|        1|          0|          0|       0|   0|  0|  1|   0.029126213592233007|[1157.0,1.0,1.0,3...|         0|\n",
      "|   02039499|     448.35|        1|    1|              1|                    0|                 0|        0.00|               1.0|  41|        11|      0.0|0.058588760477428...|               0E-20|1.000000000000000...|0.016325126166080...|0.294659151319191...|0.540437230099257...|0.148578492415470...|0.043140638481449...|0.311475409836065...|0.570319240724762...|0.075064710957722...|0.845943023179603...|0.322691975841242...|             11761.76|  1.270313333333333...|        0.053344402449770...| 0.02702702702702703|1519.275277777777...|450.2262295081967...|3996.551724137931...|3.267625738820118...|                    61.0| 448.35|  1|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  1|  0|   0|            0|        1|          0|          0|       0|   0|  0|  1|    0.01639344262295082|[448.35,1.0,1.0,1...|         0|\n",
      "|   02116751|     100.00|        1|    1|              1|                    1|                 0|        0.00|               1.0|  57|        10|      0.0|               0E-20|               0E-20|1.000000000000000...|0.093513452036444...|0.175159156928429...|0.444634487123769...|0.286692903911356...|               0E-20|0.145867098865478...|0.486223662884927...|0.367909238249594...|0.628803242092701...|0.706464973887988...|             20570.65|                 0E-20|        0.153291733949284...|                0.05|386.9962734584450...|108.3368452380952...|1354.390243902439...|27.90000000000000...|                   168.0| 100.00|  1|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  1|  0|   0|            0|        1|          0|          0|       0|   0|  0|  1|   0.005952380952380952|[100.0,1.0,1.0,1....|         0|\n",
      "|   02133818|    3075.80|        1|    1|              1|                    1|                 0|        0.00|               1.0|  29|        10|      0.0|               0E-20|               0E-20|1.000000000000000...|0.005023286722470...|0.223532610952897...|0.566425249564742...|0.205018852759889...|               0E-20|0.633893919793014...|0.256144890038809...|0.109961190168175...|0.467667713231505...|0.553040103492884...|              9837.32|                 0E-20|        0.041454743834827...|0.017857142857142856|542.6802285714285...|326.9177981651376...|417.8378378378378...|0.480265296833344...|                   109.0|3075.80|  1|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  0|  1|   0|            0|        1|          0|          0|       0|   0|  0|  1|   0.009174311926605505|[3075.8,1.0,1.0,1...|         0|\n",
      "|   02295358|      99.00|        1|    1|              1|                    1|                 0|        0.00|               1.0|  22|        11|      0.0|               0E-20|               0E-20|0.990990990990990...|0.168643422699437...|0.307679819362683...|0.119136307123196...|0.404540450814681...|0.180180180180180...|               0E-20|0.342342342342342...|0.477477477477477...|0.273454150276530...|0.315315315315315...|              3200.00|                 0E-20|        0.285848944860392...|                0.04|253.0200714285714...|112.8300000000000...|326.4705882352941...|34.85858585858585...|                   107.0|  99.00|  1|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  0|  1|   0|            0|        1|          0|          0|       0|   0|  0|  1|   0.009345794392523364|[99.0,1.0,1.0,1.0...|         0|\n",
      "|   02390650|    1739.81|        2|    2|              2|                    2|                 1|     1645.00|               0.5|  33|        10|      0.0|1.000000000000000...|0.267256187645910...|0.732743812354089...|0.099367129315220...|0.146542290063050...|0.432448644875459...|0.321641935746269...|0.042847796779668...|0.390909894904411...|0.170075933234991...|0.396166375080927...|0.510553504104059...|0.545046878596397...|             51360.66|  0.543519842519685...|        0.094318209763858...|  0.0106951871657754|455.1348837209302...|357.1777027027027...|2519.882857142857...|11.46303906748438...|                   296.0|  94.81|  1|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  0|  1|   0|            0|        0|          0|          0|       1|   0|  1|  0|   0.003378378378378...|[1739.81,2.0,2.0,...|         0|\n",
      "+-----------+-----------+---------+-----+---------------+---------------------+------------------+------------+------------------+----+----------+---------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+---------------------+----------------------+----------------------------+--------------------+--------------------+--------------------+--------------------+--------------------+------------------------+-------+---+-------+------+---+---+-------+---+---+----+---+---+-----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+-----------+-------------------+---------------+-------+---+---+----+-------------+---------+-----------+-----------+--------+----+---+---+-----------------------+--------------------+----------+\n",
      "only showing top 20 rows\n",
      "\n"
     ]
    }
   ],
   "source": [
    "dataset = n_ctes\n",
    "# Instanciamos el modelo K-Means con el n√∫mero de Clusters \"K\" visto en el m√©todo del codo\n",
    "kmeans = KMeans().setK(4).setSeed(0)\n",
    "model = kmeans.fit(dataset.select('features'))\n",
    "\n",
    "# Realizamos la predicci√≥n\n",
    "predictions = model.transform(dataset)\n",
    "predictions.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Centroides"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Cluster Centers: \n",
      "[ 2.55320529e+03  1.19375671e+00  1.64878294e+00  3.15557970e+00\n",
      "  2.81690958e+00  8.37577393e-01 -2.41413702e+01  3.18066337e-01\n",
      "  8.90521887e-01  7.75116111e-02  2.12488935e-01  4.24594417e-01\n",
      "  2.83756703e-01  1.09824332e-02  2.32681416e-01  4.69643991e-01\n",
      "  2.21062003e-01  5.64176165e-01  5.23122354e-01  9.36391427e+05\n",
      "  4.99354685e-01  1.05551972e+03  7.15654772e+02  1.81839096e+03\n",
      "  1.28214839e+02  6.32446747e-02  5.48109519e-04  7.52852255e-01\n",
      "  8.53938743e-05  9.10735599e-03  2.37208296e-01  3.02586243e-01\n",
      "  9.62766285e-02  3.58376245e-02  2.56916407e-02]\n",
      "[3.37105772e+03 1.30709877e+00 1.75308642e+00 5.00462963e+00\n",
      " 2.80709877e+00 8.25762035e-01 2.94537037e-01 2.76445786e-01\n",
      " 8.59098708e-01 8.88822087e-02 1.76094138e-01 4.62175902e-01\n",
      " 2.72847751e-01 1.49470165e-02 1.73095760e-01 4.96710119e-01\n",
      " 2.02592783e-01 6.07720719e-01 5.48762176e-01 9.79074063e+10\n",
      " 5.02068942e-01 1.66405069e+03 1.16137627e+03 3.21358476e+03\n",
      " 1.33776774e+02 6.99490464e-02 0.00000000e+00 4.89197531e-01\n",
      " 0.00000000e+00 3.85802469e-02 4.72222222e-01 1.63580247e-01\n",
      " 1.31172840e-01 8.33333333e-02 2.93209877e-02]\n",
      "[ 3.99269545e+03  1.31437126e+00  1.67964072e+00  3.21856287e+00\n",
      "  2.19161677e+00  8.26813791e-01 -2.42069581e+02  4.50542064e-01\n",
      "  8.19866565e-01  7.71389247e-02  1.64882015e-01  4.80657067e-01\n",
      "  2.77321994e-01  1.41941113e-02  1.52857830e-01  4.63434566e-01\n",
      "  2.22806905e-01  6.13959715e-01  5.04179532e-01  7.92005974e+10\n",
      "  5.93886312e-01  1.86434577e+03  1.14078011e+03  2.81691619e+03\n",
      "  6.96912465e+01  5.73146891e-02  0.00000000e+00  4.07185629e-01\n",
      "  0.00000000e+00  3.59281437e-02  5.56886228e-01  2.78443114e-01\n",
      "  1.25748503e-01  4.49101796e-02  2.99401198e-02]\n",
      "[ 3.04032573e+03  1.20224719e+00  1.58426966e+00  2.68539326e+00\n",
      "  1.59550562e+00  8.22068568e-01 -5.14178652e+01  4.26458452e-01\n",
      "  8.29937548e-01  6.02955465e-02  1.78088491e-01  4.53808932e-01\n",
      "  3.07807031e-01  9.86235133e-03  1.70797102e-01  4.85914212e-01\n",
      "  1.87358919e-01  6.39778114e-01  4.94442339e-01  4.63932562e+10\n",
      "  4.85331108e-01  1.89340317e+03  1.26883358e+03  3.02580025e+03\n",
      "  1.41171826e+02  7.26791675e-02  0.00000000e+00  4.04494382e-01\n",
      "  0.00000000e+00  7.86516854e-02  5.16853933e-01  2.69662921e-01\n",
      "  1.12359551e-01  3.37078652e-02  3.37078652e-02]\n"
     ]
    }
   ],
   "source": [
    "centers = model.clusterCenters()\n",
    "print(\"Cluster Centers: \")\n",
    "for center in centers:\n",
    "    print(center)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Normalizaci√≥n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 15,
   "metadata": {},
   "outputs": [],
   "source": [
    "from pyspark.ml.feature import Normalizer\n",
    "from pyspark.ml.linalg import Vectors\n",
    "\n",
    "# Normalizando el Vector usando $L^1$ norm.\n",
    "normalizer = Normalizer(inputCol=\"features\", outputCol=\"normFeatures\", p=1.0)\n",
    "l1NormData = normalizer.transform(n_ctes)\n",
    "#print(\"Normalized using L^1 norm\")\n",
    "#l1NormData.show()\n",
    "\n",
    "# Normalize el Vector usando  $L^\\infty$ norm.\n",
    "lInfNormData = normalizer.transform(n_ctes, {normalizer.p: float(\"inf\")})\n",
    "#print(\"Normalized using L^inf norm\")\n",
    "#lInfNormData.show()\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 16,
   "metadata": {},
   "outputs": [],
   "source": [
    "l1NormData = l1NormData.drop('features')\n",
    "l1NormData = l1NormData.withColumnRenamed('normFeatures','features')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 17,
   "metadata": {},
   "outputs": [],
   "source": [
    "#print(l1NormData.select('features').collect()[0])\n",
    "# print(lInfNormData.select('normFeatures').collect()[0])"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## PCA"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 18,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "+-----------+-----------+---------+-----+---------------+---------------------+------------------+------------+------------------+----+----------+---------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+---------------------+----------------------+----------------------------+--------------------+--------------------+--------------------+--------------------+--------------------+------------------------+-------+---+-------+------+---+---+-------+---+---+----+---+---+-----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+-----------+-------------------+---------------+-------+---+---+----+-------------+---------+-----------+-----------+--------+----+---+---+-----------------------+--------------------+--------------------+\n",
      "|customer_id|monto_total|n_tarjeta|n_com|n_reclamaciones|dictamen_afavor_total|NO_CLAIMS_12_MONTH|monto_12_mes|      div_comercio|edad|antiguedad|pendiente|     COMPRAS_CREDITO|     RETIROS_CREDITO|      RETIROS_DEBITO|   COMPRAS_MADRUGADA|      COMPRAS_MANANA|       COMPRAS_TARDE|       COMPRAS_NOCHE|   RETIROS_MADRUGADA|      RETIROS_MANANA|       RETIROS_TARDE|       RETIROS_NOCHE|COMPRAS_ENTRE_SEMANA|RETIROS_ENTRE_SEMANA|MAX_DEBITO_DISPONIBLE|MAX_PORC_ENDEUDAMIENTO|PORCENTAJE_COMPRAS_ECOMMERCE|     razon_comercios| razon_transacciones|       razon_compras|       razon_retiros|      razon_ecomerce|facturacion/aclaraciones|     m1| r1|     p1|    m2| r2| p2|     m3| r3| p3|  m4| r4| p4|   m5| r5| p5|  m6| r6| p6|  m7| r7| p7|  m8| r8| p8|  m9| r9| p9| m10|r10|p10| m11|r11|p11| m12|r12|p12| m13|r13|p13|Delta_Monto|Delta_Reclamaciones|Delta_Pendiente|Bandera|  F|  M|BEyG|Cliente Nuevo|Comercial|Corporativa|Patrimonial|Personal|PyME|  C|  D|aclarciones/facturacion|            features|                 pca|\n",
      "+-----------+-----------+---------+-----+---------------+---------------------+------------------+------------+------------------+----+----------+---------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+---------------------+----------------------+----------------------------+--------------------+--------------------+--------------------+--------------------+--------------------+------------------------+-------+---+-------+------+---+---+-------+---+---+----+---+---+-----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+-----------+-------------------+---------------+-------+---+---+----+-------------+---------+-----------+-----------+--------+----+---+---+-----------------------+--------------------+--------------------+\n",
      "|   00035838|     302.60|        1|    2|              5|                    5|                 4|      245.29|               0.8|  41|        19|  -133.97|               0E-20|               0E-20|1.000000000000000...|0.065294272678777...|0.114549033890350...|0.546681662275965...|0.273475031154906...|               0E-20|0.147058823529411...|0.431372549019607...|0.421568627450980...|0.627636704151962...|0.490196078431372...|              5811.54|                 0E-20|        0.232784467690041...| 0.06451612903225806|211.6773577235772...|163.5709146341463...|728.5714285714285...|20.63645076007931...|                    32.8| 302.60|  5|-133.97|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  1|  0|   0|            0|        1|          0|          0|       0|   0|  0|  1|   0.030487804878048783|[0.04093883616611...|[0.65041917633520...|\n",
      "|   00054168|     910.00|        1|    2|              2|                    2|                 1|       95.00|               0.5|  32|        11|      0.0|               0E-20|               0E-20|0.992300544271870...|0.127441894563249...|0.512441207735568...|0.285136049270907...|0.074980848430274...|               0E-20|0.399309703969202...|0.247245453338643...|0.353444842692154...|0.373703497045159...|0.613965219699986...|             47355.17|                 0E-20|        0.143899470642837...| 0.11764705882352941|2157.447964601769...|303.4632584269662...|3348.000000000000...|4.270846153846153...|                    44.5| 815.00|  1|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0|95.00|  1|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  1|  0|   0|            0|        1|          0|          0|       0|   0|  0|  1|    0.02247191011235955|[0.01682354638760...|[0.74286752348344...|\n",
      "|   00147123|    3600.00|        1|    1|              3|                    3|                 0|        0.00|               1.0|  29|        11|      0.0|0.000475816393873...|               0E-20|1.000000000000000...|0.004956103558583...|0.104494038258492...|0.409185920973558...|0.481363937209365...|               0E-20|0.581395348837209...|0.418604651162790...|               0E-20|0.908869740979829...|0.534883720930232...|             13899.98|  0.666666666666666...|                       0E-20| 0.08333333333333333|1362.276578947368...|840.6604000000000...|5016.666666666666...|               0E-20|       8.333333333333334|3600.00|  3|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  1|  0|   0|            0|        1|          0|          0|       0|   0|  0|  1|                   0.12|[0.14554384444449...|[0.39273528253275...|\n",
      "|   00152272|    1053.90|        1|    2|              4|                    4|                 1|       99.00|               0.5|  27|        11|      0.0|               0E-20|               0E-20|1.000000000000000...|0.168606118600467...|0.196139735720107...|0.521015851864567...|0.114238293814857...|               0E-20|0.291954022988505...|0.535632183908045...|0.172413793103448...|0.493490733037196...|0.636781609195402...|             36238.06|                 0E-20|        0.397269668660082...| 0.16666666666666666|780.7880000000000...|301.7197435897435...|1359.375000000000...|4.435620077806243...|                    9.75|1053.90|  4|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  1|  0|   0|            0|        1|          0|          0|       0|   0|  0|  1|    0.10256410256410256|[0.02650986550337...|[0.77711849116960...|\n",
      "|   00194397|      99.00|        1|    1|              1|                    1|                 0|        0.00|               1.0|  28|        11|      0.0|               0E-20|               0E-20|1.000000000000000...|0.103444808238909...|0.043921526871988...|0.692807369351943...|0.159826295537158...|               0E-20|               0E-20|1.000000000000000...|               0E-20|0.785044794042052...|               0E-20|            135621.65|                 0E-20|        0.088864931692413...|                 0.1|707.8614285714285...|563.5050000000000...|3000.000000000000...|12.13959595959595...|                    24.0|  99.00|  1|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  1|  0|   0|            0|        0|          0|          0|       1|   0|  0|  1|   0.041666666666666664|(35,[0,1,2,3,4,5,...|[0.84230669720661...|\n",
      "|   00444268|     251.00|        1|    2|              2|                    2|                 1|      151.00|               0.5|  26|        11|      0.0|0.455541602660661...|0.064039408866995...|0.935960591133004...|0.070778362738810...|0.119415370389703...|0.569920209989411...|0.239886056882074...|               0E-20|0.133004926108374...|0.724137931034482...|0.142857142857142...|0.597687730235194...|0.408866995073891...|              3417.75|  0.577727272727272...|        0.089484124024995...| 0.08333333333333333|222.9747023809523...|169.3207070707070...|312.3076923076923...|5.976095617529880...|                    49.5| 100.00|  1|    0.0|151.00|  1|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  0|  1|   0|            0|        1|          0|          0|       0|   0|  0|  1|   0.020202020202020204|[0.05713862708165...|[0.63344778857352...|\n",
      "|   00447923|    2739.00|        1|    4|              4|                    3|                 3|     2089.00|              0.25|  26|        11|      0.0|               0E-20|               0E-20|1.000000000000000...|               0E-20|0.371781115879828...|0.583261802575107...|0.044957081545064...|               0E-20|0.375036374974017...|0.507888172937019...|0.117075452088962...|0.955042918454935...|0.721159842028684...|             14217.08|                 0E-20|        0.008583690987124...|                 0.4|864.5909090909090...|548.2352941176470...|1436.119402985074...|0.029207740051113...|                    4.25| 650.00|  1|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  1|  0|   0|            0|        1|          0|          0|       0|   0|  0|  1|    0.23529411764705882|(35,[0,1,2,3,4,5,...|[0.54969605222671...|\n",
      "|   00458134|     768.00|        1|    1|              1|                    1|                 0|        0.00|               1.0|  28|        11|      0.0|0.429717543001600...|0.015160374605859...|0.984839625394140...|0.063369268930590...|0.215006873998695...|0.439986663786686...|0.281637193284027...|0.011864742403077...|0.528305002480470...|0.205196603236436...|0.254633651880014...|0.624758049975534...|0.867411095481671...|             13735.58|  0.994913333333333...|        0.052575042809954...|0.016129032258064516|832.5283024691358...|415.2228125000000...|1405.735409836065...|6.367187500000000...|                   224.0| 768.00|  1|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  0|  1|   0|            0|        1|          0|          0|       0|   0|  0|  1|   0.004464285714285714|[0.04471527249049...|[0.65869105466174...|\n",
      "|   00461820|     100.00|        1|    1|              1|                    1|                 0|        0.00|               1.0|  27|        11|      0.0|0.791631935267448...|               0E-20|1.000000000000000...|               0E-20|0.046557017098013...|0.202675503689999...|0.750767479211986...|               0E-20|0.164974619289340...|0.479332849891225...|0.355692530819434...|0.159147742289629...|0.211747643219724...|             11557.36|  0.028666666666666...|        0.020330575151971...| 0.07142857142857142|666.2743842364532...|273.2611111111111...|1970.000000000000...|1.000000000000000...|                    18.0| 100.00|  1|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  0|  1|   0|            0|        1|          0|          0|       0|   0|  0|  1|    0.05555555555555555|[0.00685958459727...|[0.66320796630123...|\n",
      "|   00475697|     753.11|        1|    1|              1|                    1|                 0|        0.00|               1.0|  26|        11|      0.0|               0E-20|               0E-20|1.000000000000000...|0.057199032746502...|0.086195486961605...|0.469515753217079...|0.387089727074811...|0.042338709677419...|0.121975806451612...|0.376008064516129...|0.459677419354838...|0.453035009917651...|0.444556451612903...|              8525.32|                 0E-20|        0.076524690402970...|0.012195121951219513|388.8908370044052...|248.3037410071942...|604.8780487804878...|3.507044123700389...|                   139.0| 753.11|  1|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  0|  1|   0|            0|        1|          0|          0|       0|   0|  0|  1|   0.007194244604316547|[0.07149384049977...|[0.66116180010766...|\n",
      "|   00522122|     178.00|        2|    2|              2|                    2|                 0|        0.00|               0.5|  40|        11|      0.0|0.473876011866207...|               0E-20|1.000000000000000...|0.070043374373439...|0.183346394947702...|0.552042413562021...|0.194567817116836...|0.009033423667570...|0.434507678410117...|0.478771454381210...|0.077687443541102...|0.486684338400024...|0.610659439927732...|            119380.30|  0.944426969222743...|        0.052608747870185...| 0.02127659574468085|1019.586846590909...|774.6092307692307...|1064.423076923076...|50.59561797752808...|                   110.5|  79.00|  1|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  0|  1|   0|            0|        1|          0|          0|       0|   0|  1|  0|    0.00904977375565611|[0.00145325650101...|[0.84783684813213...|\n",
      "|   00529362|      51.00|        1|    1|              1|                    1|                 0|        0.00|               1.0|  32|        11|      0.0|               0E-20|               0E-20|1.000000000000000...|0.031129679691980...|0.102400262144671...|0.303416072745146...|0.563053985418202...|               0E-20|0.170560747663551...|0.829439252336448...|               0E-20|0.136260615493842...|0.446261682242990...|              8726.09|                 0E-20|        0.004096010485786...| 0.08333333333333333|709.0282051282051...|197.9513513513513...|3566.666666666666...|0.588235294117647...|                    37.0|  51.00|  1|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  1|  0|   0|            0|        0|          0|          0|       1|   0|  0|  1|    0.02702702702702703|(35,[0,1,2,3,4,5,...|[0.53010660504644...|\n",
      "|   00731582|      98.00|        1|    1|              2|                    2|                 0|        0.00|               1.0|  44|        11|      0.0|0.908036173766601...|               0E-20|1.000000000000000...|0.002261920025374...|0.328565146581530...|0.404970184263125...|0.264202749129969...|               0E-20|0.755752212389380...|0.226548672566371...|0.017699115044247...|0.411707873240645...|0.751327433628318...|             49827.18|  0.697592692307692...|        0.024122614149432...| 0.00909090909090909|1064.582133333333...|871.1455384615384...|2404.255319148936...|69.69030612244897...|                   162.5|  98.00|  2|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  0|  1|   0|            0|        0|          0|          0|       1|   0|  0|  1|   0.006153846153846154|[0.00180317338999...|[0.78952145626931...|\n",
      "|   00971551|    3182.00|        1|    2|              3|                    3|                 2|     1432.00|0.6666666666666666|  30|        11|      0.0|0.306236498370886...|               0E-20|1.000000000000000...|0.015708941735873...|0.627418738930048...|0.220389465491448...|0.136482853842629...|               0E-20|0.123386109685316...|0.518221660678327...|0.358392229636356...|0.732702845804695...|0.567862360326923...|             31111.14|  0.916483333333333...|        0.043054084541000...| 0.06451612903225806|887.7444715447154...|758.7356000000000...|2894.514285714285...|0.769956002514142...|                    25.0|1750.00|  1|    0.0|  0.00|  0|0.0|1432.00|  2|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  1|  0|   0|            0|        1|          0|          0|       0|   0|  1|  0|                   0.04|[0.08190026262905...|[0.65057689714764...|\n",
      "|   01146807|    1157.00|        1|    1|              3|                    3|                 0|        0.00|               1.0|  38|        16|      0.0|               0E-20|               0E-20|1.000000000000000...|0.009772658039728...|0.152037467138336...|0.497329687222117...|0.340860187599817...|0.009920634920634...|0.313492063492063...|0.490079365079365...|0.186507936507936...|0.473036268006782...|0.488095238095238...|              9122.52|                 0E-20|        0.296432891773534...| 0.01818181818181818|464.9611724137931...|220.5479611650485...|446.0176991150442...|5.820138288677614...|      34.333333333333336|1157.00|  3|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  0|  1|   0|            0|        1|          0|          0|       0|   0|  0|  1|   0.029126213592233007|[0.10121725578855...|[0.64116987095444...|\n",
      "|   02039499|     448.35|        1|    1|              1|                    0|                 0|        0.00|               1.0|  41|        11|      0.0|0.058588760477428...|               0E-20|1.000000000000000...|0.016325126166080...|0.294659151319191...|0.540437230099257...|0.148578492415470...|0.043140638481449...|0.311475409836065...|0.570319240724762...|0.075064710957722...|0.845943023179603...|0.322691975841242...|             11761.76|  1.270313333333333...|        0.053344402449770...| 0.02702702702702703|1519.275277777777...|450.2262295081967...|3996.551724137931...|3.267625738820118...|                    61.0| 448.35|  1|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  1|  0|   0|            0|        1|          0|          0|       0|   0|  0|  1|    0.01639344262295082|[0.02464823314379...|[0.51040646328825...|\n",
      "|   02116751|     100.00|        1|    1|              1|                    1|                 0|        0.00|               1.0|  57|        10|      0.0|               0E-20|               0E-20|1.000000000000000...|0.093513452036444...|0.175159156928429...|0.444634487123769...|0.286692903911356...|               0E-20|0.145867098865478...|0.486223662884927...|0.367909238249594...|0.628803242092701...|0.706464973887988...|             20570.65|                 0E-20|        0.153291733949284...|                0.05|386.9962734584450...|108.3368452380952...|1354.390243902439...|27.90000000000000...|                   168.0| 100.00|  1|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  1|  0|   0|            0|        1|          0|          0|       0|   0|  0|  1|   0.005952380952380952|[0.00443289633905...|[0.78430300402387...|\n",
      "|   02133818|    3075.80|        1|    1|              1|                    1|                 0|        0.00|               1.0|  29|        10|      0.0|               0E-20|               0E-20|1.000000000000000...|0.005023286722470...|0.223532610952897...|0.566425249564742...|0.205018852759889...|               0E-20|0.633893919793014...|0.256144890038809...|0.109961190168175...|0.467667713231505...|0.553040103492884...|              9837.32|                 0E-20|        0.041454743834827...|0.017857142857142856|542.6802285714285...|326.9177981651376...|417.8378378378378...|0.480265296833344...|                   109.0|3075.80|  1|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  0|  1|   0|            0|        1|          0|          0|       0|   0|  0|  1|   0.009174311926605505|[0.21643696520745...|[0.50243180731498...|\n",
      "|   02295358|      99.00|        1|    1|              1|                    1|                 0|        0.00|               1.0|  22|        11|      0.0|               0E-20|               0E-20|0.990990990990990...|0.168643422699437...|0.307679819362683...|0.119136307123196...|0.404540450814681...|0.180180180180180...|               0E-20|0.342342342342342...|0.477477477477477...|0.273454150276530...|0.315315315315315...|              3200.00|                 0E-20|        0.285848944860392...|                0.04|253.0200714285714...|112.8300000000000...|326.4705882352941...|34.85858585858585...|                   107.0|  99.00|  1|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  0|  1|   0|            0|        1|          0|          0|       0|   0|  0|  1|   0.009345794392523364|[0.02453064481674...|[0.65793631602585...|\n",
      "|   02390650|    1739.81|        2|    2|              2|                    2|                 1|     1645.00|               0.5|  33|        10|      0.0|1.000000000000000...|0.267256187645910...|0.732743812354089...|0.099367129315220...|0.146542290063050...|0.432448644875459...|0.321641935746269...|0.042847796779668...|0.390909894904411...|0.170075933234991...|0.396166375080927...|0.510553504104059...|0.545046878596397...|             51360.66|  0.543519842519685...|        0.094318209763858...|  0.0106951871657754|455.1348837209302...|357.1777027027027...|2519.882857142857...|11.46303906748438...|                   296.0|  94.81|  1|    0.0|  0.00|  0|0.0|   0.00|  0|0.0|0.00|  0|0.0| 0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|0.00|  0|0.0|          0|                  0|              0|      0|  0|  1|   0|            0|        0|          0|          0|       1|   0|  1|  0|   0.003378378378378...|[0.03081493301116...|[0.77483109792297...|\n",
      "+-----------+-----------+---------+-----+---------------+---------------------+------------------+------------+------------------+----+----------+---------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+---------------------+----------------------+----------------------------+--------------------+--------------------+--------------------+--------------------+--------------------+------------------------+-------+---+-------+------+---+---+-------+---+---+----+---+---+-----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+----+---+---+-----------+-------------------+---------------+-------+---+---+----+-------------+---------+-----------+-----------+--------+----+---+---+-----------------------+--------------------+--------------------+\n",
      "only showing top 20 rows\n",
      "\n"
     ]
    }
   ],
   "source": [
    "from pyspark.ml.feature import PCA as PCAml\n",
    "\n",
    "pca = PCAml(k=2, inputCol=\"features\", outputCol=\"pca\")\n",
    "model = pca.fit(l1NormData)\n",
    "transformed = model.transform(l1NormData)\n",
    "transformed.show()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 19,
   "metadata": {},
   "outputs": [],
   "source": [
    "#transformed.select('pca').collect()[0]"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Codo (PCA)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 20,
   "metadata": {},
   "outputs": [],
   "source": [
    "\n",
    "vecAssembler = VectorAssembler(inputCols=[\n",
    " 'pca'], outputCol=\"pca_v\")\n",
    "#print(vecAssembler)\n",
    "n_ctes1 = vecAssembler.transform(transformed)\n",
    "#n_ctes.show()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 21,
   "metadata": {},
   "outputs": [],
   "source": [
    "dataset1 = n_ctes1"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "\n",
    "# Calcular el coste y gr√°ficar\n",
    "cost = np.zeros(15)\n",
    "for k in range(2,15):\n",
    "    kmeans = KMeans().setK(k).setSeed(1).setFeaturesCol('pca_v')\n",
    "    model = kmeans.fit(dataset1.select('pca_v'))\n",
    "    cost[k] = model.computeCost(dataset1.select('pca_v'))\n",
    "# Gr√°fica del coste\n",
    "df_cost = pd.DataFrame(cost[2:])\n",
    "df_cost.columns = [\"cost\"]\n",
    "\n",
    "new_col = [2,3,4,5,6,7,8, 9,10,11,12,13,14]\n",
    "df_cost.insert(0, 'cluster', new_col)\n",
    "\n",
    "import pylab as pl\n",
    "pl.figure(figsize=(20, 10))\n",
    "pl.plot(df_cost.cluster, df_cost.cost)\n",
    "pl.xlabel('N√∫mero de Clusters')\n",
    "pl.ylabel('Score')\n",
    "pl.title('Curva de Codo')\n",
    "pl.show()\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "dataset1 = dataset1.drop('features')\n",
    "dataset1 = dataset1.withColumnRenamed('pca_v','features')"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## K-Means (PCA)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "from pyspark.ml.clustering import KMeans\n",
    "\n",
    "# Instanciamos el modelo K-Means con el n√∫mero de Clusters \"K\" visto en el m√©todo del codo\n",
    "kmeans = KMeans().setK(3).setSeed(0)\n",
    "model = kmeans.fit(dataset1.select('features'))\n",
    "# Realizamos la predicci√≥n\n",
    "predictions_pca = model.transform(dataset1)\n",
    "predictions_pca.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Centroides (PCA)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "centers_pca = model.clusterCenters()\n",
    "#type(centers_pca)\n",
    "print(\"Cluster Centers: \")\n",
    "#print(centers_pca[0,:])\n",
    "#centers_li = centers_pca.collect()\n",
    "for center in centers_pca:\n",
    "    print(center)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "cent = np.array(centers_pca)\n",
    "cent[:,0]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "from pyspark.ml.feature import PCA\n",
    "k=2\n",
    "pcaModel = PCA(k=k, inputCol=\"features\", outputCol=\"featuresPCA\").fit(dataset1)\n",
    "transformedFeaturesDF = pcaModel.transform(dataset1)\n",
    "\n",
    "plt.figure(figsize=(7,7))\n",
    "eigenvalues = [float(value) for value in pcaModel.explainedVariance]\n",
    "plt.bar(list(range(1,len(eigenvalues)+1)),eigenvalues)\n",
    "pd.DataFrame(eigenvalues,columns=['explained variance'])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "#------------------------------------------------------------------------"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "\n",
    "from pyspark.ml.linalg import Vectors\n",
    "\n",
    "var = transformed.select('customer_id','pca')\n",
    "\n",
    "def extract(row):\n",
    "    return (row.customer_id, ) + tuple(row.pca.toArray().tolist())\n",
    "\n",
    "var_a = var.rdd.map(extract).toDF([\"customer_id\"]) \n",
    "# Vector values will be named _2, _3, ...\n",
    "var_a = var_a.withColumnRenamed(\"_2\",\"x\")\n",
    "var_a = var_a.withColumnRenamed(\"_3\",\"y\")\n",
    "#var_a = var_a.withColumnRenamed(\"_4\",\"z\")\n",
    "var_a.show()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "x = list(var_a.select('x').collect())\n",
    "y = list(var_a.select('y').collect())\n",
    "#z = list(var_a.select('z').collect())\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "#jupyter --NotebookApp.iopub_data_rate_limit=1.0e10\n",
    "#print(x)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "corr = predictions_pca.join(var_a, on = ['customer_id'], how = 'left')"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Correlaci√≥n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "################################################################################################################\n",
    "################################ Correlaci√≥n variables num√©ricas ###############################################\n",
    "################################################################################################################\n",
    "from pyspark.mllib.stat import Statistics\n",
    "import matplotlib.pyplot as plt\n",
    "import seaborn as sns\n",
    "from math import log\n",
    "import numpy as np\n",
    "import seaborn as sns # importando seaborn\n",
    "from scipy import stats # importando scipy.stats\n",
    "# Librer√≠a para obtener correlaci√≥n\n",
    "import scipy.stats as ss\n",
    "# Librer√≠a para obtener todas las combinaciones (c/repetidos) de una lista\n",
    "from itertools import product\n",
    "\n",
    "\n",
    "# Lista de variables num√©ricas\n",
    "var_num = [\n",
    "'monto_total',\n",
    " 'n_tarjeta',\n",
    " 'n_com',\n",
    " 'n_reclamaciones',\n",
    " 'dictamen_afavor_total',\n",
    " 'div_comercio',\n",
    " 'pendiente',\n",
    " 'COMPRAS_CREDITO',\n",
    " 'RETIROS_DEBITO',\n",
    " 'COMPRAS_MADRUGADA',\n",
    " 'COMPRAS_MANANA',\n",
    " 'COMPRAS_TARDE',\n",
    " 'COMPRAS_NOCHE',\n",
    " 'RETIROS_MADRUGADA',\n",
    " 'RETIROS_MANANA',\n",
    " 'RETIROS_TARDE',\n",
    " 'RETIROS_NOCHE',\n",
    " 'COMPRAS_ENTRE_SEMANA',\n",
    " 'RETIROS_ENTRE_SEMANA',\n",
    " 'MAX_DEBITO_DISPONIBLE',\n",
    " 'MAX_PORC_ENDEUDAMIENTO',\n",
    " 'razon_transacciones',\n",
    " 'razon_compras',\n",
    " 'razon_retiros',\n",
    " 'razon_ecomerce',\n",
    " 'aclarciones/facturacion',\n",
    " 'BEyG',\n",
    " 'Comercial',\n",
    " 'Corporativa',\n",
    " 'Patrimonial',\n",
    " 'Personal',\n",
    " 'Delta_Monto',\n",
    " 'Delta_Reclamaciones',\n",
    " 'Delta_Pendiente',\n",
    " 'C',\n",
    " 'x',\n",
    " 'y'\n",
    "]\n",
    "# Convertir a df\n",
    "tabla_aux =  corr[var_num].toPandas()\n",
    "\n",
    "# ----------------------------------------------- Correlaci√≥n de Pearson -----------------------------------------------\n",
    "tabla_corr = tabla_aux\n",
    "for var in var_num:\n",
    "    tabla_corr[var]=tabla_corr[var].astype(float)\n",
    "    \n",
    "corr = tabla_corr.corr(method = \"pearson\")\n",
    "plt.figure(figsize=(20, 10))\n",
    "sns.heatmap(corr, xticklabels = corr.columns.values,yticklabels = corr.columns.values, annot = True,linewidths = .6, cmap=\"Blues\")\n",
    "plt.title(\"Tabla de Correlacion pearson\")\n",
    "plt.show()\n",
    "plt.clf()\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "carac_var = corr.to_csv(\"caracterizacion_variables.txt\")"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Clusters"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "#%% Plot k-means clustering.\n",
    "#predictions_pca = predictions_pca.withColumn('pca', F.col('pca').cast(IntegerType()))\n",
    "#%matplotlib qt\n",
    "from mpl_toolkits import mplot3d\n",
    "import matplotlib.pyplot as plt\n",
    "df = predictions_pca.toPandas()\n",
    "colores=['blue','green','red','yellow','fuchsia','cyan','purple']\n",
    "asignar=[]\n",
    "for row in range (len(df)):\n",
    "    asignar.append(colores[df['prediction'][row]])\n",
    "plt.figure(figsize = (16, 9))\n",
    "#ax = plt.axes(projection =\"3d\")     \n",
    "plt.scatter(x, y, c=asignar)\n",
    "plt.scatter(cent[:,0], cent[:,1],marker='*', c='black') # Marco centroides.\n",
    "plt.xlabel('X')\n",
    "plt.ylabel('Y')\n",
    "#ax.set_zlabel('Var_3')\n",
    "#plt.zlabel('Var_3')\n",
    "plt.title('K-Means Clustering')\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "#%% Plot k-means clustering.\n",
    "#predictions_pca = predictions_pca.withColumn('pca', F.col('pca').cast(IntegerType()))\n",
    "#%matplotlib qt\n",
    "from mpl_toolkits import mplot3d\n",
    "import matplotlib.pyplot as plt\n",
    "\n",
    "df = predictions_pca.toPandas()\n",
    "colores=['blue','red','green','yellow','fuchsia','cyan','purple']\n",
    "asignar=[]\n",
    "for row in range (len(df)):\n",
    "    asignar.append(colores[df['prediction'][row]])\n",
    "\n",
    "plt.figure(figsize = (16, 9))\n",
    "#ax = plt.axes(projection =\"3d\")     \n",
    "plt.scatter(x, y, c=asignar, s = 0.01 )\n",
    "plt.scatter(cent[:,0], cent[:,1],marker='*', c='black') # Marco centroides.\n",
    "plt.xlabel('X')\n",
    "plt.ylabel('Y')\n",
    "#ax.set_zlabel('Var_3')\n",
    "#plt.zlabel('Var_3')\n",
    "plt.title('K-Means Clustering')\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "pd.DataFrame(data = {\n",
    "    'color':asignar\n",
    "}).value_counts()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "df.shape"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Caracterizaci√≥n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "df[[\n",
    " 'monto_total',\n",
    " 'n_tarjeta',\n",
    " 'n_com',\n",
    " 'n_reclamaciones',\n",
    " 'dictamen_afavor_total',\n",
    " 'div_comercio',\n",
    " 'pendiente',\n",
    " 'COMPRAS_CREDITO',\n",
    " 'RETIROS_DEBITO',\n",
    " 'COMPRAS_MADRUGADA',\n",
    " 'COMPRAS_MANANA',\n",
    " 'COMPRAS_TARDE',\n",
    " 'COMPRAS_NOCHE',\n",
    " 'RETIROS_MADRUGADA',\n",
    " 'RETIROS_MANANA',\n",
    " 'RETIROS_TARDE',\n",
    " 'RETIROS_NOCHE',\n",
    " 'COMPRAS_ENTRE_SEMANA',\n",
    " 'RETIROS_ENTRE_SEMANA',\n",
    " 'MAX_DEBITO_DISPONIBLE',\n",
    " 'MAX_PORC_ENDEUDAMIENTO',\n",
    " 'razon_transacciones',\n",
    " 'razon_compras',\n",
    " 'razon_retiros',\n",
    " 'razon_ecomerce',\n",
    " 'aclarciones/facturacion',\n",
    " 'BEyG',\n",
    " 'Comercial',\n",
    " 'Corporativa',\n",
    " 'Patrimonial',\n",
    " 'Personal',\n",
    " 'C',\n",
    " 'Delta_Monto',\n",
    " 'Delta_Reclamaciones',\n",
    " 'Delta_Pendiente'\n",
    "]] = df [[\n",
    " 'monto_total',\n",
    " 'n_tarjeta',\n",
    " 'n_com',\n",
    " 'n_reclamaciones',\n",
    " 'dictamen_afavor_total',\n",
    " 'div_comercio',\n",
    " 'pendiente',\n",
    " 'COMPRAS_CREDITO',\n",
    " 'RETIROS_DEBITO',\n",
    " 'COMPRAS_MADRUGADA',\n",
    " 'COMPRAS_MANANA',\n",
    " 'COMPRAS_TARDE',\n",
    " 'COMPRAS_NOCHE',\n",
    " 'RETIROS_MADRUGADA',\n",
    " 'RETIROS_MANANA',\n",
    " 'RETIROS_TARDE',\n",
    " 'RETIROS_NOCHE',\n",
    " 'COMPRAS_ENTRE_SEMANA',\n",
    " 'RETIROS_ENTRE_SEMANA',\n",
    " 'MAX_DEBITO_DISPONIBLE',\n",
    " 'MAX_PORC_ENDEUDAMIENTO',\n",
    " 'razon_transacciones',\n",
    " 'razon_compras',\n",
    " 'razon_retiros',\n",
    " 'razon_ecomerce',\n",
    " 'aclarciones/facturacion',\n",
    " 'BEyG',\n",
    " 'Comercial',\n",
    " 'Corporativa',\n",
    " 'Patrimonial',\n",
    " 'Personal',\n",
    " 'C',\n",
    " 'Delta_Monto',\n",
    " 'Delta_Reclamaciones',\n",
    " 'Delta_Pendiente']].astype(float)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "#Borremos columnas auxiliares del DF\n",
    "df = df.drop(\"features\", axis = 1)\n",
    "df = df.drop(\"pca\", axis = 1)\n",
    "#df = df.drop(\"pca_v\", axis = 1)\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "#Filtramos el primer cluster (cluster 0)\n",
    "cluster_f1 = df.loc[df['prediction'] == 0]\n",
    "cluster_f1.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "cluster_f1.shape #Verdes"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "#Filtramos el segundo cluster (cluster 1)\n",
    "cluster_f2 = df.loc[df['prediction'] == 1]\n",
    "cluster_f2.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "cluster_f2.shape # Rojos"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "#Filtramos el tercer cluster (cluster 2)\n",
    "cluster_f3 = df.loc[df['prediction'] == 2]\n",
    "cluster_f3.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "cluster_f3.shape #Azules"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "#Filtramos el quinto cluster (cluster 4)\n",
    "#cluster_f5 = df.loc[df['prediction'] == 4]\n",
    "#cluster_f5.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "#Filtramos el sexto cluster (cluster 5)\n",
    "#cluster_f6 = df.loc[df['prediction'] == 5]\n",
    "#cluster_f6.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "#Filtramos el s√©ptimo cluster (cluster 6)\n",
    "#cluster_f7 = df.loc[df['prediction'] == 6]\n",
    "#cluster_f7.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "#Descripciones Estadisticas\n",
    "c1 = cluster_f1.describe()\n",
    "cluster1 = c1.to_csv(\"cluster1_.txt\")\n",
    "\n",
    "c2 = cluster_f2.describe()\n",
    "cluster2 = c2.to_csv(\"cluster2_.txt\")\n",
    "\n",
    "c3 = cluster_f3.describe()\n",
    "cluster3 = c3.to_csv(\"cluster3_.txt\")\n",
    "\n",
    "#c4 = cluster_f4.describe()\n",
    "#cluster4 = c4.to_csv(\"cluster4_.txt\")\n",
    "\n",
    "#c5 = cluster_f5.describe()\n",
    "#cluster5 = c5.to_csv(\"cluster5.txt\")\n",
    "\n",
    "#c6 = cluster_f6.describe()\n",
    "#cluster6 = c6.to_csv(\"cluster6.txt\")\n",
    "\n",
    "#c7 = cluster_f7.describe()\n",
    "#cluster7 = c7.to_csv(\"cluster7.txt\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "d1-spark2python3",
   "language": "python",
   "name": "spark-python-d1-spark2python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.6.11"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}